{"ast":null,"code":"import { API } from '../../config/index';\nimport { VERIFICAR_SESION, LOGIN, LOGOUT, LOADING, ERROR, UPDATE_USER } from '../types/usuarioTypes';\nexport const login = data => async dispatch => {\n  dispatch({\n    type: LOADING\n  });\n\n  try {\n    if (data.email.trim() === '' || data.password.trim() === '') {\n      return dispatch({\n        type: ERROR,\n        payload: 'Es necesario completar todos los campos'\n      });\n    }\n\n    let headers = new Headers();\n    headers.append(\"Content-Type\", \"application/json\");\n    return fetch(`${API}/login`, {\n      method: 'POST',\n      body: JSON.stringify(data),\n      headers\n    }).then(res => res.json()).then(response => {\n      if (response.ok) {\n        let objUsuario = {\n          nombre: response.usuario.nombre,\n          email: response.usuario.email,\n          foto: response.usuario.foto,\n          token: response.token,\n          address: response.usuario.ubicacion,\n          idUsuario: response.usuario.idUsuario,\n          lat: response.usuario.lat,\n          lon: response.usuario.lon,\n          telefono: response.usuario.telefono\n        };\n        localStorage.setItem('oliverpetshop_usuario', JSON.stringify(objUsuario));\n        dispatch({\n          type: LOGIN,\n          payload: localStorage.getItem('oliverpetshop_usuario')\n        });\n      } else {\n        return dispatch({\n          type: ERROR,\n          payload: response.info\n        });\n      }\n    });\n  } catch (error) {\n    console.log(error);\n    return dispatch({\n      type: ERROR,\n      payload: error\n    });\n  }\n};\nexport const logout = () => async dispatch => {\n  dispatch({\n    type: LOADING\n  });\n\n  try {\n    localStorage.removeItem('oliverpetshop_usuario');\n    return dispatch({\n      type: LOGOUT\n    });\n  } catch (error) {\n    dispatch({\n      type: ERROR,\n      payload: error\n    });\n  }\n};\nexport const verificarSesion = () => async dispatch => {\n  try {\n    let dataUsuario = JSON.parse(localStorage.getItem('oliverpetshop_usuario'));\n\n    if (dataUsuario) {\n      return dispatch({\n        type: VERIFICAR_SESION,\n        payload: {\n          data: dataUsuario,\n          logueado: true\n        }\n      });\n    }\n\n    return dispatch({\n      type: VERIFICAR_SESION,\n      payload: {\n        data: null,\n        logueado: false\n      }\n    });\n  } catch (error) {\n    dispatch({\n      type: ERROR,\n      payload: error\n    });\n  }\n};\nexport const register = data => dispatch => {\n  dispatch({\n    type: LOADING\n  });\n\n  try {\n    let headers = new Headers();\n    headers.append(\"Content-Type\", \"application/json\");\n    return fetch(`${API}register`, {\n      method: 'POST',\n      body: JSON.stringify(data),\n      headers\n    }).then(res => res.json()).then(response => {\n      if (response.ok) {\n        let objUsuario = {\n          nombre: response.usuario.nombre,\n          email: response.usuario.email,\n          foto: response.usuario.foto,\n          token: response.token,\n          address: response.usuario.address,\n          idUsuario: response.usuario.idUsuario\n        };\n        localStorage.setItem('oliverpetshop_usuario', JSON.stringify(objUsuario));\n        dispatch({\n          type: LOGIN,\n          payload: localStorage.getItem('oliverpetshop_usuario')\n        });\n      } else {\n        dispatch({\n          type: ERROR,\n          payload: response.info\n        });\n      }\n    });\n  } catch (error) {\n    dispatch({\n      type: ERROR,\n      payload: error\n    });\n  }\n};\nexport const singInWithGoogle = tokenId => async dispatch => {\n  dispatch({\n    type: LOADING\n  });\n\n  try {\n    let headers = new Headers();\n    headers.append(\"Content-Type\", \"application/json\");\n    return fetch(`${API}google/tokensignin`, {\n      method: 'POST',\n      headers,\n      body: JSON.stringify({\n        token: tokenId\n      })\n    }).then(res => res.json()).then(response => {\n      if (!response.ok) {\n        return dispatch({\n          type: ERROR,\n          payload: response.info\n        });\n      }\n\n      ;\n      let objUsuario = {\n        nombre: response.usuario.nombre,\n        email: response.usuario.email,\n        foto: response.usuario.foto,\n        token: response.token,\n        address: response.usuario.address,\n        idUsuario: response.usuario.idUsuario,\n        lat: response.usuario.lat,\n        lon: response.usuario.lon,\n        telefono: response.usuario.telefono\n      };\n      localStorage.setItem('oliverpetshop_usuario', JSON.stringify(objUsuario));\n      dispatch({\n        type: LOGIN,\n        payload: localStorage.getItem('oliverpetshop_usuario')\n      });\n    });\n  } catch (error) {\n    dispatch({\n      type: ERROR,\n      payload: error\n    });\n  }\n};\nexport const actualizarFoto = (data, id) => async dispatch => {\n  dispatch({\n    type: LOADING\n  });\n\n  try {\n    let headers = new Headers();\n    let token = JSON.parse(localStorage.getItem('oliverpetshop_usuario')).token;\n    headers.append(\"token\", token);\n    const request = await fetch(`${API}actualizarFotoUsuarioDesdeWeb/${id}`, {\n      method: 'PUT',\n      headers,\n      body: data\n    });\n    const dataRequest = await request.json();\n\n    if (dataRequest.ok) {\n      localStorage.setItem('oliverpetshop_usuario', JSON.stringify(dataRequest.user));\n      dispatch({\n        type: UPDATE_USER,\n        payload: dataRequest.user\n      });\n    }\n  } catch (error) {\n    dispatch({\n      type: ERROR,\n      payload: error\n    });\n  }\n};\nexport const actualizarUsuario = (data, id) => async dispatch => {\n  dispatch({\n    type: LOADING\n  });\n\n  try {\n    let headers = new Headers();\n    let token = JSON.parse(localStorage.getItem('oliverpetshop_usuario')).token;\n    if (!token) return dispatch({\n      type: ERROR,\n      payload: 'Token incorrecto'\n    });\n    headers.append('token', token);\n    headers.append(\"Content-Type\", \"application/json\");\n    const request = await fetch(`${API}actualizarUsuarioDesdeWeb/${id}`, {\n      method: 'PUT',\n      headers,\n      body: JSON.stringify(data)\n    });\n    if (request.status != 200) return dispatch({\n      type: ERROR,\n      payload: 'Ocurrio un error, ¡intentelo más tarde!'\n    });\n    const dataRequest = await request.json();\n\n    if (dataRequest.ok) {\n      localStorage.setItem('oliverpetshop_usuario', JSON.stringify(dataRequest.user));\n      return dispatch({\n        type: UPDATE_USER,\n        payload: dataRequest.user\n      });\n    }\n\n    return dispatch({\n      type: ERROR,\n      payload: dataRequest.info\n    });\n  } catch (error) {\n    dispatch({\n      type: ERROR,\n      payload: error.message\n    });\n  }\n};","map":null,"metadata":{},"sourceType":"module"}