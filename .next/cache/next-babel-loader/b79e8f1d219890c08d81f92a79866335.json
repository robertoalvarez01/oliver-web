{"ast":null,"code":"var _jsxFileName = \"/home/franco/desarrollo/proyecto_oliver/oliver-web-next/pages/procesarVenta/[[...params]].js\";\nimport _JSXStyle from \"styled-jsx/style\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport Head from '../../src/components/Head';\nimport Loader from '../../src/components/Loader';\nimport { useRouter } from 'next/router';\nimport { connect } from 'react-redux';\nimport * as carritoActions from '../../store/actions/carritoActions';\nimport * as enviosActions from '../../store/actions/enviosActions';\nimport { useEffect, useState } from 'react';\nimport { API } from '../../config/index';\nimport Error from '../../src/components/Error';\nconst {\n  guardar: enviosGuardar\n} = enviosActions;\nconst {\n  traerProductos: carritoTraerProductos\n} = carritoActions;\n\nconst ProcesarVenta = props => {\n  const {\n    0: error,\n    1: setError\n  } = useState(false);\n  const {\n    0: ventaRegistrada,\n    1: setVentaRegistrada\n  } = useState(false);\n  useEffect(() => {\n    const dataEnvio = JSON.parse(localStorage.getItem('dataEnvio'));\n    props.enviosGuardar(dataEnvio);\n    props.carritoTraerProductos();\n\n    if (props.usuarioReducer.logueado && props.carritoReducer.productos.length > 0 && props.enviosReducer.data) {\n      procesarInfo();\n    }\n  }, [props.usuarioReducer]);\n\n  const procesarInfo = async () => {\n    const {\n      idUsuario\n    } = props.usuarioReducer.usuario;\n    const {\n      subtotal,\n      porcentaje_descuento,\n      descuento,\n      total,\n      productos\n    } = props.carritoReducer;\n    const {\n      zona,\n      tipo\n    } = props.enviosReducer.data;\n    let f = new Date();\n    let mes = f.getMonth() < 10 ? `0${f.getMonth() + 1}` : `${f.getMonth()}`;\n    let dia = f.getDay() < 10 ? `0${f.getDay()}` : `${f.getDay()}`;\n    let fecha = `${f.getFullYear()}-${mes}-${dia}`;\n    let dataToRequest = {\n      envio: {\n        idZona: zona,\n        tipo\n      },\n      venta: {\n        subtotal,\n        porcentaje_descuento,\n        descuento,\n        total,\n        idUsuario,\n        productos,\n        fecha\n      }\n    };\n    return registrarVenta(dataToRequest);\n  };\n\n  const registrarVenta = async data => {\n    try {\n      const headers = new Headers();\n      headers.append('token', props.usuarioReducer.usuario.token);\n      headers.append(\"Content-Type\", \"application/json\");\n      const reqVenta = await fetch(`${API}/registrarVenta`, {\n        headers,\n        method: 'POST',\n        body: JSON.stringify(data)\n      });\n\n      if (reqVenta.status == 200) {\n        localStorage.removeItem('dataEnvio');\n        localStorage.removeItem('carrito');\n        setVentaRegistrada('Felicidades, Tu venta se registró con éxito. En breve nos comunicaremos con usted para informarle el estado de su compra.');\n        setTimeout(() => {\n          window.location.assign('/');\n        }, 5000);\n      } else {\n        setError(true);\n      }\n    } catch (error) {\n      setError(error.message);\n    }\n  };\n\n  console.log(props);\n  const router = useRouter();\n  return __jsx(React.Fragment, null, __jsx(Head, {\n    title: \"Finalizacion de compra\",\n    metadesc: \"\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 13\n    }\n  }), __jsx(\"div\", {\n    className: \"jsx-2063553454\" + \" \" + \"wrapper\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 13\n    }\n  }, !props.usuarioReducer.logueado || props.enviosReducer.error || props.carritoReducer.error || error ? __jsx(Error, {\n    message: \"Ha ocurrido un error, intentalo mas tarde\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 119\n    }\n  }) : __jsx(React.Fragment, null, ventaRegistrada ? __jsx(\"div\", {\n    className: \"jsx-2063553454\" + \" \" + \"alert alert-success\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 86,\n      columnNumber: 44\n    }\n  }, ventaRegistrada) : __jsx(React.Fragment, null, __jsx(Loader, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 33\n    }\n  }), __jsx(\"p\", {\n    className: \"jsx-2063553454\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 33\n    }\n  }, \"Su compra esta siento procesada, aguarde unos segundos...\")))), __jsx(_JSXStyle, {\n    id: \"2063553454\",\n    __self: this\n  }, \".wrapper.jsx-2063553454{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:90vh;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL2ZyYW5jby9kZXNhcnJvbGxvL3Byb3llY3RvX29saXZlci9vbGl2ZXItd2ViLW5leHQvcGFnZXMvcHJvY2VzYXJWZW50YS9bWy4uLnBhcmFtc11dLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQStGd0IsQUFHaUMsMEVBQ1UsbUdBQ0osNkZBQ1AsWUFDVSw4RUFDekIiLCJmaWxlIjoiL2hvbWUvZnJhbmNvL2Rlc2Fycm9sbG8vcHJveWVjdG9fb2xpdmVyL29saXZlci13ZWItbmV4dC9wYWdlcy9wcm9jZXNhclZlbnRhL1tbLi4ucGFyYW1zXV0uanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgSGVhZCBmcm9tICcuLi8uLi9zcmMvY29tcG9uZW50cy9IZWFkJztcbmltcG9ydCBMb2FkZXIgZnJvbSAnLi4vLi4vc3JjL2NvbXBvbmVudHMvTG9hZGVyJztcbmltcG9ydCB7dXNlUm91dGVyfSBmcm9tICduZXh0L3JvdXRlcic7XG5pbXBvcnQge2Nvbm5lY3R9IGZyb20gJ3JlYWN0LXJlZHV4JztcbmltcG9ydCAqIGFzIGNhcnJpdG9BY3Rpb25zIGZyb20gJy4uLy4uL3N0b3JlL2FjdGlvbnMvY2Fycml0b0FjdGlvbnMnO1xuaW1wb3J0ICogYXMgZW52aW9zQWN0aW9ucyBmcm9tICcuLi8uLi9zdG9yZS9hY3Rpb25zL2Vudmlvc0FjdGlvbnMnO1xuaW1wb3J0IHsgdXNlRWZmZWN0LCB1c2VTdGF0ZSB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7QVBJfSBmcm9tICcuLi8uLi9jb25maWcvaW5kZXgnO1xuaW1wb3J0IEVycm9yIGZyb20gJy4uLy4uL3NyYy9jb21wb25lbnRzL0Vycm9yJztcblxuY29uc3Qge2d1YXJkYXI6ZW52aW9zR3VhcmRhcn0gPSBlbnZpb3NBY3Rpb25zO1xuY29uc3Qge3RyYWVyUHJvZHVjdG9zOmNhcnJpdG9UcmFlclByb2R1Y3Rvc30gPSBjYXJyaXRvQWN0aW9ucztcblxuY29uc3QgUHJvY2VzYXJWZW50YSA9IChwcm9wcykgPT4ge1xuICAgIGNvbnN0IFtlcnJvciwgc2V0RXJyb3JdID0gdXNlU3RhdGUoZmFsc2UpO1xuICAgIGNvbnN0IFt2ZW50YVJlZ2lzdHJhZGEsIHNldFZlbnRhUmVnaXN0cmFkYV0gPSB1c2VTdGF0ZShmYWxzZSk7XG5cbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgICBjb25zdCBkYXRhRW52aW8gPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdkYXRhRW52aW8nKSk7XG4gICAgICAgIHByb3BzLmVudmlvc0d1YXJkYXIoZGF0YUVudmlvKTtcbiAgICAgICAgcHJvcHMuY2Fycml0b1RyYWVyUHJvZHVjdG9zKCk7XG4gICAgICAgIGlmKHByb3BzLnVzdWFyaW9SZWR1Y2VyLmxvZ3VlYWRvICYmIHByb3BzLmNhcnJpdG9SZWR1Y2VyLnByb2R1Y3Rvcy5sZW5ndGg+MCAmJiBwcm9wcy5lbnZpb3NSZWR1Y2VyLmRhdGEpe1xuICAgICAgICAgICAgcHJvY2VzYXJJbmZvKCk7XG4gICAgICAgIH1cbiAgICB9LCBbcHJvcHMudXN1YXJpb1JlZHVjZXJdKTtcblxuICAgIGNvbnN0IHByb2Nlc2FySW5mbyA9IGFzeW5jKCk9PntcbiAgICAgICAgY29uc3Qge2lkVXN1YXJpb30gPSBwcm9wcy51c3VhcmlvUmVkdWNlci51c3VhcmlvO1xuICAgICAgICBjb25zdCB7c3VidG90YWwscG9yY2VudGFqZV9kZXNjdWVudG8sZGVzY3VlbnRvLHRvdGFsLHByb2R1Y3Rvc30gPSBwcm9wcy5jYXJyaXRvUmVkdWNlcjtcbiAgICAgICAgY29uc3Qge3pvbmEsdGlwb30gPSBwcm9wcy5lbnZpb3NSZWR1Y2VyLmRhdGE7XG4gICAgICAgIGxldCBmID0gbmV3IERhdGUoKTtcbiAgICAgICAgbGV0IG1lcyA9ICgoZi5nZXRNb250aCgpKTwxMCk/YDAke2YuZ2V0TW9udGgoKSsxfWA6YCR7Zi5nZXRNb250aCgpfWA7XG4gICAgICAgIGxldCBkaWEgPSAoKGYuZ2V0RGF5KCkpPDEwKT9gMCR7Zi5nZXREYXkoKX1gOmAke2YuZ2V0RGF5KCl9YDtcbiAgICAgICAgbGV0IGZlY2hhID0gYCR7Zi5nZXRGdWxsWWVhcigpfS0ke21lc30tJHtkaWF9YDtcbiAgICAgICAgbGV0IGRhdGFUb1JlcXVlc3QgPSB7XG4gICAgICAgICAgICBlbnZpbzp7XG4gICAgICAgICAgICAgICAgaWRab25hOnpvbmEsXG4gICAgICAgICAgICAgICAgdGlwb1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHZlbnRhOntcbiAgICAgICAgICAgICAgICBzdWJ0b3RhbCxcbiAgICAgICAgICAgICAgICBwb3JjZW50YWplX2Rlc2N1ZW50byxcbiAgICAgICAgICAgICAgICBkZXNjdWVudG8sXG4gICAgICAgICAgICAgICAgdG90YWwsXG4gICAgICAgICAgICAgICAgaWRVc3VhcmlvLFxuICAgICAgICAgICAgICAgIHByb2R1Y3RvcyxcbiAgICAgICAgICAgICAgICBmZWNoYVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZWdpc3RyYXJWZW50YShkYXRhVG9SZXF1ZXN0KTtcbiAgICB9XG5cbiAgICBjb25zdCByZWdpc3RyYXJWZW50YSA9IGFzeW5jIGRhdGE9PntcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IGhlYWRlcnMgPSBuZXcgSGVhZGVycygpO1xuICAgICAgICAgICAgaGVhZGVycy5hcHBlbmQoJ3Rva2VuJyxwcm9wcy51c3VhcmlvUmVkdWNlci51c3VhcmlvLnRva2VuKTtcbiAgICAgICAgICAgIGhlYWRlcnMuYXBwZW5kKFwiQ29udGVudC1UeXBlXCIsIFwiYXBwbGljYXRpb24vanNvblwiKTtcbiAgICAgICAgICAgIGNvbnN0IHJlcVZlbnRhID0gYXdhaXQgZmV0Y2goYCR7QVBJfS9yZWdpc3RyYXJWZW50YWAse1xuICAgICAgICAgICAgICAgIGhlYWRlcnMsXG4gICAgICAgICAgICAgICAgbWV0aG9kOidQT1NUJyxcbiAgICAgICAgICAgICAgICBib2R5OkpTT04uc3RyaW5naWZ5KGRhdGEpXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmKHJlcVZlbnRhLnN0YXR1cyA9PSAyMDApe1xuICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdkYXRhRW52aW8nKTtcbiAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgnY2Fycml0bycpO1xuICAgICAgICAgICAgICAgIHNldFZlbnRhUmVnaXN0cmFkYSgnRmVsaWNpZGFkZXMsIFR1IHZlbnRhIHNlIHJlZ2lzdHLDsyBjb24gw6l4aXRvLiBFbiBicmV2ZSBub3MgY29tdW5pY2FyZW1vcyBjb24gdXN0ZWQgcGFyYSBpbmZvcm1hcmxlIGVsIGVzdGFkbyBkZSBzdSBjb21wcmEuJyk7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5hc3NpZ24oJy8nKVxuICAgICAgICAgICAgICAgIH0sIDUwMDApO1xuICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgc2V0RXJyb3IodHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBzZXRFcnJvcihlcnJvci5tZXNzYWdlKVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2cocHJvcHMpO1xuICAgIGNvbnN0IHJvdXRlciA9IHVzZVJvdXRlcigpO1xuICAgIHJldHVybiAoXG4gICAgICAgIDw+XG4gICAgICAgICAgICA8SGVhZCB0aXRsZT1cIkZpbmFsaXphY2lvbiBkZSBjb21wcmFcIiBtZXRhZGVzYz1cIlwiLz5cbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwid3JhcHBlclwiPlxuICAgICAgICAgICAgICAgIHsoIXByb3BzLnVzdWFyaW9SZWR1Y2VyLmxvZ3VlYWRvIHx8IHByb3BzLmVudmlvc1JlZHVjZXIuZXJyb3IgfHwgcHJvcHMuY2Fycml0b1JlZHVjZXIuZXJyb3IgfHwgZXJyb3IpPzxFcnJvciBtZXNzYWdlPVwiSGEgb2N1cnJpZG8gdW4gZXJyb3IsIGludGVudGFsbyBtYXMgdGFyZGVcIi8+OlxuICAgICAgICAgICAgICAgICAgICA8PlxuICAgICAgICAgICAgICAgICAgICAgICAgeyh2ZW50YVJlZ2lzdHJhZGEpPzxkaXYgY2xhc3NOYW1lPVwiYWxlcnQgYWxlcnQtc3VjY2Vzc1wiPnt2ZW50YVJlZ2lzdHJhZGF9PC9kaXY+OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDw+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxMb2FkZXIvPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cD5TdSBjb21wcmEgZXN0YSBzaWVudG8gcHJvY2VzYWRhLCBhZ3VhcmRlIHVub3Mgc2VndW5kb3MuLi48L3A+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC8+XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIDwvPlxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICAgICA8c3R5bGUganN4PntgXG4gICAgICAgICAgICAgICAgLndyYXBwZXJ7XG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6ZmxleDtcbiAgICAgICAgICAgICAgICAgICAganVzdGlmeS1jb250ZW50OmNlbnRlcjtcbiAgICAgICAgICAgICAgICAgICAgYWxpZ24taXRlbXM6Y2VudGVyO1xuICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6OTB2aDtcbiAgICAgICAgICAgICAgICAgICAgZmxleC1kaXJlY3Rpb246Y29sdW1uO1xuICAgICAgICAgICAgICAgIH0gICAgXG4gICAgICAgICAgICBgfTwvc3R5bGU+XG4gICAgICAgIDwvPlxuICAgICk7XG59XG5cblByb2Nlc2FyVmVudGEuZ2V0SW5pdGlhbFByb3BzID0gYXN5bmMoe3F1ZXJ5fSk9PntcbiAgICBjb25zdCB7Y29sbGVjdGlvbl9pZCxjb2xsZWN0aW9uX3N0YXR1cyxleHRlcm5hbF9yZWZlcmVuY2UsbWVyY2hhbnQsYWNjb3VudF9pZCxtZXJjaGFudF9vcmRlcl9pZCxwYXltZW50X2lkLHBheW1lbnRfdHlwZSxwcmVmZXJlbmNlX2lkLHByb2Nlc3NpbmdfbW9kZSxzaXRlX2lkLHN0YXR1c30gPSBxdWVyeTtcbiAgICByZXR1cm4ge2NvbGxlY3Rpb25faWQsY29sbGVjdGlvbl9zdGF0dXMsZXh0ZXJuYWxfcmVmZXJlbmNlLG1lcmNoYW50LGFjY291bnRfaWQsbWVyY2hhbnRfb3JkZXJfaWQscGF5bWVudF9pZCxwYXltZW50X3R5cGUscHJlZmVyZW5jZV9pZCxwcm9jZXNzaW5nX21vZGUsc2l0ZV9pZCxzdGF0dXN9O1xufVxuXG5jb25zdCBtYXBTdGF0ZVRvUHJvcHMgPSAoe2NhcnJpdG9SZWR1Y2VyLGVudmlvc1JlZHVjZXIsdXN1YXJpb1JlZHVjZXJ9KT0+e1xuICAgIHJldHVybiB7Y2Fycml0b1JlZHVjZXIsZW52aW9zUmVkdWNlcix1c3VhcmlvUmVkdWNlcn1cbn07XG5jb25zdCBtYXBEaXNwYXRjaFRvUHJvcHMgPSB7XG4gICAgZW52aW9zR3VhcmRhcixcbiAgICBjYXJyaXRvVHJhZXJQcm9kdWN0b3Ncbn1cbiBcbmV4cG9ydCBkZWZhdWx0IGNvbm5lY3QobWFwU3RhdGVUb1Byb3BzLG1hcERpc3BhdGNoVG9Qcm9wcykoUHJvY2VzYXJWZW50YSk7Il19 */\\n/*@ sourceURL=/home/franco/desarrollo/proyecto_oliver/oliver-web-next/pages/procesarVenta/[[...params]].js */\"));\n};\n\nProcesarVenta.getInitialProps = async ({\n  query\n}) => {\n  const {\n    collection_id,\n    collection_status,\n    external_reference,\n    merchant,\n    account_id,\n    merchant_order_id,\n    payment_id,\n    payment_type,\n    preference_id,\n    processing_mode,\n    site_id,\n    status\n  } = query;\n  return {\n    collection_id,\n    collection_status,\n    external_reference,\n    merchant,\n    account_id,\n    merchant_order_id,\n    payment_id,\n    payment_type,\n    preference_id,\n    processing_mode,\n    site_id,\n    status\n  };\n};\n\nconst mapStateToProps = ({\n  carritoReducer,\n  enviosReducer,\n  usuarioReducer\n}) => {\n  return {\n    carritoReducer,\n    enviosReducer,\n    usuarioReducer\n  };\n};\n\nconst mapDispatchToProps = {\n  enviosGuardar,\n  carritoTraerProductos\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(ProcesarVenta);","map":{"version":3,"sources":["/home/franco/desarrollo/proyecto_oliver/oliver-web-next/pages/procesarVenta/[[...params]].js"],"names":["Head","Loader","useRouter","connect","carritoActions","enviosActions","useEffect","useState","API","Error","guardar","enviosGuardar","traerProductos","carritoTraerProductos","ProcesarVenta","props","error","setError","ventaRegistrada","setVentaRegistrada","dataEnvio","JSON","parse","localStorage","getItem","usuarioReducer","logueado","carritoReducer","productos","length","enviosReducer","data","procesarInfo","idUsuario","usuario","subtotal","porcentaje_descuento","descuento","total","zona","tipo","f","Date","mes","getMonth","dia","getDay","fecha","getFullYear","dataToRequest","envio","idZona","venta","registrarVenta","headers","Headers","append","token","reqVenta","fetch","method","body","stringify","status","removeItem","setTimeout","window","location","assign","message","console","log","router","getInitialProps","query","collection_id","collection_status","external_reference","merchant","account_id","merchant_order_id","payment_id","payment_type","preference_id","processing_mode","site_id","mapStateToProps","mapDispatchToProps"],"mappings":"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","sourcesContent":["import Head from '../../src/components/Head';\nimport Loader from '../../src/components/Loader';\nimport {useRouter} from 'next/router';\nimport {connect} from 'react-redux';\nimport * as carritoActions from '../../store/actions/carritoActions';\nimport * as enviosActions from '../../store/actions/enviosActions';\nimport { useEffect, useState } from 'react';\nimport {API} from '../../config/index';\nimport Error from '../../src/components/Error';\n\nconst {guardar:enviosGuardar} = enviosActions;\nconst {traerProductos:carritoTraerProductos} = carritoActions;\n\nconst ProcesarVenta = (props) => {\n    const [error, setError] = useState(false);\n    const [ventaRegistrada, setVentaRegistrada] = useState(false);\n\n    useEffect(() => {\n        const dataEnvio = JSON.parse(localStorage.getItem('dataEnvio'));\n        props.enviosGuardar(dataEnvio);\n        props.carritoTraerProductos();\n        if(props.usuarioReducer.logueado && props.carritoReducer.productos.length>0 && props.enviosReducer.data){\n            procesarInfo();\n        }\n    }, [props.usuarioReducer]);\n\n    const procesarInfo = async()=>{\n        const {idUsuario} = props.usuarioReducer.usuario;\n        const {subtotal,porcentaje_descuento,descuento,total,productos} = props.carritoReducer;\n        const {zona,tipo} = props.enviosReducer.data;\n        let f = new Date();\n        let mes = ((f.getMonth())<10)?`0${f.getMonth()+1}`:`${f.getMonth()}`;\n        let dia = ((f.getDay())<10)?`0${f.getDay()}`:`${f.getDay()}`;\n        let fecha = `${f.getFullYear()}-${mes}-${dia}`;\n        let dataToRequest = {\n            envio:{\n                idZona:zona,\n                tipo\n            },\n            venta:{\n                subtotal,\n                porcentaje_descuento,\n                descuento,\n                total,\n                idUsuario,\n                productos,\n                fecha\n            }\n        }\n        return registrarVenta(dataToRequest);\n    }\n\n    const registrarVenta = async data=>{\n        try {\n            const headers = new Headers();\n            headers.append('token',props.usuarioReducer.usuario.token);\n            headers.append(\"Content-Type\", \"application/json\");\n            const reqVenta = await fetch(`${API}/registrarVenta`,{\n                headers,\n                method:'POST',\n                body:JSON.stringify(data)\n            });\n            if(reqVenta.status == 200){\n                localStorage.removeItem('dataEnvio');\n                localStorage.removeItem('carrito');\n                setVentaRegistrada('Felicidades, Tu venta se registró con éxito. En breve nos comunicaremos con usted para informarle el estado de su compra.');\n                setTimeout(() => {\n                    window.location.assign('/')\n                }, 5000);\n            }else{\n                setError(true);\n            }\n        } catch (error) {\n            setError(error.message)\n        }\n    }\n\n    console.log(props);\n    const router = useRouter();\n    return (\n        <>\n            <Head title=\"Finalizacion de compra\" metadesc=\"\"/>\n            <div className=\"wrapper\">\n                {(!props.usuarioReducer.logueado || props.enviosReducer.error || props.carritoReducer.error || error)?<Error message=\"Ha ocurrido un error, intentalo mas tarde\"/>:\n                    <>\n                        {(ventaRegistrada)?<div className=\"alert alert-success\">{ventaRegistrada}</div>:\n                            <>\n                                <Loader/>\n                                <p>Su compra esta siento procesada, aguarde unos segundos...</p>\n                            </>\n                        }\n                    </>\n                }\n            </div>\n\n            <style jsx>{`\n                .wrapper{\n                    display:flex;\n                    justify-content:center;\n                    align-items:center;\n                    height:90vh;\n                    flex-direction:column;\n                }    \n            `}</style>\n        </>\n    );\n}\n\nProcesarVenta.getInitialProps = async({query})=>{\n    const {collection_id,collection_status,external_reference,merchant,account_id,merchant_order_id,payment_id,payment_type,preference_id,processing_mode,site_id,status} = query;\n    return {collection_id,collection_status,external_reference,merchant,account_id,merchant_order_id,payment_id,payment_type,preference_id,processing_mode,site_id,status};\n}\n\nconst mapStateToProps = ({carritoReducer,enviosReducer,usuarioReducer})=>{\n    return {carritoReducer,enviosReducer,usuarioReducer}\n};\nconst mapDispatchToProps = {\n    enviosGuardar,\n    carritoTraerProductos\n}\n \nexport default connect(mapStateToProps,mapDispatchToProps)(ProcesarVenta);"]},"metadata":{},"sourceType":"module"}