{"ast":null,"code":"var _jsxFileName = \"/home/franco/desarrollo/proyecto_oliver/oliver-sitio/pages/procesarVenta/[[...params]].js\";\nimport _JSXStyle from \"styled-jsx/style\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport Head from '../../src/components/Head';\nimport Loader from '../../src/components/Loader';\nimport { connect } from 'react-redux';\nimport * as carritoActions from '../../store/actions/carritoActions';\nimport * as enviosActions from '../../store/actions/enviosActions';\nimport * as zonasActions from '../../store/actions/zonasActions';\nimport * as ventasActions from '../../store/actions/ventasActions';\nimport { useEffect, useState } from 'react';\nimport { API } from '../../config/index';\nimport Error from '../../src/components/Error';\n\nconst Swal = require('sweetalert2');\n\nconst {\n  traerProductos: carritoTraerProductos\n} = carritoActions;\nconst {\n  guardar: enviosGuardar\n} = enviosActions;\nconst {\n  seleccionar: zonasGuardar,\n  traerTodas: traerZonas\n} = zonasActions;\nconst {\n  init: inicializarStoreVenta,\n  setCostoEnvio: setDataEnvioEnVenta\n} = ventasActions;\n\nconst ProcesarVenta = props => {\n  const {\n    0: error,\n    1: setError\n  } = useState(false);\n  const {\n    carritoReducer,\n    ventaReducer,\n    carritoTraerProductos,\n    enviosGuardar,\n    zonasGuardar,\n    inicializarStoreVenta,\n    setDataEnvioEnVenta,\n    traerZonas,\n    payment_id,\n    status,\n    collection_id\n  } = props;\n  const {\n    usuario,\n    logueado\n  } = props.usuarioReducer;\n  const {\n    zonas,\n    zona\n  } = props.zonasReducer;\n  const {\n    idMedioPago,\n    tipoEnvio,\n    productos,\n    cantidad,\n    subtotal,\n    porcentaje_descuento,\n    descuento,\n    total\n  } = props.ventaReducer;\n  useEffect(() => {\n    if (status == 'approved') {\n      return traerZonas();\n    }\n\n    setError(true);\n  }, []);\n  useEffect(() => {\n    if (logueado && zonas.length > 0) {\n      const dataEnvio = JSON.parse(localStorage.getItem('dataEnvio'));\n      enviosGuardar(dataEnvio.tipo);\n      zonasGuardar(dataEnvio.zona);\n      carritoTraerProductos();\n    }\n  }, [logueado, zonas]);\n  useEffect(() => {\n    if (carritoReducer.productos.length > 0) {\n      inicializarStoreVenta();\n      setDataEnvioEnVenta();\n    }\n  }, [carritoReducer.productos]);\n  useEffect(() => {\n    if (!tipoEnvio || !productos.length || cantidad == 0 || total == 0) {\n      console.log('no se puede completar la operacion');\n      return;\n    }\n\n    const {\n      idUsuario\n    } = usuario;\n    let dataToRequest = {\n      envio: {\n        idZona: zona.idZona,\n        tipo: tipoEnvio\n      },\n      venta: {\n        subtotal,\n        porcentaje_descuento,\n        descuento,\n        total,\n        productos,\n        collection_id,\n        payment_id,\n        idMedioPago\n      },\n      usuario: {\n        idUsuario\n      }\n    };\n    console.log(dataToRequest); //registrarVenta(dataToRequest);\n  }, [ventaReducer]);\n\n  const registrarVenta = async data => {\n    try {\n      const headers = new Headers();\n      headers.append('token', usuario.token);\n      headers.append(\"Content-Type\", \"application/json\");\n      let url = `${API}/ventas/registrarVenta`;\n      const reqVenta = await fetch(url, {\n        headers,\n        method: 'POST',\n        body: JSON.stringify(data)\n      });\n\n      if (reqVenta.status == 200) {\n        localStorage.removeItem('dataEnvio');\n        localStorage.removeItem('carrito');\n        Swal.fire('Listo', 'Felicidades, tu compra se registró con éxito. En breve nos comunicaremos con usted para informarle el estado de su compra vía email.', 'success').then(() => window.location.assign('/'));\n      } else {\n        setError(true);\n      }\n    } catch (error) {\n      setError(error.message);\n    }\n  };\n\n  return error ? __jsx(Error, {\n    message: \"Ha ocurrido un error, intentalo mas tarde\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 17\n    }\n  }) : __jsx(React.Fragment, null, __jsx(Head, {\n    title: \"Finalizacion de compra\",\n    metadesc: \"\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 13\n    }\n  }), __jsx(\"div\", {\n    className: \"jsx-2063553454\" + \" \" + \"wrapper\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 13\n    }\n  }, __jsx(Loader, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 17\n    }\n  }), __jsx(\"p\", {\n    className: \"jsx-2063553454\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 17\n    }\n  }, \"Su compra esta siento procesada, aguarde unos segundos...\")), __jsx(_JSXStyle, {\n    id: \"2063553454\",\n    __self: this\n  }, \".wrapper.jsx-2063553454{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:90vh;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL2ZyYW5jby9kZXNhcnJvbGxvL3Byb3llY3RvX29saXZlci9vbGl2ZXItc2l0aW8vcGFnZXMvcHJvY2VzYXJWZW50YS9bWy4uLnBhcmFtc11dLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQStHd0IsQUFHaUMsMEVBQ1UsbUdBQ0osNkZBQ1AsWUFDVSw4RUFDekIiLCJmaWxlIjoiL2hvbWUvZnJhbmNvL2Rlc2Fycm9sbG8vcHJveWVjdG9fb2xpdmVyL29saXZlci1zaXRpby9wYWdlcy9wcm9jZXNhclZlbnRhL1tbLi4ucGFyYW1zXV0uanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgSGVhZCBmcm9tICcuLi8uLi9zcmMvY29tcG9uZW50cy9IZWFkJztcbmltcG9ydCBMb2FkZXIgZnJvbSAnLi4vLi4vc3JjL2NvbXBvbmVudHMvTG9hZGVyJztcbmltcG9ydCB7Y29ubmVjdH0gZnJvbSAncmVhY3QtcmVkdXgnO1xuaW1wb3J0ICogYXMgY2Fycml0b0FjdGlvbnMgZnJvbSAnLi4vLi4vc3RvcmUvYWN0aW9ucy9jYXJyaXRvQWN0aW9ucyc7XG5pbXBvcnQgKiBhcyBlbnZpb3NBY3Rpb25zIGZyb20gJy4uLy4uL3N0b3JlL2FjdGlvbnMvZW52aW9zQWN0aW9ucyc7XG5pbXBvcnQgKiBhcyB6b25hc0FjdGlvbnMgZnJvbSAnLi4vLi4vc3RvcmUvYWN0aW9ucy96b25hc0FjdGlvbnMnO1xuaW1wb3J0ICogYXMgdmVudGFzQWN0aW9ucyBmcm9tICcuLi8uLi9zdG9yZS9hY3Rpb25zL3ZlbnRhc0FjdGlvbnMnO1xuaW1wb3J0IHsgdXNlRWZmZWN0LCB1c2VTdGF0ZSB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7QVBJfSBmcm9tICcuLi8uLi9jb25maWcvaW5kZXgnO1xuaW1wb3J0IEVycm9yIGZyb20gJy4uLy4uL3NyYy9jb21wb25lbnRzL0Vycm9yJztcbmNvbnN0IFN3YWwgPSByZXF1aXJlKCdzd2VldGFsZXJ0MicpO1xuXG5jb25zdCB7dHJhZXJQcm9kdWN0b3M6Y2Fycml0b1RyYWVyUHJvZHVjdG9zfSA9IGNhcnJpdG9BY3Rpb25zO1xuY29uc3Qge2d1YXJkYXI6ZW52aW9zR3VhcmRhcn0gPSBlbnZpb3NBY3Rpb25zO1xuY29uc3Qge3NlbGVjY2lvbmFyOnpvbmFzR3VhcmRhcix0cmFlclRvZGFzOnRyYWVyWm9uYXN9ID0gem9uYXNBY3Rpb25zO1xuY29uc3Qge2luaXQ6aW5pY2lhbGl6YXJTdG9yZVZlbnRhLHNldENvc3RvRW52aW86c2V0RGF0YUVudmlvRW5WZW50YX0gPSB2ZW50YXNBY3Rpb25zO1xuXG5jb25zdCBQcm9jZXNhclZlbnRhID0gKHByb3BzKSA9PiB7XG4gICAgY29uc3QgW2Vycm9yLCBzZXRFcnJvcl0gPSB1c2VTdGF0ZShmYWxzZSk7XG4gICAgY29uc3Qge2NhcnJpdG9SZWR1Y2VyLHZlbnRhUmVkdWNlcixjYXJyaXRvVHJhZXJQcm9kdWN0b3MsZW52aW9zR3VhcmRhcix6b25hc0d1YXJkYXIsaW5pY2lhbGl6YXJTdG9yZVZlbnRhLHNldERhdGFFbnZpb0VuVmVudGEsdHJhZXJab25hcyxwYXltZW50X2lkLHN0YXR1cyxjb2xsZWN0aW9uX2lkfSA9IHByb3BzO1xuICAgIGNvbnN0IHt1c3VhcmlvLGxvZ3VlYWRvfSA9IHByb3BzLnVzdWFyaW9SZWR1Y2VyO1xuICAgIGNvbnN0IHt6b25hcyx6b25hfSA9IHByb3BzLnpvbmFzUmVkdWNlcjtcbiAgICBjb25zdCB7aWRNZWRpb1BhZ28sdGlwb0VudmlvLHByb2R1Y3RvcyxjYW50aWRhZCxzdWJ0b3RhbCxwb3JjZW50YWplX2Rlc2N1ZW50byxkZXNjdWVudG8sdG90YWx9ID0gcHJvcHMudmVudGFSZWR1Y2VyO1xuXG4gICAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAgICAgaWYoc3RhdHVzID09ICdhcHByb3ZlZCcpe1xuICAgICAgICAgICAgcmV0dXJuIHRyYWVyWm9uYXMoKTtcbiAgICAgICAgfVxuICAgICAgICBzZXRFcnJvcih0cnVlKTtcbiAgICB9LCBbXSlcblxuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICAgIGlmKGxvZ3VlYWRvICYmIHpvbmFzLmxlbmd0aD4wKXtcbiAgICAgICAgICAgIGNvbnN0IGRhdGFFbnZpbyA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2RhdGFFbnZpbycpKTtcbiAgICAgICAgICAgIGVudmlvc0d1YXJkYXIoZGF0YUVudmlvLnRpcG8pO1xuICAgICAgICAgICAgem9uYXNHdWFyZGFyKGRhdGFFbnZpby56b25hKTtcbiAgICAgICAgICAgIGNhcnJpdG9UcmFlclByb2R1Y3RvcygpO1xuICAgICAgICB9XG4gICAgfSwgW2xvZ3VlYWRvLHpvbmFzXSk7XG5cbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgICBpZihjYXJyaXRvUmVkdWNlci5wcm9kdWN0b3MubGVuZ3RoPjApe1xuICAgICAgICAgICAgaW5pY2lhbGl6YXJTdG9yZVZlbnRhKCk7XG4gICAgICAgICAgICBzZXREYXRhRW52aW9FblZlbnRhKCk7XG4gICAgICAgIH1cbiAgICB9LCBbY2Fycml0b1JlZHVjZXIucHJvZHVjdG9zXSk7XG5cbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgICBpZighdGlwb0VudmlvIHx8ICFwcm9kdWN0b3MubGVuZ3RoIHx8IGNhbnRpZGFkPT0wIHx8IHRvdGFsID09IDAgKXtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdubyBzZSBwdWVkZSBjb21wbGV0YXIgbGEgb3BlcmFjaW9uJyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qge2lkVXN1YXJpb30gPSB1c3VhcmlvO1xuICAgICAgICBsZXQgZGF0YVRvUmVxdWVzdCA9IHtcbiAgICAgICAgICAgIGVudmlvOntcbiAgICAgICAgICAgICAgICBpZFpvbmE6em9uYS5pZFpvbmEsXG4gICAgICAgICAgICAgICAgdGlwbzp0aXBvRW52aW9cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB2ZW50YTp7XG4gICAgICAgICAgICAgICAgc3VidG90YWwsXG4gICAgICAgICAgICAgICAgcG9yY2VudGFqZV9kZXNjdWVudG8sXG4gICAgICAgICAgICAgICAgZGVzY3VlbnRvLFxuICAgICAgICAgICAgICAgIHRvdGFsLFxuICAgICAgICAgICAgICAgIHByb2R1Y3RvcyxcbiAgICAgICAgICAgICAgICBjb2xsZWN0aW9uX2lkLFxuICAgICAgICAgICAgICAgIHBheW1lbnRfaWQsXG4gICAgICAgICAgICAgICAgaWRNZWRpb1BhZ29cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1c3VhcmlvOntcbiAgICAgICAgICAgICAgICBpZFVzdWFyaW9cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjb25zb2xlLmxvZyhkYXRhVG9SZXF1ZXN0KTtcbiAgICAgICAgLy9yZWdpc3RyYXJWZW50YShkYXRhVG9SZXF1ZXN0KTtcbiAgICB9LCBbdmVudGFSZWR1Y2VyXSlcbiAgICBcbiAgICBjb25zdCByZWdpc3RyYXJWZW50YSA9IGFzeW5jIGRhdGE9PntcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IGhlYWRlcnMgPSBuZXcgSGVhZGVycygpO1xuICAgICAgICAgICAgaGVhZGVycy5hcHBlbmQoJ3Rva2VuJyx1c3VhcmlvLnRva2VuKTtcbiAgICAgICAgICAgIGhlYWRlcnMuYXBwZW5kKFwiQ29udGVudC1UeXBlXCIsIFwiYXBwbGljYXRpb24vanNvblwiKTtcbiAgICAgICAgICAgIGxldCB1cmwgPSBgJHtBUEl9L3ZlbnRhcy9yZWdpc3RyYXJWZW50YWA7XG4gICAgICAgICAgICBjb25zdCByZXFWZW50YSA9IGF3YWl0IGZldGNoKHVybCx7XG4gICAgICAgICAgICAgICAgaGVhZGVycyxcbiAgICAgICAgICAgICAgICBtZXRob2Q6J1BPU1QnLFxuICAgICAgICAgICAgICAgIGJvZHk6SlNPTi5zdHJpbmdpZnkoZGF0YSlcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYocmVxVmVudGEuc3RhdHVzID09IDIwMCl7XG4gICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ2RhdGFFbnZpbycpO1xuICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdjYXJyaXRvJyk7XG4gICAgICAgICAgICAgICAgU3dhbC5maXJlKFxuICAgICAgICAgICAgICAgICAgICAnTGlzdG8nLFxuICAgICAgICAgICAgICAgICAgICAnRmVsaWNpZGFkZXMsIHR1IGNvbXByYSBzZSByZWdpc3Ryw7MgY29uIMOpeGl0by4gRW4gYnJldmUgbm9zIGNvbXVuaWNhcmVtb3MgY29uIHVzdGVkIHBhcmEgaW5mb3JtYXJsZSBlbCBlc3RhZG8gZGUgc3UgY29tcHJhIHbDrWEgZW1haWwuJyxcbiAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnXG4gICAgICAgICAgICAgICAgKS50aGVuKCgpPT53aW5kb3cubG9jYXRpb24uYXNzaWduKCcvJykpO1xuICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgc2V0RXJyb3IodHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBzZXRFcnJvcihlcnJvci5tZXNzYWdlKVxuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiAoXG4gICAgICAgIGVycm9yID8gPEVycm9yIG1lc3NhZ2U9XCJIYSBvY3VycmlkbyB1biBlcnJvciwgaW50ZW50YWxvIG1hcyB0YXJkZVwiLz46XG4gICAgICAgIDw+XG4gICAgICAgICAgICA8SGVhZCB0aXRsZT1cIkZpbmFsaXphY2lvbiBkZSBjb21wcmFcIiBtZXRhZGVzYz1cIlwiLz5cbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwid3JhcHBlclwiPlxuICAgICAgICAgICAgICAgIDxMb2FkZXIvPlxuICAgICAgICAgICAgICAgIDxwPlN1IGNvbXByYSBlc3RhIHNpZW50byBwcm9jZXNhZGEsIGFndWFyZGUgdW5vcyBzZWd1bmRvcy4uLjwvcD5cbiAgICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICAgICA8c3R5bGUganN4PntgXG4gICAgICAgICAgICAgICAgLndyYXBwZXJ7XG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6ZmxleDtcbiAgICAgICAgICAgICAgICAgICAganVzdGlmeS1jb250ZW50OmNlbnRlcjtcbiAgICAgICAgICAgICAgICAgICAgYWxpZ24taXRlbXM6Y2VudGVyO1xuICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6OTB2aDtcbiAgICAgICAgICAgICAgICAgICAgZmxleC1kaXJlY3Rpb246Y29sdW1uO1xuICAgICAgICAgICAgICAgIH0gICAgXG4gICAgICAgICAgICBgfTwvc3R5bGU+XG4gICAgICAgIDwvPlxuICAgICk7XG59XG5cblByb2Nlc2FyVmVudGEuZ2V0SW5pdGlhbFByb3BzID0gYXN5bmMoe3F1ZXJ5fSk9PntcbiAgICBjb25zdCB7Y29sbGVjdGlvbl9pZCxwYXltZW50X2lkLHN0YXR1c30gPSBxdWVyeTtcbiAgICByZXR1cm4ge2NvbGxlY3Rpb25faWQscGF5bWVudF9pZCxzdGF0dXN9O1xufVxuXG5jb25zdCBtYXBTdGF0ZVRvUHJvcHMgPSAoe2NhcnJpdG9SZWR1Y2VyLGVudmlvc1JlZHVjZXIsdXN1YXJpb1JlZHVjZXIsem9uYXNSZWR1Y2VyLHZlbnRhUmVkdWNlcn0pPT57XG4gICAgcmV0dXJuIHtjYXJyaXRvUmVkdWNlcixlbnZpb3NSZWR1Y2VyLHVzdWFyaW9SZWR1Y2VyLHpvbmFzUmVkdWNlcix2ZW50YVJlZHVjZXJ9XG59O1xuY29uc3QgbWFwRGlzcGF0Y2hUb1Byb3BzID0ge1xuICAgIGVudmlvc0d1YXJkYXIsXG4gICAgY2Fycml0b1RyYWVyUHJvZHVjdG9zLFxuICAgIHpvbmFzR3VhcmRhcixcbiAgICBzZXREYXRhRW52aW9FblZlbnRhLFxuICAgIGluaWNpYWxpemFyU3RvcmVWZW50YSxcbiAgICB0cmFlclpvbmFzXG59XG4gXG5leHBvcnQgZGVmYXVsdCBjb25uZWN0KG1hcFN0YXRlVG9Qcm9wcyxtYXBEaXNwYXRjaFRvUHJvcHMpKFByb2Nlc2FyVmVudGEpOyJdfQ== */\\n/*@ sourceURL=/home/franco/desarrollo/proyecto_oliver/oliver-sitio/pages/procesarVenta/[[...params]].js */\"));\n};\n\nProcesarVenta.getInitialProps = async ({\n  query\n}) => {\n  const {\n    collection_id,\n    payment_id,\n    status\n  } = query;\n  return {\n    collection_id,\n    payment_id,\n    status\n  };\n};\n\nconst mapStateToProps = ({\n  carritoReducer,\n  enviosReducer,\n  usuarioReducer,\n  zonasReducer,\n  ventaReducer\n}) => {\n  return {\n    carritoReducer,\n    enviosReducer,\n    usuarioReducer,\n    zonasReducer,\n    ventaReducer\n  };\n};\n\nconst mapDispatchToProps = {\n  enviosGuardar,\n  carritoTraerProductos,\n  zonasGuardar,\n  setDataEnvioEnVenta,\n  inicializarStoreVenta,\n  traerZonas\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(ProcesarVenta);","map":{"version":3,"sources":["/home/franco/desarrollo/proyecto_oliver/oliver-sitio/pages/procesarVenta/[[...params]].js"],"names":["Head","Loader","connect","carritoActions","enviosActions","zonasActions","ventasActions","useEffect","useState","API","Error","Swal","require","traerProductos","carritoTraerProductos","guardar","enviosGuardar","seleccionar","zonasGuardar","traerTodas","traerZonas","init","inicializarStoreVenta","setCostoEnvio","setDataEnvioEnVenta","ProcesarVenta","props","error","setError","carritoReducer","ventaReducer","payment_id","status","collection_id","usuario","logueado","usuarioReducer","zonas","zona","zonasReducer","idMedioPago","tipoEnvio","productos","cantidad","subtotal","porcentaje_descuento","descuento","total","length","dataEnvio","JSON","parse","localStorage","getItem","tipo","console","log","idUsuario","dataToRequest","envio","idZona","venta","registrarVenta","data","headers","Headers","append","token","url","reqVenta","fetch","method","body","stringify","removeItem","fire","then","window","location","assign","message","getInitialProps","query","mapStateToProps","enviosReducer","mapDispatchToProps"],"mappings":"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","sourcesContent":["import Head from '../../src/components/Head';\nimport Loader from '../../src/components/Loader';\nimport {connect} from 'react-redux';\nimport * as carritoActions from '../../store/actions/carritoActions';\nimport * as enviosActions from '../../store/actions/enviosActions';\nimport * as zonasActions from '../../store/actions/zonasActions';\nimport * as ventasActions from '../../store/actions/ventasActions';\nimport { useEffect, useState } from 'react';\nimport {API} from '../../config/index';\nimport Error from '../../src/components/Error';\nconst Swal = require('sweetalert2');\n\nconst {traerProductos:carritoTraerProductos} = carritoActions;\nconst {guardar:enviosGuardar} = enviosActions;\nconst {seleccionar:zonasGuardar,traerTodas:traerZonas} = zonasActions;\nconst {init:inicializarStoreVenta,setCostoEnvio:setDataEnvioEnVenta} = ventasActions;\n\nconst ProcesarVenta = (props) => {\n    const [error, setError] = useState(false);\n    const {carritoReducer,ventaReducer,carritoTraerProductos,enviosGuardar,zonasGuardar,inicializarStoreVenta,setDataEnvioEnVenta,traerZonas,payment_id,status,collection_id} = props;\n    const {usuario,logueado} = props.usuarioReducer;\n    const {zonas,zona} = props.zonasReducer;\n    const {idMedioPago,tipoEnvio,productos,cantidad,subtotal,porcentaje_descuento,descuento,total} = props.ventaReducer;\n\n    useEffect(() => {\n        if(status == 'approved'){\n            return traerZonas();\n        }\n        setError(true);\n    }, [])\n\n    useEffect(() => {\n        if(logueado && zonas.length>0){\n            const dataEnvio = JSON.parse(localStorage.getItem('dataEnvio'));\n            enviosGuardar(dataEnvio.tipo);\n            zonasGuardar(dataEnvio.zona);\n            carritoTraerProductos();\n        }\n    }, [logueado,zonas]);\n\n    useEffect(() => {\n        if(carritoReducer.productos.length>0){\n            inicializarStoreVenta();\n            setDataEnvioEnVenta();\n        }\n    }, [carritoReducer.productos]);\n\n    useEffect(() => {\n        if(!tipoEnvio || !productos.length || cantidad==0 || total == 0 ){\n            console.log('no se puede completar la operacion');\n            return;\n        }\n        const {idUsuario} = usuario;\n        let dataToRequest = {\n            envio:{\n                idZona:zona.idZona,\n                tipo:tipoEnvio\n            },\n            venta:{\n                subtotal,\n                porcentaje_descuento,\n                descuento,\n                total,\n                productos,\n                collection_id,\n                payment_id,\n                idMedioPago\n            },\n            usuario:{\n                idUsuario\n            }\n        }\n        console.log(dataToRequest);\n        //registrarVenta(dataToRequest);\n    }, [ventaReducer])\n    \n    const registrarVenta = async data=>{\n        try {\n            const headers = new Headers();\n            headers.append('token',usuario.token);\n            headers.append(\"Content-Type\", \"application/json\");\n            let url = `${API}/ventas/registrarVenta`;\n            const reqVenta = await fetch(url,{\n                headers,\n                method:'POST',\n                body:JSON.stringify(data)\n            });\n            if(reqVenta.status == 200){\n                localStorage.removeItem('dataEnvio');\n                localStorage.removeItem('carrito');\n                Swal.fire(\n                    'Listo',\n                    'Felicidades, tu compra se registró con éxito. En breve nos comunicaremos con usted para informarle el estado de su compra vía email.',\n                    'success'\n                ).then(()=>window.location.assign('/'));\n            }else{\n                setError(true);\n            }\n        } catch (error) {\n            setError(error.message)\n        }\n    }\n    return (\n        error ? <Error message=\"Ha ocurrido un error, intentalo mas tarde\"/>:\n        <>\n            <Head title=\"Finalizacion de compra\" metadesc=\"\"/>\n            <div className=\"wrapper\">\n                <Loader/>\n                <p>Su compra esta siento procesada, aguarde unos segundos...</p>\n            </div>\n\n            <style jsx>{`\n                .wrapper{\n                    display:flex;\n                    justify-content:center;\n                    align-items:center;\n                    height:90vh;\n                    flex-direction:column;\n                }    \n            `}</style>\n        </>\n    );\n}\n\nProcesarVenta.getInitialProps = async({query})=>{\n    const {collection_id,payment_id,status} = query;\n    return {collection_id,payment_id,status};\n}\n\nconst mapStateToProps = ({carritoReducer,enviosReducer,usuarioReducer,zonasReducer,ventaReducer})=>{\n    return {carritoReducer,enviosReducer,usuarioReducer,zonasReducer,ventaReducer}\n};\nconst mapDispatchToProps = {\n    enviosGuardar,\n    carritoTraerProductos,\n    zonasGuardar,\n    setDataEnvioEnVenta,\n    inicializarStoreVenta,\n    traerZonas\n}\n \nexport default connect(mapStateToProps,mapDispatchToProps)(ProcesarVenta);"]},"metadata":{},"sourceType":"module"}