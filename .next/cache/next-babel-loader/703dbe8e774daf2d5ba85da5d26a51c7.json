{"ast":null,"code":"var _jsxFileName = \"/home/franco/desarrollo/proyecto_oliver/oliver-web-next/pages/procesarVenta/[[...params]].js\";\nimport _JSXStyle from \"styled-jsx/style\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport Head from '../../src/components/Head';\nimport Loader from '../../src/components/Loader';\nimport { connect } from 'react-redux';\nimport * as carritoActions from '../../store/actions/carritoActions';\nimport * as enviosActions from '../../store/actions/enviosActions';\nimport * as zonasActions from '../../store/actions/zonasActions';\nimport * as ventasActions from '../../store/actions/ventasActions';\nimport { useEffect, useState } from 'react';\nimport { API } from '../../config/index';\nimport Error from '../../src/components/Error';\n\nconst Swal = require('sweetalert2');\n\nconst {\n  traerProductos: carritoTraerProductos\n} = carritoActions;\nconst {\n  guardar: enviosGuardar\n} = enviosActions;\nconst {\n  seleccionar: zonasGuardar,\n  traerTodas: traerZonas\n} = zonasActions;\nconst {\n  init: inicializarStoreVenta,\n  setCostoEnvio: setDataEnvioEnVenta\n} = ventasActions;\n\nconst ProcesarVenta = props => {\n  const {\n    0: error,\n    1: setError\n  } = useState(false);\n  const {\n    0: ventaRegistrada,\n    1: setVentaRegistrada\n  } = useState(false);\n  const {\n    usuario,\n    logueado\n  } = props.usuarioReducer;\n  const {\n    zonas\n  } = props.zonasReducer;\n  const {\n    carritoTraerProductos,\n    enviosGuardar,\n    zonasGuardar,\n    inicializarStoreVenta,\n    setDataEnvioEnVenta,\n    traerZonas\n  } = props;\n  useEffect(() => {\n    traerZonas();\n  }, []);\n  useEffect(() => {\n    if (zonas.length > 0) {\n      const dataEnvio = JSON.parse(localStorage.getItem('dataEnvio'));\n      enviosGuardar(dataEnvio.tipo);\n      zonasGuardar(dataEnvio.zona);\n      carritoTraerProductos();\n    }\n  }, [props.usuarioReducer]);\n  useEffect(() => {\n    if (props.carritoReducer.productos.length > 0) {\n      inicializarStoreVenta();\n      setDataEnvioEnVenta();\n    }\n  }, [props.carritoReducer.productos]);\n\n  const procesarInfo = async () => {\n    const dataEnvio = JSON.parse(localStorage.getItem('dataEnvio'));\n    props.enviosGuardar(dataEnvio);\n    props.carritoTraerProductos();\n\n    if (props.usuarioReducer.logueado && props.carritoReducer.productos.length > 0 && props.enviosReducer.data) {\n      const {\n        idUsuario\n      } = props.usuarioReducer.usuario;\n      const {\n        subtotal,\n        porcentaje_descuento,\n        descuento,\n        total,\n        productos,\n        idMedioPago\n      } = props.carritoReducer;\n      const {\n        zona,\n        tipo\n      } = props.enviosReducer.data;\n      let f = new Date();\n      let mes = f.getMonth() < 10 ? `0${f.getMonth() + 1}` : `${f.getMonth()}`;\n      let dia = f.getDate() < 10 ? `0${f.getDate()}` : `${f.getDate()}`;\n      let fecha = `${f.getFullYear()}-${mes}-${dia}`;\n      let dataToRequest = {\n        envio: {\n          idZona: zona,\n          tipo: tipo\n        },\n        venta: {\n          subtotal,\n          porcentaje_descuento,\n          descuento,\n          total,\n          idUsuario,\n          productos,\n          fecha,\n          operacion_id: props.collection_id || null,\n          idMedioPago\n        }\n      }; //console.log(dataToRequest);\n\n      return registrarVenta(dataToRequest);\n    }\n  };\n\n  const registrarVenta = async data => {\n    try {\n      const headers = new Headers();\n      headers.append('token', props.usuarioReducer.usuario.token);\n      headers.append(\"Content-Type\", \"application/json\");\n      let url = !data.venta.operacion_id ? `${API}/registrarVenta?mercadoPago=false` : `${API}/registrarVenta?mercadoPago=true`;\n      const reqVenta = await fetch(url, {\n        headers,\n        method: 'POST',\n        body: JSON.stringify(data)\n      });\n\n      if (reqVenta.status == 200) {\n        localStorage.removeItem('dataEnvio');\n        localStorage.removeItem('carrito');\n        Swal.fire('Listo', 'Felicidades, tu compra se registró con éxito. En breve nos comunicaremos con usted para informarle el estado de su compra vía email.', 'success').then(() => window.location.assign('/'));\n      } else {\n        setError(true);\n      }\n    } catch (error) {\n      setError(error.message);\n    }\n  };\n\n  console.log(logueado);\n  return __jsx(React.Fragment, null, __jsx(Head, {\n    title: \"Finalizacion de compra\",\n    metadesc: \"\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 13\n    }\n  }), __jsx(\"div\", {\n    className: \"jsx-2063553454\" + \" \" + \"wrapper\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 13\n    }\n  }, __jsx(Loader, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 17\n    }\n  }), __jsx(\"p\", {\n    className: \"jsx-2063553454\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 17\n    }\n  }, \"Su compra esta siento procesada, aguarde unos segundos...\")), __jsx(_JSXStyle, {\n    id: \"2063553454\",\n    __self: this\n  }, \".wrapper.jsx-2063553454{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:90vh;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL2ZyYW5jby9kZXNhcnJvbGxvL3Byb3llY3RvX29saXZlci9vbGl2ZXItd2ViLW5leHQvcGFnZXMvcHJvY2VzYXJWZW50YS9bWy4uLnBhcmFtc11dLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQTJId0IsQUFHaUMsMEVBQ1UsbUdBQ0osNkZBQ1AsWUFDVSw4RUFDekIiLCJmaWxlIjoiL2hvbWUvZnJhbmNvL2Rlc2Fycm9sbG8vcHJveWVjdG9fb2xpdmVyL29saXZlci13ZWItbmV4dC9wYWdlcy9wcm9jZXNhclZlbnRhL1tbLi4ucGFyYW1zXV0uanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgSGVhZCBmcm9tICcuLi8uLi9zcmMvY29tcG9uZW50cy9IZWFkJztcbmltcG9ydCBMb2FkZXIgZnJvbSAnLi4vLi4vc3JjL2NvbXBvbmVudHMvTG9hZGVyJztcbmltcG9ydCB7Y29ubmVjdH0gZnJvbSAncmVhY3QtcmVkdXgnO1xuaW1wb3J0ICogYXMgY2Fycml0b0FjdGlvbnMgZnJvbSAnLi4vLi4vc3RvcmUvYWN0aW9ucy9jYXJyaXRvQWN0aW9ucyc7XG5pbXBvcnQgKiBhcyBlbnZpb3NBY3Rpb25zIGZyb20gJy4uLy4uL3N0b3JlL2FjdGlvbnMvZW52aW9zQWN0aW9ucyc7XG5pbXBvcnQgKiBhcyB6b25hc0FjdGlvbnMgZnJvbSAnLi4vLi4vc3RvcmUvYWN0aW9ucy96b25hc0FjdGlvbnMnO1xuaW1wb3J0ICogYXMgdmVudGFzQWN0aW9ucyBmcm9tICcuLi8uLi9zdG9yZS9hY3Rpb25zL3ZlbnRhc0FjdGlvbnMnO1xuaW1wb3J0IHsgdXNlRWZmZWN0LCB1c2VTdGF0ZSB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7QVBJfSBmcm9tICcuLi8uLi9jb25maWcvaW5kZXgnO1xuaW1wb3J0IEVycm9yIGZyb20gJy4uLy4uL3NyYy9jb21wb25lbnRzL0Vycm9yJztcbmNvbnN0IFN3YWwgPSByZXF1aXJlKCdzd2VldGFsZXJ0MicpO1xuXG5jb25zdCB7dHJhZXJQcm9kdWN0b3M6Y2Fycml0b1RyYWVyUHJvZHVjdG9zfSA9IGNhcnJpdG9BY3Rpb25zO1xuY29uc3Qge2d1YXJkYXI6ZW52aW9zR3VhcmRhcn0gPSBlbnZpb3NBY3Rpb25zO1xuY29uc3Qge3NlbGVjY2lvbmFyOnpvbmFzR3VhcmRhcix0cmFlclRvZGFzOnRyYWVyWm9uYXN9ID0gem9uYXNBY3Rpb25zO1xuY29uc3Qge2luaXQ6aW5pY2lhbGl6YXJTdG9yZVZlbnRhLHNldENvc3RvRW52aW86c2V0RGF0YUVudmlvRW5WZW50YX0gPSB2ZW50YXNBY3Rpb25zO1xuXG5jb25zdCBQcm9jZXNhclZlbnRhID0gKHByb3BzKSA9PiB7XG4gICAgY29uc3QgW2Vycm9yLCBzZXRFcnJvcl0gPSB1c2VTdGF0ZShmYWxzZSk7XG4gICAgY29uc3QgW3ZlbnRhUmVnaXN0cmFkYSwgc2V0VmVudGFSZWdpc3RyYWRhXSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgICBjb25zdCB7dXN1YXJpbyxsb2d1ZWFkb30gPSBwcm9wcy51c3VhcmlvUmVkdWNlcjtcbiAgICBjb25zdCB7em9uYXN9ID0gcHJvcHMuem9uYXNSZWR1Y2VyO1xuICAgIGNvbnN0IHtjYXJyaXRvVHJhZXJQcm9kdWN0b3MsZW52aW9zR3VhcmRhcix6b25hc0d1YXJkYXIsaW5pY2lhbGl6YXJTdG9yZVZlbnRhLHNldERhdGFFbnZpb0VuVmVudGEsdHJhZXJab25hc30gPSBwcm9wcztcblxuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICAgIHRyYWVyWm9uYXMoKTtcbiAgICB9LCBbXSlcblxuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICAgIGlmKHpvbmFzLmxlbmd0aD4wKXtcbiAgICAgICAgICAgIGNvbnN0IGRhdGFFbnZpbyA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2RhdGFFbnZpbycpKTtcbiAgICAgICAgICAgIGVudmlvc0d1YXJkYXIoZGF0YUVudmlvLnRpcG8pO1xuICAgICAgICAgICAgem9uYXNHdWFyZGFyKGRhdGFFbnZpby56b25hKTtcbiAgICAgICAgICAgIGNhcnJpdG9UcmFlclByb2R1Y3RvcygpO1xuICAgICAgICB9XG4gICAgfSwgW3Byb3BzLnVzdWFyaW9SZWR1Y2VyXSk7XG5cbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgICBpZihwcm9wcy5jYXJyaXRvUmVkdWNlci5wcm9kdWN0b3MubGVuZ3RoPjApe1xuICAgICAgICAgICAgaW5pY2lhbGl6YXJTdG9yZVZlbnRhKCk7XG4gICAgICAgICAgICBzZXREYXRhRW52aW9FblZlbnRhKCk7XG4gICAgICAgIH1cbiAgICB9LCBbcHJvcHMuY2Fycml0b1JlZHVjZXIucHJvZHVjdG9zXSlcbiAgICBcbiAgICBjb25zdCBwcm9jZXNhckluZm8gPSBhc3luYygpPT57XG4gICAgICAgIGNvbnN0IGRhdGFFbnZpbyA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2RhdGFFbnZpbycpKTtcbiAgICAgICAgcHJvcHMuZW52aW9zR3VhcmRhcihkYXRhRW52aW8pO1xuICAgICAgICBwcm9wcy5jYXJyaXRvVHJhZXJQcm9kdWN0b3MoKTtcbiAgICAgICAgaWYocHJvcHMudXN1YXJpb1JlZHVjZXIubG9ndWVhZG8gJiYgcHJvcHMuY2Fycml0b1JlZHVjZXIucHJvZHVjdG9zLmxlbmd0aD4wICYmIHByb3BzLmVudmlvc1JlZHVjZXIuZGF0YSl7XG4gICAgICAgICAgICBjb25zdCB7aWRVc3VhcmlvfSA9IHByb3BzLnVzdWFyaW9SZWR1Y2VyLnVzdWFyaW87XG4gICAgICAgICAgICBjb25zdCB7c3VidG90YWwscG9yY2VudGFqZV9kZXNjdWVudG8sZGVzY3VlbnRvLHRvdGFsLHByb2R1Y3RvcyxpZE1lZGlvUGFnb30gPSBwcm9wcy5jYXJyaXRvUmVkdWNlcjtcbiAgICAgICAgICAgIGNvbnN0IHt6b25hLHRpcG99ID0gcHJvcHMuZW52aW9zUmVkdWNlci5kYXRhO1xuICAgICAgICAgICAgbGV0IGYgPSBuZXcgRGF0ZSgpO1xuICAgICAgICAgICAgbGV0IG1lcyA9ICgoZi5nZXRNb250aCgpKTwxMCk/YDAke2YuZ2V0TW9udGgoKSsxfWA6YCR7Zi5nZXRNb250aCgpfWA7XG4gICAgICAgICAgICBsZXQgZGlhID0gKChmLmdldERhdGUoKSk8MTApP2AwJHtmLmdldERhdGUoKX1gOmAke2YuZ2V0RGF0ZSgpfWA7XG4gICAgICAgICAgICBsZXQgZmVjaGEgPSBgJHtmLmdldEZ1bGxZZWFyKCl9LSR7bWVzfS0ke2RpYX1gO1xuICAgICAgICAgICAgbGV0IGRhdGFUb1JlcXVlc3QgPSB7XG4gICAgICAgICAgICAgICAgZW52aW86e1xuICAgICAgICAgICAgICAgICAgICBpZFpvbmE6em9uYSxcbiAgICAgICAgICAgICAgICAgICAgdGlwbzp0aXBvXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB2ZW50YTp7XG4gICAgICAgICAgICAgICAgICAgIHN1YnRvdGFsLFxuICAgICAgICAgICAgICAgICAgICBwb3JjZW50YWplX2Rlc2N1ZW50byxcbiAgICAgICAgICAgICAgICAgICAgZGVzY3VlbnRvLFxuICAgICAgICAgICAgICAgICAgICB0b3RhbCxcbiAgICAgICAgICAgICAgICAgICAgaWRVc3VhcmlvLFxuICAgICAgICAgICAgICAgICAgICBwcm9kdWN0b3MsXG4gICAgICAgICAgICAgICAgICAgIGZlY2hhLFxuICAgICAgICAgICAgICAgICAgICBvcGVyYWNpb25faWQ6cHJvcHMuY29sbGVjdGlvbl9pZCB8fCBudWxsLFxuICAgICAgICAgICAgICAgICAgICBpZE1lZGlvUGFnb1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vY29uc29sZS5sb2coZGF0YVRvUmVxdWVzdCk7XG4gICAgICAgICAgICByZXR1cm4gcmVnaXN0cmFyVmVudGEoZGF0YVRvUmVxdWVzdCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCByZWdpc3RyYXJWZW50YSA9IGFzeW5jIGRhdGE9PntcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IGhlYWRlcnMgPSBuZXcgSGVhZGVycygpO1xuICAgICAgICAgICAgaGVhZGVycy5hcHBlbmQoJ3Rva2VuJyxwcm9wcy51c3VhcmlvUmVkdWNlci51c3VhcmlvLnRva2VuKTtcbiAgICAgICAgICAgIGhlYWRlcnMuYXBwZW5kKFwiQ29udGVudC1UeXBlXCIsIFwiYXBwbGljYXRpb24vanNvblwiKTtcbiAgICAgICAgICAgIGxldCB1cmwgPSAoIWRhdGEudmVudGEub3BlcmFjaW9uX2lkKT9gJHtBUEl9L3JlZ2lzdHJhclZlbnRhP21lcmNhZG9QYWdvPWZhbHNlYDpgJHtBUEl9L3JlZ2lzdHJhclZlbnRhP21lcmNhZG9QYWdvPXRydWVgO1xuICAgICAgICAgICAgY29uc3QgcmVxVmVudGEgPSBhd2FpdCBmZXRjaCh1cmwse1xuICAgICAgICAgICAgICAgIGhlYWRlcnMsXG4gICAgICAgICAgICAgICAgbWV0aG9kOidQT1NUJyxcbiAgICAgICAgICAgICAgICBib2R5OkpTT04uc3RyaW5naWZ5KGRhdGEpXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmKHJlcVZlbnRhLnN0YXR1cyA9PSAyMDApe1xuICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdkYXRhRW52aW8nKTtcbiAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgnY2Fycml0bycpO1xuICAgICAgICAgICAgICAgIFN3YWwuZmlyZShcbiAgICAgICAgICAgICAgICAgICAgJ0xpc3RvJyxcbiAgICAgICAgICAgICAgICAgICAgJ0ZlbGljaWRhZGVzLCB0dSBjb21wcmEgc2UgcmVnaXN0csOzIGNvbiDDqXhpdG8uIEVuIGJyZXZlIG5vcyBjb211bmljYXJlbW9zIGNvbiB1c3RlZCBwYXJhIGluZm9ybWFybGUgZWwgZXN0YWRvIGRlIHN1IGNvbXByYSB2w61hIGVtYWlsLicsXG4gICAgICAgICAgICAgICAgICAgICdzdWNjZXNzJ1xuICAgICAgICAgICAgICAgICkudGhlbigoKT0+d2luZG93LmxvY2F0aW9uLmFzc2lnbignLycpKTtcbiAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgIHNldEVycm9yKHRydWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgc2V0RXJyb3IoZXJyb3IubWVzc2FnZSlcbiAgICAgICAgfVxuICAgIH1cbiAgICBjb25zb2xlLmxvZyhsb2d1ZWFkbyk7XG4gICAgcmV0dXJuIChcbiAgICAgICAgPD5cbiAgICAgICAgICAgIDxIZWFkIHRpdGxlPVwiRmluYWxpemFjaW9uIGRlIGNvbXByYVwiIG1ldGFkZXNjPVwiXCIvPlxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJ3cmFwcGVyXCI+XG4gICAgICAgICAgICAgICAgPExvYWRlci8+XG4gICAgICAgICAgICAgICAgPHA+U3UgY29tcHJhIGVzdGEgc2llbnRvIHByb2Nlc2FkYSwgYWd1YXJkZSB1bm9zIHNlZ3VuZG9zLi4uPC9wPlxuICAgICAgICAgICAgICAgIHsvKiB7KHByb3BzLmVudmlvc1JlZHVjZXIuZXJyb3IgfHwgcHJvcHMuY2Fycml0b1JlZHVjZXIuZXJyb3IgfHwgZXJyb3IpPzxFcnJvciBtZXNzYWdlPVwiSGEgb2N1cnJpZG8gdW4gZXJyb3IsIGludGVudGFsbyBtYXMgdGFyZGVcIi8+OlxuICAgICAgICAgICAgICAgICAgICA8PlxuICAgICAgICAgICAgICAgICAgICAgICAgeyh2ZW50YVJlZ2lzdHJhZGEpPzxkaXYgY2xhc3NOYW1lPVwiYWxlcnQgYWxlcnQtc3VjY2Vzc1wiPnt2ZW50YVJlZ2lzdHJhZGF9PC9kaXY+OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDw+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxMb2FkZXIvPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cD5TdSBjb21wcmEgZXN0YSBzaWVudG8gcHJvY2VzYWRhLCBhZ3VhcmRlIHVub3Mgc2VndW5kb3MuLi48L3A+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC8+XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIDwvPlxuICAgICAgICAgICAgICAgIH0gKi99XG4gICAgICAgICAgICA8L2Rpdj5cblxuICAgICAgICAgICAgPHN0eWxlIGpzeD57YFxuICAgICAgICAgICAgICAgIC53cmFwcGVye1xuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OmZsZXg7XG4gICAgICAgICAgICAgICAgICAgIGp1c3RpZnktY29udGVudDpjZW50ZXI7XG4gICAgICAgICAgICAgICAgICAgIGFsaWduLWl0ZW1zOmNlbnRlcjtcbiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0Ojkwdmg7XG4gICAgICAgICAgICAgICAgICAgIGZsZXgtZGlyZWN0aW9uOmNvbHVtbjtcbiAgICAgICAgICAgICAgICB9ICAgIFxuICAgICAgICAgICAgYH08L3N0eWxlPlxuICAgICAgICA8Lz5cbiAgICApO1xufVxuXG5Qcm9jZXNhclZlbnRhLmdldEluaXRpYWxQcm9wcyA9IGFzeW5jKHtxdWVyeX0pPT57XG4gICAgY29uc3Qge2NvbGxlY3Rpb25faWR9ID0gcXVlcnk7XG4gICAgcmV0dXJuIHtjb2xsZWN0aW9uX2lkfTtcbn1cblxuY29uc3QgbWFwU3RhdGVUb1Byb3BzID0gKHtjYXJyaXRvUmVkdWNlcixlbnZpb3NSZWR1Y2VyLHVzdWFyaW9SZWR1Y2VyLHpvbmFzUmVkdWNlcn0pPT57XG4gICAgcmV0dXJuIHtjYXJyaXRvUmVkdWNlcixlbnZpb3NSZWR1Y2VyLHVzdWFyaW9SZWR1Y2VyLHpvbmFzUmVkdWNlcn1cbn07XG5jb25zdCBtYXBEaXNwYXRjaFRvUHJvcHMgPSB7XG4gICAgZW52aW9zR3VhcmRhcixcbiAgICBjYXJyaXRvVHJhZXJQcm9kdWN0b3MsXG4gICAgem9uYXNHdWFyZGFyLFxuICAgIHNldERhdGFFbnZpb0VuVmVudGEsXG4gICAgaW5pY2lhbGl6YXJTdG9yZVZlbnRhLFxuICAgIHRyYWVyWm9uYXNcbn1cbiBcbmV4cG9ydCBkZWZhdWx0IGNvbm5lY3QobWFwU3RhdGVUb1Byb3BzLG1hcERpc3BhdGNoVG9Qcm9wcykoUHJvY2VzYXJWZW50YSk7Il19 */\\n/*@ sourceURL=/home/franco/desarrollo/proyecto_oliver/oliver-web-next/pages/procesarVenta/[[...params]].js */\"));\n};\n\nProcesarVenta.getInitialProps = async ({\n  query\n}) => {\n  const {\n    collection_id\n  } = query;\n  return {\n    collection_id\n  };\n};\n\nconst mapStateToProps = ({\n  carritoReducer,\n  enviosReducer,\n  usuarioReducer,\n  zonasReducer\n}) => {\n  return {\n    carritoReducer,\n    enviosReducer,\n    usuarioReducer,\n    zonasReducer\n  };\n};\n\nconst mapDispatchToProps = {\n  enviosGuardar,\n  carritoTraerProductos,\n  zonasGuardar,\n  setDataEnvioEnVenta,\n  inicializarStoreVenta,\n  traerZonas\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(ProcesarVenta);","map":{"version":3,"sources":["/home/franco/desarrollo/proyecto_oliver/oliver-web-next/pages/procesarVenta/[[...params]].js"],"names":["Head","Loader","connect","carritoActions","enviosActions","zonasActions","ventasActions","useEffect","useState","API","Error","Swal","require","traerProductos","carritoTraerProductos","guardar","enviosGuardar","seleccionar","zonasGuardar","traerTodas","traerZonas","init","inicializarStoreVenta","setCostoEnvio","setDataEnvioEnVenta","ProcesarVenta","props","error","setError","ventaRegistrada","setVentaRegistrada","usuario","logueado","usuarioReducer","zonas","zonasReducer","length","dataEnvio","JSON","parse","localStorage","getItem","tipo","zona","carritoReducer","productos","procesarInfo","enviosReducer","data","idUsuario","subtotal","porcentaje_descuento","descuento","total","idMedioPago","f","Date","mes","getMonth","dia","getDate","fecha","getFullYear","dataToRequest","envio","idZona","venta","operacion_id","collection_id","registrarVenta","headers","Headers","append","token","url","reqVenta","fetch","method","body","stringify","status","removeItem","fire","then","window","location","assign","message","console","log","getInitialProps","query","mapStateToProps","mapDispatchToProps"],"mappings":"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","sourcesContent":["import Head from '../../src/components/Head';\nimport Loader from '../../src/components/Loader';\nimport {connect} from 'react-redux';\nimport * as carritoActions from '../../store/actions/carritoActions';\nimport * as enviosActions from '../../store/actions/enviosActions';\nimport * as zonasActions from '../../store/actions/zonasActions';\nimport * as ventasActions from '../../store/actions/ventasActions';\nimport { useEffect, useState } from 'react';\nimport {API} from '../../config/index';\nimport Error from '../../src/components/Error';\nconst Swal = require('sweetalert2');\n\nconst {traerProductos:carritoTraerProductos} = carritoActions;\nconst {guardar:enviosGuardar} = enviosActions;\nconst {seleccionar:zonasGuardar,traerTodas:traerZonas} = zonasActions;\nconst {init:inicializarStoreVenta,setCostoEnvio:setDataEnvioEnVenta} = ventasActions;\n\nconst ProcesarVenta = (props) => {\n    const [error, setError] = useState(false);\n    const [ventaRegistrada, setVentaRegistrada] = useState(false);\n    const {usuario,logueado} = props.usuarioReducer;\n    const {zonas} = props.zonasReducer;\n    const {carritoTraerProductos,enviosGuardar,zonasGuardar,inicializarStoreVenta,setDataEnvioEnVenta,traerZonas} = props;\n\n    useEffect(() => {\n        traerZonas();\n    }, [])\n\n    useEffect(() => {\n        if(zonas.length>0){\n            const dataEnvio = JSON.parse(localStorage.getItem('dataEnvio'));\n            enviosGuardar(dataEnvio.tipo);\n            zonasGuardar(dataEnvio.zona);\n            carritoTraerProductos();\n        }\n    }, [props.usuarioReducer]);\n\n    useEffect(() => {\n        if(props.carritoReducer.productos.length>0){\n            inicializarStoreVenta();\n            setDataEnvioEnVenta();\n        }\n    }, [props.carritoReducer.productos])\n    \n    const procesarInfo = async()=>{\n        const dataEnvio = JSON.parse(localStorage.getItem('dataEnvio'));\n        props.enviosGuardar(dataEnvio);\n        props.carritoTraerProductos();\n        if(props.usuarioReducer.logueado && props.carritoReducer.productos.length>0 && props.enviosReducer.data){\n            const {idUsuario} = props.usuarioReducer.usuario;\n            const {subtotal,porcentaje_descuento,descuento,total,productos,idMedioPago} = props.carritoReducer;\n            const {zona,tipo} = props.enviosReducer.data;\n            let f = new Date();\n            let mes = ((f.getMonth())<10)?`0${f.getMonth()+1}`:`${f.getMonth()}`;\n            let dia = ((f.getDate())<10)?`0${f.getDate()}`:`${f.getDate()}`;\n            let fecha = `${f.getFullYear()}-${mes}-${dia}`;\n            let dataToRequest = {\n                envio:{\n                    idZona:zona,\n                    tipo:tipo\n                },\n                venta:{\n                    subtotal,\n                    porcentaje_descuento,\n                    descuento,\n                    total,\n                    idUsuario,\n                    productos,\n                    fecha,\n                    operacion_id:props.collection_id || null,\n                    idMedioPago\n                }\n            }\n            //console.log(dataToRequest);\n            return registrarVenta(dataToRequest);\n        }\n    }\n\n    const registrarVenta = async data=>{\n        try {\n            const headers = new Headers();\n            headers.append('token',props.usuarioReducer.usuario.token);\n            headers.append(\"Content-Type\", \"application/json\");\n            let url = (!data.venta.operacion_id)?`${API}/registrarVenta?mercadoPago=false`:`${API}/registrarVenta?mercadoPago=true`;\n            const reqVenta = await fetch(url,{\n                headers,\n                method:'POST',\n                body:JSON.stringify(data)\n            });\n            if(reqVenta.status == 200){\n                localStorage.removeItem('dataEnvio');\n                localStorage.removeItem('carrito');\n                Swal.fire(\n                    'Listo',\n                    'Felicidades, tu compra se registró con éxito. En breve nos comunicaremos con usted para informarle el estado de su compra vía email.',\n                    'success'\n                ).then(()=>window.location.assign('/'));\n            }else{\n                setError(true);\n            }\n        } catch (error) {\n            setError(error.message)\n        }\n    }\n    console.log(logueado);\n    return (\n        <>\n            <Head title=\"Finalizacion de compra\" metadesc=\"\"/>\n            <div className=\"wrapper\">\n                <Loader/>\n                <p>Su compra esta siento procesada, aguarde unos segundos...</p>\n                {/* {(props.enviosReducer.error || props.carritoReducer.error || error)?<Error message=\"Ha ocurrido un error, intentalo mas tarde\"/>:\n                    <>\n                        {(ventaRegistrada)?<div className=\"alert alert-success\">{ventaRegistrada}</div>:\n                            <>\n                                <Loader/>\n                                <p>Su compra esta siento procesada, aguarde unos segundos...</p>\n                            </>\n                        }\n                    </>\n                } */}\n            </div>\n\n            <style jsx>{`\n                .wrapper{\n                    display:flex;\n                    justify-content:center;\n                    align-items:center;\n                    height:90vh;\n                    flex-direction:column;\n                }    \n            `}</style>\n        </>\n    );\n}\n\nProcesarVenta.getInitialProps = async({query})=>{\n    const {collection_id} = query;\n    return {collection_id};\n}\n\nconst mapStateToProps = ({carritoReducer,enviosReducer,usuarioReducer,zonasReducer})=>{\n    return {carritoReducer,enviosReducer,usuarioReducer,zonasReducer}\n};\nconst mapDispatchToProps = {\n    enviosGuardar,\n    carritoTraerProductos,\n    zonasGuardar,\n    setDataEnvioEnVenta,\n    inicializarStoreVenta,\n    traerZonas\n}\n \nexport default connect(mapStateToProps,mapDispatchToProps)(ProcesarVenta);"]},"metadata":{},"sourceType":"module"}