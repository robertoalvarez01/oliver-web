{"ast":null,"code":"import React from \"react\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { useEffect, useState } from \"react\";\nimport { MP_AC_TOKEN } from \"../../../config\";\nimport { connect } from 'react-redux';\nimport Swal from \"sweetalert2\";\n\nconst FormVenta = props => {\n  const {\n    usuarioReducer: {\n      usuario\n    },\n    ventaReducer\n  } = props;\n  const {\n    0: formValues,\n    1: setFormValues\n  } = useState({\n    docType: '',\n    docNumber: '',\n    issuer: '',\n    installments: '',\n    total: ventaReducer.total,\n    paymentMethod: null,\n    email: usuario.email,\n    token: null,\n    descripcion: ''\n  });\n  const {\n    0: issuers,\n    1: setIssuers\n  } = useState([]); //lista de bancos emisores segun la tarjeta del usuario\n\n  const {\n    0: payerCosts,\n    1: setPayerCosts\n  } = useState([]); //lista de opciones de cuotas\n\n  useEffect(function mount() {\n    window.Mercadopago.setPublishableKey(MP_AC_TOKEN);\n    window.Mercadopago.getIdentificationTypes();\n  });\n  useEffect(() => {\n    let descripcion = `Compra de ${ventaReducer.productos.length} producto${ventaReducer.productos.length > 1 ? 's' : ''} en Oliver PetShop`;\n    setFormValues(_objectSpread(_objectSpread({}, formValues), {}, {\n      descripcion\n    }));\n  }, []);\n  useEffect(() => {\n    if (formValues.paymentMethod) {\n      getIssuers(formValues.paymentMethod.id);\n    }\n  }, [formValues.paymentMethod]);\n  useEffect(() => {\n    if (issuers.length > 0) {\n      getInstallments(issuers);\n    }\n  }, [issuers]);\n  useEffect(() => {\n    if (formValues.token) {\n      enviarData();\n    }\n  }, [formValues.token]);\n\n  const handleChange = e => {\n    if (e.target.id == \"cardNumber\") {\n      guessPaymentMethod(e.target.value);\n      return;\n    }\n\n    setFormValues(_objectSpread(_objectSpread({}, formValues), {}, {\n      [e.target.name]: e.target.value\n    }));\n  };\n\n  const guessPaymentMethod = cardnumber => {\n    if (cardnumber.length >= 6) {\n      let bin = cardnumber.substring(0, 6);\n      window.Mercadopago.getPaymentMethod({\n        \"bin\": bin\n      }, (status, response) => {\n        if (status == 200) {\n          let paymentMethod = response[0];\n          return setFormValues(_objectSpread(_objectSpread({}, formValues), {}, {\n            paymentMethod: paymentMethod\n          }));\n        }\n\n        console.log(response);\n        return alert('Error en la busqueda de payment');\n      });\n    }\n  };\n\n  const getIssuers = idpaymentMethod => {\n    window.Mercadopago.getIssuers(idpaymentMethod, (status, response) => {\n      if (status != 200) return alert(`issuers method info error: ${response.message}`);\n      setIssuers(response);\n      setFormValues(_objectSpread(_objectSpread({}, formValues), {}, {\n        issuer: response[0].id\n      }));\n    });\n  };\n\n  const getInstallments = issuers => {\n    window.Mercadopago.getInstallments({\n      \"payment_method_id\": formValues.paymentMethod.id,\n      \"amount\": parseFloat(formValues.total),\n      \"issuer_id\": parseInt(issuers[0].value)\n    }, (status, response) => {\n      if (status != 200) return alert(`installments method info error: ${response}`);\n      setPayerCosts(response[0].payer_costs);\n      setFormValues(_objectSpread(_objectSpread({}, formValues), {}, {\n        installments: response[0].payer_costs[0].installments\n      }));\n    });\n  };\n\n  const handleSubmit = e => {\n    e.preventDefault();\n    window.Mercadopago.createToken(e.target, (status, response) => {\n      if (status == 200 || status == 201) {\n        setFormValues(_objectSpread(_objectSpread({}, formValues), {}, {\n          docType: document.getElementById('docType').value,\n          token: response.id\n        }));\n      }\n\n      return false;\n    });\n  };\n\n  const enviarData = () => {\n    props.closeModal();\n    document.getElementsByTagName('body')[0].style.overflowY = 'scroll';\n    Swal.fire('En proceso', 'Estamos trabajando para habilitar esta funcionalidad', 'warning');\n    console.log(formValues);\n  };\n\n  return __jsx(\"form\", {\n    onSubmit: handleSubmit\n  }, __jsx(\"h3\", null, \"Detalles del comprador\"), __jsx(\"div\", {\n    className: \"form-group row\"\n  }, __jsx(\"div\", {\n    className: \"col-4 my-2\"\n  }, __jsx(\"label\", {\n    htmlFor: \"docType\"\n  }, \"Tipo de doc.\"), __jsx(\"select\", {\n    className: \"form-control\",\n    id: \"docType\",\n    name: \"docType\",\n    \"data-checkout\": \"docType\",\n    type: \"text\"\n  })), __jsx(\"div\", {\n    className: \"col-8 my-2\"\n  }, __jsx(\"label\", {\n    htmlFor: \"docNumber\"\n  }, \"N\\xFAmero de documento\"), __jsx(\"input\", {\n    className: \"form-control\",\n    id: \"docNumber\",\n    name: \"docNumber\",\n    \"data-checkout\": \"docNumber\",\n    value: formValues.docNumber,\n    type: \"text\",\n    onChange: handleChange\n  }))), __jsx(\"h3\", null, \"Detalles de la tarjeta\"), __jsx(\"div\", {\n    className: \"form-group row\"\n  }, __jsx(\"div\", {\n    className: \"col-12 my-2\"\n  }, __jsx(\"label\", {\n    htmlFor: \"cardNumber\"\n  }, \"N\\xFAmero de la tarjeta\"), __jsx(\"input\", {\n    type: \"number\",\n    id: \"cardNumber\",\n    \"data-checkout\": \"cardNumber\",\n    onselectstart: \"return false\",\n    onPaste: () => false,\n    onCopy: () => false,\n    onCut: () => false,\n    onDrag: () => false,\n    onDrop: () => false,\n    autoComplete: \"off\",\n    onChange: handleChange,\n    className: \"form-control\"\n  })), __jsx(\"div\", {\n    className: \"col-12 my-2\"\n  }, __jsx(\"label\", {\n    htmlFor: \"cardholderName\"\n  }, \"Titular de la tarjeta\"), __jsx(\"input\", {\n    className: \"form-control\",\n    id: \"cardholderName\",\n    \"data-checkout\": \"cardholderName\",\n    type: \"text\"\n  })), __jsx(\"div\", {\n    className: \"col-6 my-2\"\n  }, __jsx(\"label\", {\n    htmlFor: \"\"\n  }, \"Vencimiento\"), __jsx(\"div\", {\n    className: \"row px-3\"\n  }, __jsx(\"input\", {\n    className: \"form-control col-5 mr-auto\",\n    type: \"number\",\n    placeholder: \"Mes\",\n    id: \"cardExpirationMonth\",\n    \"data-checkout\": \"cardExpirationMonth\",\n    onselectstart: \"return false\",\n    onPaste: () => false,\n    onCopy: () => false,\n    onCut: () => false,\n    onDrag: () => false,\n    onDrop: () => false,\n    autoComplete: \"off\",\n    maxLength: 2\n  }), __jsx(\"input\", {\n    className: \"form-control col-5\",\n    type: \"number\",\n    placeholder: \"A\\xF1o\",\n    id: \"cardExpirationYear\",\n    \"data-checkout\": \"cardExpirationYear\",\n    oonselectstart: \"return false\",\n    onPaste: () => false,\n    onCopy: () => false,\n    onCut: () => false,\n    onDrag: () => false,\n    onDrop: () => false,\n    autoComplete: \"off\",\n    maxLength: 2\n  }))), __jsx(\"div\", {\n    className: \"col-6 my-2\"\n  }, __jsx(\"label\", {\n    htmlFor: \"securityCode\"\n  }, \"C\\xF3digo de seguridad\"), __jsx(\"input\", {\n    id: \"securityCode\",\n    \"data-checkout\": \"securityCode\",\n    type: \"number\",\n    onselectstart: \"return false\",\n    onPaste: () => false,\n    onCopy: () => false,\n    onCut: () => false,\n    onDrag: () => false,\n    onDrop: () => false,\n    autoComplete: \"off\",\n    className: \"form-control\"\n  })), __jsx(\"div\", {\n    id: \"issuerInput\",\n    className: \"col-6 my-2\"\n  }, __jsx(\"label\", {\n    htmlFor: \"issuer\"\n  }, \"Entidad emisora\"), __jsx(\"select\", {\n    id: \"issuer\",\n    name: \"issuer\",\n    \"data-checkout\": \"issuer\",\n    defaultValue: formValues.issuer,\n    onChange: handleChange,\n    className: \"form-control\"\n  }, __jsx(\"option\", {\n    value: \"\"\n  }, \"Seleccione Banco emisor\"), issuers.map((issuer, key) => __jsx(\"option\", {\n    value: issuer.id,\n    key: key\n  }, issuer.name)))), __jsx(\"div\", {\n    className: \"col-6 my-2\"\n  }, __jsx(\"label\", {\n    htmlFor: \"installments\"\n  }, \"Cuotas\"), __jsx(\"select\", {\n    type: \"text\",\n    id: \"installments\",\n    name: \"installments\",\n    defaultValue: formValues.installments,\n    onChange: handleChange,\n    className: \"form-control\"\n  }, __jsx(\"option\", {\n    value: \"\"\n  }, \"Seleccione cuotas\"), payerCosts.map((installment, key) => __jsx(\"option\", {\n    value: installment.installments,\n    key: key\n  }, installment.recommended_message)))), __jsx(\"div\", {\n    className: \"col-12 text-center\"\n  }, __jsx(\"br\", null), __jsx(\"button\", {\n    className: \"boton bg-yellow\",\n    type: \"submit\"\n  }, \"Pagar\"), __jsx(\"br\", null))));\n};\n\nconst mapStateToProps = ({\n  usuarioReducer,\n  ventaReducer\n}) => {\n  return {\n    usuarioReducer,\n    ventaReducer\n  };\n};\n\nexport default connect(mapStateToProps, {})(FormVenta);","map":null,"metadata":{},"sourceType":"module"}