{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _this = this,\n    _jsxFileName = \"/home/franco/desarrollo/proyecto_oliver/oliver-web-next/pages/procesarVenta/[[...params]].js\",\n    _s = $RefreshSig$();\n\nimport _JSXStyle from \"styled-jsx/style\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport Head from '../../src/components/Head';\nimport Loader from '../../src/components/Loader';\nimport { connect } from 'react-redux';\nimport * as carritoActions from '../../store/actions/carritoActions';\nimport * as enviosActions from '../../store/actions/enviosActions';\nimport { useEffect, useState } from 'react';\nimport { API } from '../../config/index';\nimport Error from '../../src/components/Error';\n\nvar Swal = require('sweetalert2');\n\nvar enviosGuardar = enviosActions.guardar;\nvar carritoTraerProductos = carritoActions.traerProductos;\n\nvar ProcesarVenta = function ProcesarVenta(props) {\n  _s();\n\n  var _useState = useState(false),\n      error = _useState[0],\n      setError = _useState[1];\n\n  var _useState2 = useState(false),\n      ventaRegistrada = _useState2[0],\n      setVentaRegistrada = _useState2[1];\n\n  useEffect(function () {\n    procesarInfo();\n  }, [props.usuarioReducer]);\n\n  var procesarInfo = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var dataEnvio, idUsuario, _props$carritoReducer, subtotal, porcentaje_descuento, descuento, total, productos, idMedioPago, _props$enviosReducer$, zona, tipo, f, mes, dia, fecha, dataToRequest;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              dataEnvio = JSON.parse(localStorage.getItem('dataEnvio'));\n              props.enviosGuardar(dataEnvio);\n              props.carritoTraerProductos();\n\n              if (!(props.usuarioReducer.logueado && props.carritoReducer.productos.length > 0 && props.enviosReducer.data)) {\n                _context.next = 13;\n                break;\n              }\n\n              idUsuario = props.usuarioReducer.usuario.idUsuario;\n              _props$carritoReducer = props.carritoReducer, subtotal = _props$carritoReducer.subtotal, porcentaje_descuento = _props$carritoReducer.porcentaje_descuento, descuento = _props$carritoReducer.descuento, total = _props$carritoReducer.total, productos = _props$carritoReducer.productos, idMedioPago = _props$carritoReducer.idMedioPago;\n              _props$enviosReducer$ = props.enviosReducer.data, zona = _props$enviosReducer$.zona, tipo = _props$enviosReducer$.tipo;\n              f = new Date();\n              mes = f.getMonth() < 10 ? \"0\".concat(f.getMonth() + 1) : \"\".concat(f.getMonth());\n              dia = f.getDate() < 10 ? \"0\".concat(f.getDate()) : \"\".concat(f.getDate());\n              fecha = \"\".concat(f.getFullYear(), \"-\").concat(mes, \"-\").concat(dia);\n              dataToRequest = {\n                envio: {\n                  idZona: zona,\n                  tipo: tipo\n                },\n                venta: {\n                  subtotal: subtotal,\n                  porcentaje_descuento: porcentaje_descuento,\n                  descuento: descuento,\n                  total: total,\n                  idUsuario: idUsuario,\n                  productos: productos,\n                  fecha: fecha,\n                  operacion_id: props.collection_id || null,\n                  idMedioPago: idMedioPago\n                }\n              }; //console.log(dataToRequest);\n\n              return _context.abrupt(\"return\", registrarVenta(dataToRequest));\n\n            case 13:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function procesarInfo() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var registrarVenta = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(data) {\n      var headers, url, reqVenta;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              headers = new Headers();\n              headers.append('token', props.usuarioReducer.usuario.token);\n              headers.append(\"Content-Type\", \"application/json\");\n              url = !data.venta.operacion_id ? \"\".concat(API, \"/registrarVenta?mercadoPago=false\") : \"\".concat(API, \"/registrarVenta?mercadoPago=true\");\n              _context2.next = 7;\n              return fetch(url, {\n                headers: headers,\n                method: 'POST',\n                body: JSON.stringify(data)\n              });\n\n            case 7:\n              reqVenta = _context2.sent;\n\n              if (reqVenta.status == 200) {\n                localStorage.removeItem('dataEnvio');\n                localStorage.removeItem('carrito');\n                Swal.fire('Listo', 'Felicidades, tu compra se registró con éxito. En breve nos comunicaremos con usted para informarle el estado de su compra vía email.', 'success').then(function () {\n                  return window.location.assign('/');\n                });\n              } else {\n                setError(true);\n              }\n\n              _context2.next = 14;\n              break;\n\n            case 11:\n              _context2.prev = 11;\n              _context2.t0 = _context2[\"catch\"](0);\n              setError(_context2.t0.message);\n\n            case 14:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[0, 11]]);\n    }));\n\n    return function registrarVenta(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  return __jsx(React.Fragment, null, __jsx(Head, {\n    title: \"Finalizacion de compra\",\n    metadesc: \"\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 13\n    }\n  }), __jsx(\"div\", {\n    className: \"jsx-2063553454\" + \" \" + \"wrapper\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 86,\n      columnNumber: 13\n    }\n  }, props.enviosReducer.error || props.carritoReducer.error || error ? __jsx(Error, {\n    message: \"Ha ocurrido un error, intentalo mas tarde\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 87,\n      columnNumber: 85\n    }\n  }) : __jsx(React.Fragment, null, ventaRegistrada ? __jsx(\"div\", {\n    className: \"jsx-2063553454\" + \" \" + \"alert alert-success\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 44\n    }\n  }, ventaRegistrada) : __jsx(React.Fragment, null, __jsx(Loader, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 33\n    }\n  }), __jsx(\"p\", {\n    className: \"jsx-2063553454\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 33\n    }\n  }, \"Su compra esta siento procesada, aguarde unos segundos...\")))), __jsx(_JSXStyle, {\n    id: \"2063553454\",\n    __self: _this\n  }, \".wrapper.jsx-2063553454{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:90vh;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL2ZyYW5jby9kZXNhcnJvbGxvL3Byb3llY3RvX29saXZlci9vbGl2ZXItd2ViLW5leHQvcGFnZXMvcHJvY2VzYXJWZW50YS9bWy4uLnBhcmFtc11dLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQWtHd0IsQUFHaUMsMEVBQ1UsbUdBQ0osNkZBQ1AsWUFDVSw4RUFDekIiLCJmaWxlIjoiL2hvbWUvZnJhbmNvL2Rlc2Fycm9sbG8vcHJveWVjdG9fb2xpdmVyL29saXZlci13ZWItbmV4dC9wYWdlcy9wcm9jZXNhclZlbnRhL1tbLi4ucGFyYW1zXV0uanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgSGVhZCBmcm9tICcuLi8uLi9zcmMvY29tcG9uZW50cy9IZWFkJztcbmltcG9ydCBMb2FkZXIgZnJvbSAnLi4vLi4vc3JjL2NvbXBvbmVudHMvTG9hZGVyJztcbmltcG9ydCB7Y29ubmVjdH0gZnJvbSAncmVhY3QtcmVkdXgnO1xuaW1wb3J0ICogYXMgY2Fycml0b0FjdGlvbnMgZnJvbSAnLi4vLi4vc3RvcmUvYWN0aW9ucy9jYXJyaXRvQWN0aW9ucyc7XG5pbXBvcnQgKiBhcyBlbnZpb3NBY3Rpb25zIGZyb20gJy4uLy4uL3N0b3JlL2FjdGlvbnMvZW52aW9zQWN0aW9ucyc7XG5pbXBvcnQgeyB1c2VFZmZlY3QsIHVzZVN0YXRlIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHtBUEl9IGZyb20gJy4uLy4uL2NvbmZpZy9pbmRleCc7XG5pbXBvcnQgRXJyb3IgZnJvbSAnLi4vLi4vc3JjL2NvbXBvbmVudHMvRXJyb3InO1xuY29uc3QgU3dhbCA9IHJlcXVpcmUoJ3N3ZWV0YWxlcnQyJyk7XG5cbmNvbnN0IHtndWFyZGFyOmVudmlvc0d1YXJkYXJ9ID0gZW52aW9zQWN0aW9ucztcbmNvbnN0IHt0cmFlclByb2R1Y3RvczpjYXJyaXRvVHJhZXJQcm9kdWN0b3N9ID0gY2Fycml0b0FjdGlvbnM7XG5cbmNvbnN0IFByb2Nlc2FyVmVudGEgPSAocHJvcHMpID0+IHtcbiAgICBjb25zdCBbZXJyb3IsIHNldEVycm9yXSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgICBjb25zdCBbdmVudGFSZWdpc3RyYWRhLCBzZXRWZW50YVJlZ2lzdHJhZGFdID0gdXNlU3RhdGUoZmFsc2UpO1xuXG4gICAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAgICAgcHJvY2VzYXJJbmZvKCk7XG4gICAgfSwgW3Byb3BzLnVzdWFyaW9SZWR1Y2VyXSk7XG4gICAgXG4gICAgY29uc3QgcHJvY2VzYXJJbmZvID0gYXN5bmMoKT0+e1xuICAgICAgICBjb25zdCBkYXRhRW52aW8gPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdkYXRhRW52aW8nKSk7XG4gICAgICAgIHByb3BzLmVudmlvc0d1YXJkYXIoZGF0YUVudmlvKTtcbiAgICAgICAgcHJvcHMuY2Fycml0b1RyYWVyUHJvZHVjdG9zKCk7XG4gICAgICAgIGlmKHByb3BzLnVzdWFyaW9SZWR1Y2VyLmxvZ3VlYWRvICYmIHByb3BzLmNhcnJpdG9SZWR1Y2VyLnByb2R1Y3Rvcy5sZW5ndGg+MCAmJiBwcm9wcy5lbnZpb3NSZWR1Y2VyLmRhdGEpe1xuICAgICAgICAgICAgY29uc3Qge2lkVXN1YXJpb30gPSBwcm9wcy51c3VhcmlvUmVkdWNlci51c3VhcmlvO1xuICAgICAgICAgICAgY29uc3Qge3N1YnRvdGFsLHBvcmNlbnRhamVfZGVzY3VlbnRvLGRlc2N1ZW50byx0b3RhbCxwcm9kdWN0b3MsaWRNZWRpb1BhZ299ID0gcHJvcHMuY2Fycml0b1JlZHVjZXI7XG4gICAgICAgICAgICBjb25zdCB7em9uYSx0aXBvfSA9IHByb3BzLmVudmlvc1JlZHVjZXIuZGF0YTtcbiAgICAgICAgICAgIGxldCBmID0gbmV3IERhdGUoKTtcbiAgICAgICAgICAgIGxldCBtZXMgPSAoKGYuZ2V0TW9udGgoKSk8MTApP2AwJHtmLmdldE1vbnRoKCkrMX1gOmAke2YuZ2V0TW9udGgoKX1gO1xuICAgICAgICAgICAgbGV0IGRpYSA9ICgoZi5nZXREYXRlKCkpPDEwKT9gMCR7Zi5nZXREYXRlKCl9YDpgJHtmLmdldERhdGUoKX1gO1xuICAgICAgICAgICAgbGV0IGZlY2hhID0gYCR7Zi5nZXRGdWxsWWVhcigpfS0ke21lc30tJHtkaWF9YDtcbiAgICAgICAgICAgIGxldCBkYXRhVG9SZXF1ZXN0ID0ge1xuICAgICAgICAgICAgICAgIGVudmlvOntcbiAgICAgICAgICAgICAgICAgICAgaWRab25hOnpvbmEsXG4gICAgICAgICAgICAgICAgICAgIHRpcG86dGlwb1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgdmVudGE6e1xuICAgICAgICAgICAgICAgICAgICBzdWJ0b3RhbCxcbiAgICAgICAgICAgICAgICAgICAgcG9yY2VudGFqZV9kZXNjdWVudG8sXG4gICAgICAgICAgICAgICAgICAgIGRlc2N1ZW50byxcbiAgICAgICAgICAgICAgICAgICAgdG90YWwsXG4gICAgICAgICAgICAgICAgICAgIGlkVXN1YXJpbyxcbiAgICAgICAgICAgICAgICAgICAgcHJvZHVjdG9zLFxuICAgICAgICAgICAgICAgICAgICBmZWNoYSxcbiAgICAgICAgICAgICAgICAgICAgb3BlcmFjaW9uX2lkOnByb3BzLmNvbGxlY3Rpb25faWQgfHwgbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgaWRNZWRpb1BhZ29cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvL2NvbnNvbGUubG9nKGRhdGFUb1JlcXVlc3QpO1xuICAgICAgICAgICAgcmV0dXJuIHJlZ2lzdHJhclZlbnRhKGRhdGFUb1JlcXVlc3QpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgcmVnaXN0cmFyVmVudGEgPSBhc3luYyBkYXRhPT57XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBoZWFkZXJzID0gbmV3IEhlYWRlcnMoKTtcbiAgICAgICAgICAgIGhlYWRlcnMuYXBwZW5kKCd0b2tlbicscHJvcHMudXN1YXJpb1JlZHVjZXIudXN1YXJpby50b2tlbik7XG4gICAgICAgICAgICBoZWFkZXJzLmFwcGVuZChcIkNvbnRlbnQtVHlwZVwiLCBcImFwcGxpY2F0aW9uL2pzb25cIik7XG4gICAgICAgICAgICBsZXQgdXJsID0gKCFkYXRhLnZlbnRhLm9wZXJhY2lvbl9pZCk/YCR7QVBJfS9yZWdpc3RyYXJWZW50YT9tZXJjYWRvUGFnbz1mYWxzZWA6YCR7QVBJfS9yZWdpc3RyYXJWZW50YT9tZXJjYWRvUGFnbz10cnVlYDtcbiAgICAgICAgICAgIGNvbnN0IHJlcVZlbnRhID0gYXdhaXQgZmV0Y2godXJsLHtcbiAgICAgICAgICAgICAgICBoZWFkZXJzLFxuICAgICAgICAgICAgICAgIG1ldGhvZDonUE9TVCcsXG4gICAgICAgICAgICAgICAgYm9keTpKU09OLnN0cmluZ2lmeShkYXRhKVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZihyZXFWZW50YS5zdGF0dXMgPT0gMjAwKXtcbiAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgnZGF0YUVudmlvJyk7XG4gICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ2NhcnJpdG8nKTtcbiAgICAgICAgICAgICAgICBTd2FsLmZpcmUoXG4gICAgICAgICAgICAgICAgICAgICdMaXN0bycsXG4gICAgICAgICAgICAgICAgICAgICdGZWxpY2lkYWRlcywgdHUgY29tcHJhIHNlIHJlZ2lzdHLDsyBjb24gw6l4aXRvLiBFbiBicmV2ZSBub3MgY29tdW5pY2FyZW1vcyBjb24gdXN0ZWQgcGFyYSBpbmZvcm1hcmxlIGVsIGVzdGFkbyBkZSBzdSBjb21wcmEgdsOtYSBlbWFpbC4nLFxuICAgICAgICAgICAgICAgICAgICAnc3VjY2VzcydcbiAgICAgICAgICAgICAgICApLnRoZW4oKCk9PndpbmRvdy5sb2NhdGlvbi5hc3NpZ24oJy8nKSk7XG4gICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICBzZXRFcnJvcih0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIHNldEVycm9yKGVycm9yLm1lc3NhZ2UpXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gKFxuICAgICAgICA8PlxuICAgICAgICAgICAgPEhlYWQgdGl0bGU9XCJGaW5hbGl6YWNpb24gZGUgY29tcHJhXCIgbWV0YWRlc2M9XCJcIi8+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIndyYXBwZXJcIj5cbiAgICAgICAgICAgICAgICB7KHByb3BzLmVudmlvc1JlZHVjZXIuZXJyb3IgfHwgcHJvcHMuY2Fycml0b1JlZHVjZXIuZXJyb3IgfHwgZXJyb3IpPzxFcnJvciBtZXNzYWdlPVwiSGEgb2N1cnJpZG8gdW4gZXJyb3IsIGludGVudGFsbyBtYXMgdGFyZGVcIi8+OlxuICAgICAgICAgICAgICAgICAgICA8PlxuICAgICAgICAgICAgICAgICAgICAgICAgeyh2ZW50YVJlZ2lzdHJhZGEpPzxkaXYgY2xhc3NOYW1lPVwiYWxlcnQgYWxlcnQtc3VjY2Vzc1wiPnt2ZW50YVJlZ2lzdHJhZGF9PC9kaXY+OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDw+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxMb2FkZXIvPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cD5TdSBjb21wcmEgZXN0YSBzaWVudG8gcHJvY2VzYWRhLCBhZ3VhcmRlIHVub3Mgc2VndW5kb3MuLi48L3A+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC8+XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIDwvPlxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICAgICA8c3R5bGUganN4PntgXG4gICAgICAgICAgICAgICAgLndyYXBwZXJ7XG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6ZmxleDtcbiAgICAgICAgICAgICAgICAgICAganVzdGlmeS1jb250ZW50OmNlbnRlcjtcbiAgICAgICAgICAgICAgICAgICAgYWxpZ24taXRlbXM6Y2VudGVyO1xuICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6OTB2aDtcbiAgICAgICAgICAgICAgICAgICAgZmxleC1kaXJlY3Rpb246Y29sdW1uO1xuICAgICAgICAgICAgICAgIH0gICAgXG4gICAgICAgICAgICBgfTwvc3R5bGU+XG4gICAgICAgIDwvPlxuICAgICk7XG59XG5cblByb2Nlc2FyVmVudGEuZ2V0SW5pdGlhbFByb3BzID0gYXN5bmMoe3F1ZXJ5fSk9PntcbiAgICBjb25zdCB7Y29sbGVjdGlvbl9pZH0gPSBxdWVyeTtcbiAgICByZXR1cm4ge2NvbGxlY3Rpb25faWR9O1xufVxuXG5jb25zdCBtYXBTdGF0ZVRvUHJvcHMgPSAoe2NhcnJpdG9SZWR1Y2VyLGVudmlvc1JlZHVjZXIsdXN1YXJpb1JlZHVjZXJ9KT0+e1xuICAgIHJldHVybiB7Y2Fycml0b1JlZHVjZXIsZW52aW9zUmVkdWNlcix1c3VhcmlvUmVkdWNlcn1cbn07XG5jb25zdCBtYXBEaXNwYXRjaFRvUHJvcHMgPSB7XG4gICAgZW52aW9zR3VhcmRhcixcbiAgICBjYXJyaXRvVHJhZXJQcm9kdWN0b3Ncbn1cbiBcbmV4cG9ydCBkZWZhdWx0IGNvbm5lY3QobWFwU3RhdGVUb1Byb3BzLG1hcERpc3BhdGNoVG9Qcm9wcykoUHJvY2VzYXJWZW50YSk7Il19 */\\n/*@ sourceURL=/home/franco/desarrollo/proyecto_oliver/oliver-web-next/pages/procesarVenta/[[...params]].js */\"));\n};\n\n_s(ProcesarVenta, \"DwopPUkvZJIoD0pO1NEB7O897AY=\");\n\n_c = ProcesarVenta;\n\nProcesarVenta.getInitialProps = /*#__PURE__*/function () {\n  var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(_ref3) {\n    var query, collection_id;\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            query = _ref3.query;\n            collection_id = query.collection_id;\n            return _context3.abrupt(\"return\", {\n              collection_id: collection_id\n            });\n\n          case 3:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3);\n  }));\n\n  return function (_x2) {\n    return _ref4.apply(this, arguments);\n  };\n}();\n\nvar mapStateToProps = function mapStateToProps(_ref5) {\n  var carritoReducer = _ref5.carritoReducer,\n      enviosReducer = _ref5.enviosReducer,\n      usuarioReducer = _ref5.usuarioReducer;\n  return {\n    carritoReducer: carritoReducer,\n    enviosReducer: enviosReducer,\n    usuarioReducer: usuarioReducer\n  };\n};\n\nvar mapDispatchToProps = {\n  enviosGuardar: enviosGuardar,\n  carritoTraerProductos: carritoTraerProductos\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(ProcesarVenta);\n\nvar _c;\n\n$RefreshReg$(_c, \"ProcesarVenta\");","map":{"version":3,"sources":["/home/franco/desarrollo/proyecto_oliver/oliver-web-next/pages/procesarVenta/[[...params]].js"],"names":["Head","Loader","connect","carritoActions","enviosActions","useEffect","useState","API","Error","Swal","require","enviosGuardar","guardar","carritoTraerProductos","traerProductos","ProcesarVenta","props","error","setError","ventaRegistrada","setVentaRegistrada","procesarInfo","usuarioReducer","dataEnvio","JSON","parse","localStorage","getItem","logueado","carritoReducer","productos","length","enviosReducer","data","idUsuario","usuario","subtotal","porcentaje_descuento","descuento","total","idMedioPago","zona","tipo","f","Date","mes","getMonth","dia","getDate","fecha","getFullYear","dataToRequest","envio","idZona","venta","operacion_id","collection_id","registrarVenta","headers","Headers","append","token","url","fetch","method","body","stringify","reqVenta","status","removeItem","fire","then","window","location","assign","message","getInitialProps","query","mapStateToProps","mapDispatchToProps"],"mappings":"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","sourcesContent":["import Head from '../../src/components/Head';\nimport Loader from '../../src/components/Loader';\nimport {connect} from 'react-redux';\nimport * as carritoActions from '../../store/actions/carritoActions';\nimport * as enviosActions from '../../store/actions/enviosActions';\nimport { useEffect, useState } from 'react';\nimport {API} from '../../config/index';\nimport Error from '../../src/components/Error';\nconst Swal = require('sweetalert2');\n\nconst {guardar:enviosGuardar} = enviosActions;\nconst {traerProductos:carritoTraerProductos} = carritoActions;\n\nconst ProcesarVenta = (props) => {\n    const [error, setError] = useState(false);\n    const [ventaRegistrada, setVentaRegistrada] = useState(false);\n\n    useEffect(() => {\n        procesarInfo();\n    }, [props.usuarioReducer]);\n    \n    const procesarInfo = async()=>{\n        const dataEnvio = JSON.parse(localStorage.getItem('dataEnvio'));\n        props.enviosGuardar(dataEnvio);\n        props.carritoTraerProductos();\n        if(props.usuarioReducer.logueado && props.carritoReducer.productos.length>0 && props.enviosReducer.data){\n            const {idUsuario} = props.usuarioReducer.usuario;\n            const {subtotal,porcentaje_descuento,descuento,total,productos,idMedioPago} = props.carritoReducer;\n            const {zona,tipo} = props.enviosReducer.data;\n            let f = new Date();\n            let mes = ((f.getMonth())<10)?`0${f.getMonth()+1}`:`${f.getMonth()}`;\n            let dia = ((f.getDate())<10)?`0${f.getDate()}`:`${f.getDate()}`;\n            let fecha = `${f.getFullYear()}-${mes}-${dia}`;\n            let dataToRequest = {\n                envio:{\n                    idZona:zona,\n                    tipo:tipo\n                },\n                venta:{\n                    subtotal,\n                    porcentaje_descuento,\n                    descuento,\n                    total,\n                    idUsuario,\n                    productos,\n                    fecha,\n                    operacion_id:props.collection_id || null,\n                    idMedioPago\n                }\n            }\n            //console.log(dataToRequest);\n            return registrarVenta(dataToRequest);\n        }\n    }\n\n    const registrarVenta = async data=>{\n        try {\n            const headers = new Headers();\n            headers.append('token',props.usuarioReducer.usuario.token);\n            headers.append(\"Content-Type\", \"application/json\");\n            let url = (!data.venta.operacion_id)?`${API}/registrarVenta?mercadoPago=false`:`${API}/registrarVenta?mercadoPago=true`;\n            const reqVenta = await fetch(url,{\n                headers,\n                method:'POST',\n                body:JSON.stringify(data)\n            });\n            if(reqVenta.status == 200){\n                localStorage.removeItem('dataEnvio');\n                localStorage.removeItem('carrito');\n                Swal.fire(\n                    'Listo',\n                    'Felicidades, tu compra se registró con éxito. En breve nos comunicaremos con usted para informarle el estado de su compra vía email.',\n                    'success'\n                ).then(()=>window.location.assign('/'));\n            }else{\n                setError(true);\n            }\n        } catch (error) {\n            setError(error.message)\n        }\n    }\n\n    return (\n        <>\n            <Head title=\"Finalizacion de compra\" metadesc=\"\"/>\n            <div className=\"wrapper\">\n                {(props.enviosReducer.error || props.carritoReducer.error || error)?<Error message=\"Ha ocurrido un error, intentalo mas tarde\"/>:\n                    <>\n                        {(ventaRegistrada)?<div className=\"alert alert-success\">{ventaRegistrada}</div>:\n                            <>\n                                <Loader/>\n                                <p>Su compra esta siento procesada, aguarde unos segundos...</p>\n                            </>\n                        }\n                    </>\n                }\n            </div>\n\n            <style jsx>{`\n                .wrapper{\n                    display:flex;\n                    justify-content:center;\n                    align-items:center;\n                    height:90vh;\n                    flex-direction:column;\n                }    \n            `}</style>\n        </>\n    );\n}\n\nProcesarVenta.getInitialProps = async({query})=>{\n    const {collection_id} = query;\n    return {collection_id};\n}\n\nconst mapStateToProps = ({carritoReducer,enviosReducer,usuarioReducer})=>{\n    return {carritoReducer,enviosReducer,usuarioReducer}\n};\nconst mapDispatchToProps = {\n    enviosGuardar,\n    carritoTraerProductos\n}\n \nexport default connect(mapStateToProps,mapDispatchToProps)(ProcesarVenta);"]},"metadata":{},"sourceType":"module"}