{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _this = this,\n    _jsxFileName = \"C:\\\\Users\\\\franc\\\\Documents\\\\oliver-2\\\\sitio-desa\\\\pages\\\\procesarVenta\\\\[[...params]].js\",\n    _s = $RefreshSig$();\n\nimport _JSXStyle from \"styled-jsx/style\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport Head from '../../src/components/Head';\nimport Loader from '../../src/components/Loader';\nimport { connect } from 'react-redux';\nimport * as carritoActions from '../../store/actions/carritoActions';\nimport * as enviosActions from '../../store/actions/enviosActions';\nimport { useEffect, useState } from 'react';\nimport { API } from '../../config/index';\nimport Error from '../../src/components/Error';\nvar enviosGuardar = enviosActions.guardar;\nvar carritoTraerProductos = carritoActions.traerProductos;\n\nvar ProcesarVenta = function ProcesarVenta(props) {\n  _s();\n\n  var _useState = useState(false),\n      error = _useState[0],\n      setError = _useState[1];\n\n  var _useState2 = useState(false),\n      ventaRegistrada = _useState2[0],\n      setVentaRegistrada = _useState2[1];\n\n  useEffect(function () {\n    var dataEnvio = JSON.parse(localStorage.getItem('dataEnvio'));\n    props.enviosGuardar(dataEnvio);\n    props.carritoTraerProductos();\n  }, []);\n  useEffect(function () {\n    if (props.usuarioReducer.logueado && props.carritoReducer.productos.length > 0 && props.enviosReducer.data) {\n      console.log('jeje');\n      procesarInfo();\n    }\n  }, [props.enviosReducer]);\n\n  var procesarInfo = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var idUsuario, _props$carritoReducer, subtotal, porcentaje_descuento, descuento, total, productos, idMedioPago, _props$enviosReducer$, zona, tipo, f, mes, dia, fecha, dataToRequest;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              idUsuario = props.usuarioReducer.usuario.idUsuario;\n              _props$carritoReducer = props.carritoReducer, subtotal = _props$carritoReducer.subtotal, porcentaje_descuento = _props$carritoReducer.porcentaje_descuento, descuento = _props$carritoReducer.descuento, total = _props$carritoReducer.total, productos = _props$carritoReducer.productos, idMedioPago = _props$carritoReducer.idMedioPago;\n              _props$enviosReducer$ = props.enviosReducer.data, zona = _props$enviosReducer$.zona, tipo = _props$enviosReducer$.tipo;\n              f = new Date();\n              mes = f.getMonth() < 10 ? \"0\".concat(f.getMonth() + 1) : \"\".concat(f.getMonth());\n              dia = f.getDay() < 10 ? \"0\".concat(f.getDay()) : \"\".concat(f.getDay());\n              fecha = \"\".concat(f.getFullYear(), \"-\").concat(mes, \"-\").concat(dia);\n              dataToRequest = {\n                envio: {\n                  idZona: zona,\n                  tipo: tipo\n                },\n                venta: {\n                  subtotal: subtotal,\n                  porcentaje_descuento: porcentaje_descuento,\n                  descuento: descuento,\n                  total: total,\n                  idUsuario: idUsuario,\n                  productos: productos,\n                  fecha: fecha,\n                  operacion_id: props.collection_id || null,\n                  idMedioPago: idMedioPago\n                }\n              };\n              console.log(dataToRequest); //return registrarVenta(dataToRequest);\n\n            case 9:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function procesarInfo() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var registrarVenta = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(data) {\n      var headers, url, reqVenta;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              headers = new Headers();\n              headers.append('token', props.usuarioReducer.usuario.token);\n              headers.append(\"Content-Type\", \"application/json\");\n              url = !data.venta.operacion_id ? \"\".concat(API, \"/registrarVenta?mercadoPago=false\") : \"\".concat(API, \"/registrarVenta?mercadoPago=true\");\n              _context2.next = 7;\n              return fetch(url, {\n                headers: headers,\n                method: 'POST',\n                body: JSON.stringify(data)\n              });\n\n            case 7:\n              reqVenta = _context2.sent;\n\n              if (reqVenta.status == 200) {\n                localStorage.removeItem('dataEnvio');\n                localStorage.removeItem('carrito');\n                setVentaRegistrada('Felicidades, Tu venta se registró con éxito. En breve nos comunicaremos con usted para informarle el estado de su compra.');\n                setTimeout(function () {\n                  window.location.assign('/');\n                }, 5000);\n              } else {\n                setError(true);\n              }\n\n              _context2.next = 14;\n              break;\n\n            case 11:\n              _context2.prev = 11;\n              _context2.t0 = _context2[\"catch\"](0);\n              setError(_context2.t0.message);\n\n            case 14:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[0, 11]]);\n    }));\n\n    return function registrarVenta(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  return __jsx(React.Fragment, null, __jsx(Head, {\n    title: \"Finalizacion de compra\",\n    metadesc: \"\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 86,\n      columnNumber: 13\n    }\n  }), __jsx(\"div\", {\n    className: \"jsx-2063553454\" + \" \" + \"wrapper\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 87,\n      columnNumber: 13\n    }\n  }, !props.usuarioReducer.logueado || props.enviosReducer.error || props.carritoReducer.error || error ? __jsx(Error, {\n    message: \"Ha ocurrido un error, intentalo mas tarde\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 119\n    }\n  }) : __jsx(React.Fragment, null, ventaRegistrada ? __jsx(\"div\", {\n    className: \"jsx-2063553454\" + \" \" + \"alert alert-success\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 44\n    }\n  }, ventaRegistrada) : __jsx(React.Fragment, null, __jsx(Loader, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 33\n    }\n  }), __jsx(\"p\", {\n    className: \"jsx-2063553454\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 33\n    }\n  }, \"Su compra esta siento procesada, aguarde unos segundos...\")))), __jsx(_JSXStyle, {\n    id: \"2063553454\",\n    __self: _this\n  }, \".wrapper.jsx-2063553454{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:90vh;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcZnJhbmNcXERvY3VtZW50c1xcb2xpdmVyLTJcXHNpdGlvLWRlc2FcXHBhZ2VzXFxwcm9jZXNhclZlbnRhXFxbWy4uLnBhcmFtc11dLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQW1Hd0IsQUFHaUMsMEVBQ1UsbUdBQ0osNkZBQ1AsWUFDVSw4RUFDekIiLCJmaWxlIjoiQzpcXFVzZXJzXFxmcmFuY1xcRG9jdW1lbnRzXFxvbGl2ZXItMlxcc2l0aW8tZGVzYVxccGFnZXNcXHByb2Nlc2FyVmVudGFcXFtbLi4ucGFyYW1zXV0uanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgSGVhZCBmcm9tICcuLi8uLi9zcmMvY29tcG9uZW50cy9IZWFkJztcclxuaW1wb3J0IExvYWRlciBmcm9tICcuLi8uLi9zcmMvY29tcG9uZW50cy9Mb2FkZXInO1xyXG5pbXBvcnQge2Nvbm5lY3R9IGZyb20gJ3JlYWN0LXJlZHV4JztcclxuaW1wb3J0ICogYXMgY2Fycml0b0FjdGlvbnMgZnJvbSAnLi4vLi4vc3RvcmUvYWN0aW9ucy9jYXJyaXRvQWN0aW9ucyc7XHJcbmltcG9ydCAqIGFzIGVudmlvc0FjdGlvbnMgZnJvbSAnLi4vLi4vc3RvcmUvYWN0aW9ucy9lbnZpb3NBY3Rpb25zJztcclxuaW1wb3J0IHsgdXNlRWZmZWN0LCB1c2VTdGF0ZSB9IGZyb20gJ3JlYWN0JztcclxuaW1wb3J0IHtBUEl9IGZyb20gJy4uLy4uL2NvbmZpZy9pbmRleCc7XHJcbmltcG9ydCBFcnJvciBmcm9tICcuLi8uLi9zcmMvY29tcG9uZW50cy9FcnJvcic7XHJcblxyXG5jb25zdCB7Z3VhcmRhcjplbnZpb3NHdWFyZGFyfSA9IGVudmlvc0FjdGlvbnM7XHJcbmNvbnN0IHt0cmFlclByb2R1Y3RvczpjYXJyaXRvVHJhZXJQcm9kdWN0b3N9ID0gY2Fycml0b0FjdGlvbnM7XHJcblxyXG5jb25zdCBQcm9jZXNhclZlbnRhID0gKHByb3BzKSA9PiB7XHJcbiAgICBjb25zdCBbZXJyb3IsIHNldEVycm9yXSA9IHVzZVN0YXRlKGZhbHNlKTtcclxuICAgIGNvbnN0IFt2ZW50YVJlZ2lzdHJhZGEsIHNldFZlbnRhUmVnaXN0cmFkYV0gPSB1c2VTdGF0ZShmYWxzZSk7XHJcblxyXG4gICAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgICAgICBjb25zdCBkYXRhRW52aW8gPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdkYXRhRW52aW8nKSk7XHJcbiAgICAgICAgcHJvcHMuZW52aW9zR3VhcmRhcihkYXRhRW52aW8pO1xyXG4gICAgICAgIHByb3BzLmNhcnJpdG9UcmFlclByb2R1Y3RvcygpO1xyXG4gICAgfSwgW10pO1xyXG5cclxuICAgIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICAgICAgaWYocHJvcHMudXN1YXJpb1JlZHVjZXIubG9ndWVhZG8gJiYgcHJvcHMuY2Fycml0b1JlZHVjZXIucHJvZHVjdG9zLmxlbmd0aD4wICYmIHByb3BzLmVudmlvc1JlZHVjZXIuZGF0YSl7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdqZWplJyk7XHJcbiAgICAgICAgICAgIHByb2Nlc2FySW5mbygpO1xyXG4gICAgICAgIH1cclxuICAgIH0sIFtwcm9wcy5lbnZpb3NSZWR1Y2VyXSlcclxuXHJcbiAgICBjb25zdCBwcm9jZXNhckluZm8gPSBhc3luYygpPT57XHJcbiAgICAgICAgY29uc3Qge2lkVXN1YXJpb30gPSBwcm9wcy51c3VhcmlvUmVkdWNlci51c3VhcmlvO1xyXG4gICAgICAgIGNvbnN0IHtzdWJ0b3RhbCxwb3JjZW50YWplX2Rlc2N1ZW50byxkZXNjdWVudG8sdG90YWwscHJvZHVjdG9zLGlkTWVkaW9QYWdvfSA9IHByb3BzLmNhcnJpdG9SZWR1Y2VyO1xyXG4gICAgICAgIGNvbnN0IHt6b25hLHRpcG99ID0gcHJvcHMuZW52aW9zUmVkdWNlci5kYXRhO1xyXG4gICAgICAgIGxldCBmID0gbmV3IERhdGUoKTtcclxuICAgICAgICBsZXQgbWVzID0gKChmLmdldE1vbnRoKCkpPDEwKT9gMCR7Zi5nZXRNb250aCgpKzF9YDpgJHtmLmdldE1vbnRoKCl9YDtcclxuICAgICAgICBsZXQgZGlhID0gKChmLmdldERheSgpKTwxMCk/YDAke2YuZ2V0RGF5KCl9YDpgJHtmLmdldERheSgpfWA7XHJcbiAgICAgICAgbGV0IGZlY2hhID0gYCR7Zi5nZXRGdWxsWWVhcigpfS0ke21lc30tJHtkaWF9YDtcclxuICAgICAgICBsZXQgZGF0YVRvUmVxdWVzdCA9IHtcclxuICAgICAgICAgICAgZW52aW86e1xyXG4gICAgICAgICAgICAgICAgaWRab25hOnpvbmEsXHJcbiAgICAgICAgICAgICAgICB0aXBvOnRpcG9cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdmVudGE6e1xyXG4gICAgICAgICAgICAgICAgc3VidG90YWwsXHJcbiAgICAgICAgICAgICAgICBwb3JjZW50YWplX2Rlc2N1ZW50byxcclxuICAgICAgICAgICAgICAgIGRlc2N1ZW50byxcclxuICAgICAgICAgICAgICAgIHRvdGFsLFxyXG4gICAgICAgICAgICAgICAgaWRVc3VhcmlvLFxyXG4gICAgICAgICAgICAgICAgcHJvZHVjdG9zLFxyXG4gICAgICAgICAgICAgICAgZmVjaGEsXHJcbiAgICAgICAgICAgICAgICBvcGVyYWNpb25faWQ6cHJvcHMuY29sbGVjdGlvbl9pZCB8fCBudWxsLFxyXG4gICAgICAgICAgICAgICAgaWRNZWRpb1BhZ29cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zb2xlLmxvZyhkYXRhVG9SZXF1ZXN0KTtcclxuICAgICAgICAvL3JldHVybiByZWdpc3RyYXJWZW50YShkYXRhVG9SZXF1ZXN0KTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCByZWdpc3RyYXJWZW50YSA9IGFzeW5jIGRhdGE9PntcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBjb25zdCBoZWFkZXJzID0gbmV3IEhlYWRlcnMoKTtcclxuICAgICAgICAgICAgaGVhZGVycy5hcHBlbmQoJ3Rva2VuJyxwcm9wcy51c3VhcmlvUmVkdWNlci51c3VhcmlvLnRva2VuKTtcclxuICAgICAgICAgICAgaGVhZGVycy5hcHBlbmQoXCJDb250ZW50LVR5cGVcIiwgXCJhcHBsaWNhdGlvbi9qc29uXCIpO1xyXG4gICAgICAgICAgICBsZXQgdXJsID0gKCFkYXRhLnZlbnRhLm9wZXJhY2lvbl9pZCk/YCR7QVBJfS9yZWdpc3RyYXJWZW50YT9tZXJjYWRvUGFnbz1mYWxzZWA6YCR7QVBJfS9yZWdpc3RyYXJWZW50YT9tZXJjYWRvUGFnbz10cnVlYDtcclxuICAgICAgICAgICAgY29uc3QgcmVxVmVudGEgPSBhd2FpdCBmZXRjaCh1cmwse1xyXG4gICAgICAgICAgICAgICAgaGVhZGVycyxcclxuICAgICAgICAgICAgICAgIG1ldGhvZDonUE9TVCcsXHJcbiAgICAgICAgICAgICAgICBib2R5OkpTT04uc3RyaW5naWZ5KGRhdGEpXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBpZihyZXFWZW50YS5zdGF0dXMgPT0gMjAwKXtcclxuICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdkYXRhRW52aW8nKTtcclxuICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdjYXJyaXRvJyk7XHJcbiAgICAgICAgICAgICAgICBzZXRWZW50YVJlZ2lzdHJhZGEoJ0ZlbGljaWRhZGVzLCBUdSB2ZW50YSBzZSByZWdpc3Ryw7MgY29uIMOpeGl0by4gRW4gYnJldmUgbm9zIGNvbXVuaWNhcmVtb3MgY29uIHVzdGVkIHBhcmEgaW5mb3JtYXJsZSBlbCBlc3RhZG8gZGUgc3UgY29tcHJhLicpO1xyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmFzc2lnbignLycpXHJcbiAgICAgICAgICAgICAgICB9LCA1MDAwKTtcclxuICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICBzZXRFcnJvcih0cnVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAgIHNldEVycm9yKGVycm9yLm1lc3NhZ2UpXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIChcclxuICAgICAgICA8PlxyXG4gICAgICAgICAgICA8SGVhZCB0aXRsZT1cIkZpbmFsaXphY2lvbiBkZSBjb21wcmFcIiBtZXRhZGVzYz1cIlwiLz5cclxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJ3cmFwcGVyXCI+XHJcbiAgICAgICAgICAgICAgICB7KCFwcm9wcy51c3VhcmlvUmVkdWNlci5sb2d1ZWFkbyB8fCBwcm9wcy5lbnZpb3NSZWR1Y2VyLmVycm9yIHx8IHByb3BzLmNhcnJpdG9SZWR1Y2VyLmVycm9yIHx8IGVycm9yKT88RXJyb3IgbWVzc2FnZT1cIkhhIG9jdXJyaWRvIHVuIGVycm9yLCBpbnRlbnRhbG8gbWFzIHRhcmRlXCIvPjpcclxuICAgICAgICAgICAgICAgICAgICA8PlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7KHZlbnRhUmVnaXN0cmFkYSk/PGRpdiBjbGFzc05hbWU9XCJhbGVydCBhbGVydC1zdWNjZXNzXCI+e3ZlbnRhUmVnaXN0cmFkYX08L2Rpdj46XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8PlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxMb2FkZXIvPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxwPlN1IGNvbXByYSBlc3RhIHNpZW50byBwcm9jZXNhZGEsIGFndWFyZGUgdW5vcyBzZWd1bmRvcy4uLjwvcD5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgPC8+XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIDwvZGl2PlxyXG5cclxuICAgICAgICAgICAgPHN0eWxlIGpzeD57YFxyXG4gICAgICAgICAgICAgICAgLndyYXBwZXJ7XHJcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheTpmbGV4O1xyXG4gICAgICAgICAgICAgICAgICAgIGp1c3RpZnktY29udGVudDpjZW50ZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgYWxpZ24taXRlbXM6Y2VudGVyO1xyXG4gICAgICAgICAgICAgICAgICAgIGhlaWdodDo5MHZoO1xyXG4gICAgICAgICAgICAgICAgICAgIGZsZXgtZGlyZWN0aW9uOmNvbHVtbjtcclxuICAgICAgICAgICAgICAgIH0gICAgXHJcbiAgICAgICAgICAgIGB9PC9zdHlsZT5cclxuICAgICAgICA8Lz5cclxuICAgICk7XHJcbn1cclxuXHJcblByb2Nlc2FyVmVudGEuZ2V0SW5pdGlhbFByb3BzID0gYXN5bmMoe3F1ZXJ5fSk9PntcclxuICAgIGNvbnN0IHtjb2xsZWN0aW9uX2lkLGlkTWVkaW9QYWdvfSA9IHF1ZXJ5O1xyXG4gICAgcmV0dXJuIHtjb2xsZWN0aW9uX2lkLGlkTWVkaW9QYWdvfTtcclxufVxyXG5cclxuY29uc3QgbWFwU3RhdGVUb1Byb3BzID0gKHtjYXJyaXRvUmVkdWNlcixlbnZpb3NSZWR1Y2VyLHVzdWFyaW9SZWR1Y2VyfSk9PntcclxuICAgIHJldHVybiB7Y2Fycml0b1JlZHVjZXIsZW52aW9zUmVkdWNlcix1c3VhcmlvUmVkdWNlcn1cclxufTtcclxuY29uc3QgbWFwRGlzcGF0Y2hUb1Byb3BzID0ge1xyXG4gICAgZW52aW9zR3VhcmRhcixcclxuICAgIGNhcnJpdG9UcmFlclByb2R1Y3Rvc1xyXG59XHJcbiBcclxuZXhwb3J0IGRlZmF1bHQgY29ubmVjdChtYXBTdGF0ZVRvUHJvcHMsbWFwRGlzcGF0Y2hUb1Byb3BzKShQcm9jZXNhclZlbnRhKTsiXX0= */\\n/*@ sourceURL=C:\\\\\\\\Users\\\\\\\\franc\\\\\\\\Documents\\\\\\\\oliver-2\\\\\\\\sitio-desa\\\\\\\\pages\\\\\\\\procesarVenta\\\\\\\\[[...params]].js */\"));\n};\n\n_s(ProcesarVenta, \"0anAvrUsMEsNkOtuwJzV76+uKwo=\");\n\n_c = ProcesarVenta;\n\nProcesarVenta.getInitialProps = /*#__PURE__*/function () {\n  var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(_ref3) {\n    var query, collection_id, idMedioPago;\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            query = _ref3.query;\n            collection_id = query.collection_id, idMedioPago = query.idMedioPago;\n            return _context3.abrupt(\"return\", {\n              collection_id: collection_id,\n              idMedioPago: idMedioPago\n            });\n\n          case 3:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3);\n  }));\n\n  return function (_x2) {\n    return _ref4.apply(this, arguments);\n  };\n}();\n\nvar mapStateToProps = function mapStateToProps(_ref5) {\n  var carritoReducer = _ref5.carritoReducer,\n      enviosReducer = _ref5.enviosReducer,\n      usuarioReducer = _ref5.usuarioReducer;\n  return {\n    carritoReducer: carritoReducer,\n    enviosReducer: enviosReducer,\n    usuarioReducer: usuarioReducer\n  };\n};\n\nvar mapDispatchToProps = {\n  enviosGuardar: enviosGuardar,\n  carritoTraerProductos: carritoTraerProductos\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(ProcesarVenta);\n\nvar _c;\n\n$RefreshReg$(_c, \"ProcesarVenta\");","map":{"version":3,"sources":["C:/Users/franc/Documents/oliver-2/sitio-desa/pages/procesarVenta/[[...params]].js"],"names":["Head","Loader","connect","carritoActions","enviosActions","useEffect","useState","API","Error","enviosGuardar","guardar","carritoTraerProductos","traerProductos","ProcesarVenta","props","error","setError","ventaRegistrada","setVentaRegistrada","dataEnvio","JSON","parse","localStorage","getItem","usuarioReducer","logueado","carritoReducer","productos","length","enviosReducer","data","console","log","procesarInfo","idUsuario","usuario","subtotal","porcentaje_descuento","descuento","total","idMedioPago","zona","tipo","f","Date","mes","getMonth","dia","getDay","fecha","getFullYear","dataToRequest","envio","idZona","venta","operacion_id","collection_id","registrarVenta","headers","Headers","append","token","url","fetch","method","body","stringify","reqVenta","status","removeItem","setTimeout","window","location","assign","message","getInitialProps","query","mapStateToProps","mapDispatchToProps"],"mappings":"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","sourcesContent":["import Head from '../../src/components/Head';\r\nimport Loader from '../../src/components/Loader';\r\nimport {connect} from 'react-redux';\r\nimport * as carritoActions from '../../store/actions/carritoActions';\r\nimport * as enviosActions from '../../store/actions/enviosActions';\r\nimport { useEffect, useState } from 'react';\r\nimport {API} from '../../config/index';\r\nimport Error from '../../src/components/Error';\r\n\r\nconst {guardar:enviosGuardar} = enviosActions;\r\nconst {traerProductos:carritoTraerProductos} = carritoActions;\r\n\r\nconst ProcesarVenta = (props) => {\r\n    const [error, setError] = useState(false);\r\n    const [ventaRegistrada, setVentaRegistrada] = useState(false);\r\n\r\n    useEffect(() => {\r\n        const dataEnvio = JSON.parse(localStorage.getItem('dataEnvio'));\r\n        props.enviosGuardar(dataEnvio);\r\n        props.carritoTraerProductos();\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if(props.usuarioReducer.logueado && props.carritoReducer.productos.length>0 && props.enviosReducer.data){\r\n            console.log('jeje');\r\n            procesarInfo();\r\n        }\r\n    }, [props.enviosReducer])\r\n\r\n    const procesarInfo = async()=>{\r\n        const {idUsuario} = props.usuarioReducer.usuario;\r\n        const {subtotal,porcentaje_descuento,descuento,total,productos,idMedioPago} = props.carritoReducer;\r\n        const {zona,tipo} = props.enviosReducer.data;\r\n        let f = new Date();\r\n        let mes = ((f.getMonth())<10)?`0${f.getMonth()+1}`:`${f.getMonth()}`;\r\n        let dia = ((f.getDay())<10)?`0${f.getDay()}`:`${f.getDay()}`;\r\n        let fecha = `${f.getFullYear()}-${mes}-${dia}`;\r\n        let dataToRequest = {\r\n            envio:{\r\n                idZona:zona,\r\n                tipo:tipo\r\n            },\r\n            venta:{\r\n                subtotal,\r\n                porcentaje_descuento,\r\n                descuento,\r\n                total,\r\n                idUsuario,\r\n                productos,\r\n                fecha,\r\n                operacion_id:props.collection_id || null,\r\n                idMedioPago\r\n            }\r\n        }\r\n        console.log(dataToRequest);\r\n        //return registrarVenta(dataToRequest);\r\n    }\r\n\r\n    const registrarVenta = async data=>{\r\n        try {\r\n            const headers = new Headers();\r\n            headers.append('token',props.usuarioReducer.usuario.token);\r\n            headers.append(\"Content-Type\", \"application/json\");\r\n            let url = (!data.venta.operacion_id)?`${API}/registrarVenta?mercadoPago=false`:`${API}/registrarVenta?mercadoPago=true`;\r\n            const reqVenta = await fetch(url,{\r\n                headers,\r\n                method:'POST',\r\n                body:JSON.stringify(data)\r\n            });\r\n            if(reqVenta.status == 200){\r\n                localStorage.removeItem('dataEnvio');\r\n                localStorage.removeItem('carrito');\r\n                setVentaRegistrada('Felicidades, Tu venta se registró con éxito. En breve nos comunicaremos con usted para informarle el estado de su compra.');\r\n                setTimeout(() => {\r\n                    window.location.assign('/')\r\n                }, 5000);\r\n            }else{\r\n                setError(true);\r\n            }\r\n        } catch (error) {\r\n            setError(error.message)\r\n        }\r\n    }\r\n    return (\r\n        <>\r\n            <Head title=\"Finalizacion de compra\" metadesc=\"\"/>\r\n            <div className=\"wrapper\">\r\n                {(!props.usuarioReducer.logueado || props.enviosReducer.error || props.carritoReducer.error || error)?<Error message=\"Ha ocurrido un error, intentalo mas tarde\"/>:\r\n                    <>\r\n                        {(ventaRegistrada)?<div className=\"alert alert-success\">{ventaRegistrada}</div>:\r\n                            <>\r\n                                <Loader/>\r\n                                <p>Su compra esta siento procesada, aguarde unos segundos...</p>\r\n                            </>\r\n                        }\r\n                    </>\r\n                }\r\n            </div>\r\n\r\n            <style jsx>{`\r\n                .wrapper{\r\n                    display:flex;\r\n                    justify-content:center;\r\n                    align-items:center;\r\n                    height:90vh;\r\n                    flex-direction:column;\r\n                }    \r\n            `}</style>\r\n        </>\r\n    );\r\n}\r\n\r\nProcesarVenta.getInitialProps = async({query})=>{\r\n    const {collection_id,idMedioPago} = query;\r\n    return {collection_id,idMedioPago};\r\n}\r\n\r\nconst mapStateToProps = ({carritoReducer,enviosReducer,usuarioReducer})=>{\r\n    return {carritoReducer,enviosReducer,usuarioReducer}\r\n};\r\nconst mapDispatchToProps = {\r\n    enviosGuardar,\r\n    carritoTraerProductos\r\n}\r\n \r\nexport default connect(mapStateToProps,mapDispatchToProps)(ProcesarVenta);"]},"metadata":{},"sourceType":"module"}