{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _this = this,\n    _jsxFileName = \"/home/franco/desarrollo/proyecto_oliver/oliver-web-next/pages/procesarVenta/[[...params]].js\",\n    _s = $RefreshSig$();\n\nimport _JSXStyle from \"styled-jsx/style\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport Head from '../../src/components/Head';\nimport Loader from '../../src/components/Loader';\nimport { useRouter } from 'next/router';\nimport { connect } from 'react-redux';\nimport * as carritoActions from '../../store/actions/carritoActions';\nimport * as enviosActions from '../../store/actions/enviosActions';\nimport { useEffect, useState } from 'react';\nimport { API } from '../../config/index';\nimport Error from '../../src/components/Error';\nvar enviosGuardar = enviosActions.guardar;\nvar carritoTraerProductos = carritoActions.traerProductos;\n\nvar ProcesarVenta = function ProcesarVenta(props) {\n  _s();\n\n  var _useState = useState(false),\n      error = _useState[0],\n      setError = _useState[1];\n\n  var _useState2 = useState(false),\n      ventaRegistrada = _useState2[0],\n      setVentaRegistrada = _useState2[1];\n\n  useEffect(function () {\n    if (props.usuarioReducer.logueado) {\n      getData();\n    }\n  }, [props.usuarioReducer]);\n\n  var getData = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var dataEnvio, idUsuario, _props$carritoReducer, subtotal, porcentaje_descuento, descuento, total, productos, zona, tipo, f, mes, dia, fecha, dataToRequest;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              dataEnvio = JSON.parse(localStorage.getItem('dataEnvio'));\n              props.enviosGuardar(dataEnvio);\n              props.carritoTraerProductos();\n              idUsuario = props.usuarioReducer.usuario.idUsuario;\n              _props$carritoReducer = props.carritoReducer, subtotal = _props$carritoReducer.subtotal, porcentaje_descuento = _props$carritoReducer.porcentaje_descuento, descuento = _props$carritoReducer.descuento, total = _props$carritoReducer.total, productos = _props$carritoReducer.productos;\n              zona = dataEnvio.zona, tipo = dataEnvio.tipo;\n              f = new Date();\n              mes = f.getMonth() < 10 ? \"0\".concat(f.getMonth()) : \"\".concat(f.getMonth());\n              dia = f.getDay() < 10 ? \"0\".concat(f.getDay()) : \"\".concat(f.getDay());\n              fecha = \"\".concat(f.getFullYear(), \"-\").concat(mes, \"-\").concat(dia);\n              dataToRequest = {\n                envio: {\n                  idZona: zona,\n                  tipo: tipo\n                },\n                venta: {\n                  subtotal: subtotal,\n                  porcentaje_descuento: porcentaje_descuento,\n                  descuento: descuento,\n                  total: total,\n                  idUsuario: idUsuario,\n                  productos: productos,\n                  fecha: fecha\n                }\n              };\n              return _context.abrupt(\"return\", registrarVenta(dataToRequest));\n\n            case 12:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function getData() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var registrarVenta = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(data) {\n      var headers, reqVenta;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              headers = new Headers();\n              headers.append('token', props.usuarioReducer.usuario.token);\n              headers.append(\"Content-Type\", \"application/json\");\n              _context2.next = 6;\n              return fetch(\"\".concat(API, \"/registrarVenta\"), {\n                headers: headers,\n                method: 'POST',\n                body: JSON.stringify(data)\n              });\n\n            case 6:\n              reqVenta = _context2.sent;\n\n              if (reqVenta.status == 200) {\n                localStorage.removeItem('dataEnvio');\n                localStorage.removeItem('carrito');\n                setVentaRegistrada('Felicidades, Tu venta se registró con éxito. En breve nos comunicaremos con ustedes para informarle el estado de su compra.');\n              } else {\n                setError(true);\n              }\n\n              _context2.next = 13;\n              break;\n\n            case 10:\n              _context2.prev = 10;\n              _context2.t0 = _context2[\"catch\"](0);\n              setError(_context2.t0.message);\n\n            case 13:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[0, 10]]);\n    }));\n\n    return function registrarVenta(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  console.log(props);\n  var router = useRouter();\n  return __jsx(React.Fragment, null, __jsx(Head, {\n    title: \"Finalizacion de compra\",\n    metadesc: \"\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 13\n    }\n  }), __jsx(\"div\", {\n    className: \"jsx-2063553454\" + \" \" + \"wrapper\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 13\n    }\n  }, !props.usuarioReducer.logueado || props.enviosReducer.error || props.carritoReducer.error || error ? __jsx(Error, {\n    message: \"Ha ocurrido un error, intentalo mas tarde\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 119\n    }\n  }) : __jsx(React.Fragment, null, ventaRegistrada ? __jsx(\"div\", {\n    className: \"jsx-2063553454\" + \" \" + \"alert alert-success\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 44\n    }\n  }, ventaRegistrada) : __jsx(React.Fragment, null, __jsx(Loader, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 33\n    }\n  }), __jsx(\"p\", {\n    className: \"jsx-2063553454\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 86,\n      columnNumber: 33\n    }\n  }, \"Su compra esta siento procesada, aguarde unos segundos...\")))), __jsx(_JSXStyle, {\n    id: \"2063553454\",\n    __self: _this\n  }, \".wrapper.jsx-2063553454{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:90vh;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL2ZyYW5jby9kZXNhcnJvbGxvL3Byb3llY3RvX29saXZlci9vbGl2ZXItd2ViLW5leHQvcGFnZXMvcHJvY2VzYXJWZW50YS9bWy4uLnBhcmFtc11dLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQTRGd0IsQUFHaUMsMEVBQ1UsbUdBQ0osNkZBQ1AsWUFDVSw4RUFDekIiLCJmaWxlIjoiL2hvbWUvZnJhbmNvL2Rlc2Fycm9sbG8vcHJveWVjdG9fb2xpdmVyL29saXZlci13ZWItbmV4dC9wYWdlcy9wcm9jZXNhclZlbnRhL1tbLi4ucGFyYW1zXV0uanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgSGVhZCBmcm9tICcuLi8uLi9zcmMvY29tcG9uZW50cy9IZWFkJztcbmltcG9ydCBMb2FkZXIgZnJvbSAnLi4vLi4vc3JjL2NvbXBvbmVudHMvTG9hZGVyJztcbmltcG9ydCB7dXNlUm91dGVyfSBmcm9tICduZXh0L3JvdXRlcic7XG5pbXBvcnQge2Nvbm5lY3R9IGZyb20gJ3JlYWN0LXJlZHV4JztcbmltcG9ydCAqIGFzIGNhcnJpdG9BY3Rpb25zIGZyb20gJy4uLy4uL3N0b3JlL2FjdGlvbnMvY2Fycml0b0FjdGlvbnMnO1xuaW1wb3J0ICogYXMgZW52aW9zQWN0aW9ucyBmcm9tICcuLi8uLi9zdG9yZS9hY3Rpb25zL2Vudmlvc0FjdGlvbnMnO1xuaW1wb3J0IHsgdXNlRWZmZWN0LCB1c2VTdGF0ZSB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7QVBJfSBmcm9tICcuLi8uLi9jb25maWcvaW5kZXgnO1xuaW1wb3J0IEVycm9yIGZyb20gJy4uLy4uL3NyYy9jb21wb25lbnRzL0Vycm9yJztcblxuY29uc3Qge2d1YXJkYXI6ZW52aW9zR3VhcmRhcn0gPSBlbnZpb3NBY3Rpb25zO1xuY29uc3Qge3RyYWVyUHJvZHVjdG9zOmNhcnJpdG9UcmFlclByb2R1Y3Rvc30gPSBjYXJyaXRvQWN0aW9ucztcblxuY29uc3QgUHJvY2VzYXJWZW50YSA9IChwcm9wcykgPT4ge1xuICAgIGNvbnN0IFtlcnJvciwgc2V0RXJyb3JdID0gdXNlU3RhdGUoZmFsc2UpO1xuICAgIGNvbnN0IFt2ZW50YVJlZ2lzdHJhZGEsIHNldFZlbnRhUmVnaXN0cmFkYV0gPSB1c2VTdGF0ZShmYWxzZSk7XG5cbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgICBpZihwcm9wcy51c3VhcmlvUmVkdWNlci5sb2d1ZWFkbyl7XG4gICAgICAgICAgICBnZXREYXRhKCk7XG4gICAgICAgIH1cbiAgICB9LCBbcHJvcHMudXN1YXJpb1JlZHVjZXJdKTtcblxuICAgIGNvbnN0IGdldERhdGEgPSBhc3luYygpPT57XG4gICAgICAgIGNvbnN0IGRhdGFFbnZpbyA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2RhdGFFbnZpbycpKTtcbiAgICAgICAgcHJvcHMuZW52aW9zR3VhcmRhcihkYXRhRW52aW8pO1xuICAgICAgICBwcm9wcy5jYXJyaXRvVHJhZXJQcm9kdWN0b3MoKTtcbiAgICAgICAgY29uc3Qge2lkVXN1YXJpb30gPSBwcm9wcy51c3VhcmlvUmVkdWNlci51c3VhcmlvO1xuICAgICAgICBjb25zdCB7c3VidG90YWwscG9yY2VudGFqZV9kZXNjdWVudG8sZGVzY3VlbnRvLHRvdGFsLHByb2R1Y3Rvc30gPSBwcm9wcy5jYXJyaXRvUmVkdWNlcjtcbiAgICAgICAgY29uc3Qge3pvbmEsdGlwb30gPSBkYXRhRW52aW87XG4gICAgICAgIGxldCBmID0gbmV3IERhdGUoKTtcbiAgICAgICAgbGV0IG1lcyA9ICgoZi5nZXRNb250aCgpKTwxMCk/YDAke2YuZ2V0TW9udGgoKX1gOmAke2YuZ2V0TW9udGgoKX1gO1xuICAgICAgICBsZXQgZGlhID0gKChmLmdldERheSgpKTwxMCk/YDAke2YuZ2V0RGF5KCl9YDpgJHtmLmdldERheSgpfWA7XG4gICAgICAgIGxldCBmZWNoYSA9IGAke2YuZ2V0RnVsbFllYXIoKX0tJHttZXN9LSR7ZGlhfWA7XG4gICAgICAgIGxldCBkYXRhVG9SZXF1ZXN0ID0ge1xuICAgICAgICAgICAgZW52aW86e1xuICAgICAgICAgICAgICAgIGlkWm9uYTp6b25hLFxuICAgICAgICAgICAgICAgIHRpcG9cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB2ZW50YTp7XG4gICAgICAgICAgICAgICAgc3VidG90YWwsXG4gICAgICAgICAgICAgICAgcG9yY2VudGFqZV9kZXNjdWVudG8sXG4gICAgICAgICAgICAgICAgZGVzY3VlbnRvLFxuICAgICAgICAgICAgICAgIHRvdGFsLFxuICAgICAgICAgICAgICAgIGlkVXN1YXJpbyxcbiAgICAgICAgICAgICAgICBwcm9kdWN0b3MsXG4gICAgICAgICAgICAgICAgZmVjaGFcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVnaXN0cmFyVmVudGEoZGF0YVRvUmVxdWVzdCk7XG4gICAgfVxuXG4gICAgY29uc3QgcmVnaXN0cmFyVmVudGEgPSBhc3luYyBkYXRhPT57XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBoZWFkZXJzID0gbmV3IEhlYWRlcnMoKTtcbiAgICAgICAgICAgIGhlYWRlcnMuYXBwZW5kKCd0b2tlbicscHJvcHMudXN1YXJpb1JlZHVjZXIudXN1YXJpby50b2tlbik7XG4gICAgICAgICAgICBoZWFkZXJzLmFwcGVuZChcIkNvbnRlbnQtVHlwZVwiLCBcImFwcGxpY2F0aW9uL2pzb25cIik7XG4gICAgICAgICAgICBjb25zdCByZXFWZW50YSA9IGF3YWl0IGZldGNoKGAke0FQSX0vcmVnaXN0cmFyVmVudGFgLHtcbiAgICAgICAgICAgICAgICBoZWFkZXJzLFxuICAgICAgICAgICAgICAgIG1ldGhvZDonUE9TVCcsXG4gICAgICAgICAgICAgICAgYm9keTpKU09OLnN0cmluZ2lmeShkYXRhKVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZihyZXFWZW50YS5zdGF0dXMgPT0gMjAwKXtcbiAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgnZGF0YUVudmlvJyk7XG4gICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ2NhcnJpdG8nKTtcbiAgICAgICAgICAgICAgICBzZXRWZW50YVJlZ2lzdHJhZGEoJ0ZlbGljaWRhZGVzLCBUdSB2ZW50YSBzZSByZWdpc3Ryw7MgY29uIMOpeGl0by4gRW4gYnJldmUgbm9zIGNvbXVuaWNhcmVtb3MgY29uIHVzdGVkZXMgcGFyYSBpbmZvcm1hcmxlIGVsIGVzdGFkbyBkZSBzdSBjb21wcmEuJyk7XG4gICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICBzZXRFcnJvcih0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIHNldEVycm9yKGVycm9yLm1lc3NhZ2UpXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZyhwcm9wcyk7XG4gICAgY29uc3Qgcm91dGVyID0gdXNlUm91dGVyKCk7XG4gICAgcmV0dXJuIChcbiAgICAgICAgPD5cbiAgICAgICAgICAgIDxIZWFkIHRpdGxlPVwiRmluYWxpemFjaW9uIGRlIGNvbXByYVwiIG1ldGFkZXNjPVwiXCIvPlxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJ3cmFwcGVyXCI+XG4gICAgICAgICAgICAgICAgeyghcHJvcHMudXN1YXJpb1JlZHVjZXIubG9ndWVhZG8gfHwgcHJvcHMuZW52aW9zUmVkdWNlci5lcnJvciB8fCBwcm9wcy5jYXJyaXRvUmVkdWNlci5lcnJvciB8fCBlcnJvcik/PEVycm9yIG1lc3NhZ2U9XCJIYSBvY3VycmlkbyB1biBlcnJvciwgaW50ZW50YWxvIG1hcyB0YXJkZVwiLz46XG4gICAgICAgICAgICAgICAgICAgIDw+XG4gICAgICAgICAgICAgICAgICAgICAgICB7KHZlbnRhUmVnaXN0cmFkYSk/PGRpdiBjbGFzc05hbWU9XCJhbGVydCBhbGVydC1zdWNjZXNzXCI+e3ZlbnRhUmVnaXN0cmFkYX08L2Rpdj46XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPExvYWRlci8+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxwPlN1IGNvbXByYSBlc3RhIHNpZW50byBwcm9jZXNhZGEsIGFndWFyZGUgdW5vcyBzZWd1bmRvcy4uLjwvcD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8Lz5cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgPC8+XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgICAgIDxzdHlsZSBqc3g+e2BcbiAgICAgICAgICAgICAgICAud3JhcHBlcntcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheTpmbGV4O1xuICAgICAgICAgICAgICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyO1xuICAgICAgICAgICAgICAgICAgICBhbGlnbi1pdGVtczpjZW50ZXI7XG4gICAgICAgICAgICAgICAgICAgIGhlaWdodDo5MHZoO1xuICAgICAgICAgICAgICAgICAgICBmbGV4LWRpcmVjdGlvbjpjb2x1bW47XG4gICAgICAgICAgICAgICAgfSAgICBcbiAgICAgICAgICAgIGB9PC9zdHlsZT5cbiAgICAgICAgPC8+XG4gICAgKTtcbn1cblxuUHJvY2VzYXJWZW50YS5nZXRJbml0aWFsUHJvcHMgPSBhc3luYyh7cXVlcnl9KT0+e1xuICAgIGNvbnN0IHtjb2xsZWN0aW9uX2lkLGNvbGxlY3Rpb25fc3RhdHVzLGV4dGVybmFsX3JlZmVyZW5jZSxtZXJjaGFudCxhY2NvdW50X2lkLG1lcmNoYW50X29yZGVyX2lkLHBheW1lbnRfaWQscGF5bWVudF90eXBlLHByZWZlcmVuY2VfaWQscHJvY2Vzc2luZ19tb2RlLHNpdGVfaWQsc3RhdHVzfSA9IHF1ZXJ5O1xuICAgIHJldHVybiB7Y29sbGVjdGlvbl9pZCxjb2xsZWN0aW9uX3N0YXR1cyxleHRlcm5hbF9yZWZlcmVuY2UsbWVyY2hhbnQsYWNjb3VudF9pZCxtZXJjaGFudF9vcmRlcl9pZCxwYXltZW50X2lkLHBheW1lbnRfdHlwZSxwcmVmZXJlbmNlX2lkLHByb2Nlc3NpbmdfbW9kZSxzaXRlX2lkLHN0YXR1c307XG59XG5cbmNvbnN0IG1hcFN0YXRlVG9Qcm9wcyA9ICh7Y2Fycml0b1JlZHVjZXIsZW52aW9zUmVkdWNlcix1c3VhcmlvUmVkdWNlcn0pPT57XG4gICAgcmV0dXJuIHtjYXJyaXRvUmVkdWNlcixlbnZpb3NSZWR1Y2VyLHVzdWFyaW9SZWR1Y2VyfVxufTtcbmNvbnN0IG1hcERpc3BhdGNoVG9Qcm9wcyA9IHtcbiAgICBlbnZpb3NHdWFyZGFyLFxuICAgIGNhcnJpdG9UcmFlclByb2R1Y3Rvc1xufVxuIFxuZXhwb3J0IGRlZmF1bHQgY29ubmVjdChtYXBTdGF0ZVRvUHJvcHMsbWFwRGlzcGF0Y2hUb1Byb3BzKShQcm9jZXNhclZlbnRhKTsiXX0= */\\n/*@ sourceURL=/home/franco/desarrollo/proyecto_oliver/oliver-web-next/pages/procesarVenta/[[...params]].js */\"));\n};\n\n_s(ProcesarVenta, \"MBzWq+QrmxcPI7tADGMsPVl44cU=\", false, function () {\n  return [useRouter];\n});\n\n_c = ProcesarVenta;\n\nProcesarVenta.getInitialProps = /*#__PURE__*/function () {\n  var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(_ref3) {\n    var query, collection_id, collection_status, external_reference, merchant, account_id, merchant_order_id, payment_id, payment_type, preference_id, processing_mode, site_id, status;\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            query = _ref3.query;\n            collection_id = query.collection_id, collection_status = query.collection_status, external_reference = query.external_reference, merchant = query.merchant, account_id = query.account_id, merchant_order_id = query.merchant_order_id, payment_id = query.payment_id, payment_type = query.payment_type, preference_id = query.preference_id, processing_mode = query.processing_mode, site_id = query.site_id, status = query.status;\n            return _context3.abrupt(\"return\", {\n              collection_id: collection_id,\n              collection_status: collection_status,\n              external_reference: external_reference,\n              merchant: merchant,\n              account_id: account_id,\n              merchant_order_id: merchant_order_id,\n              payment_id: payment_id,\n              payment_type: payment_type,\n              preference_id: preference_id,\n              processing_mode: processing_mode,\n              site_id: site_id,\n              status: status\n            });\n\n          case 3:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3);\n  }));\n\n  return function (_x2) {\n    return _ref4.apply(this, arguments);\n  };\n}();\n\nvar mapStateToProps = function mapStateToProps(_ref5) {\n  var carritoReducer = _ref5.carritoReducer,\n      enviosReducer = _ref5.enviosReducer,\n      usuarioReducer = _ref5.usuarioReducer;\n  return {\n    carritoReducer: carritoReducer,\n    enviosReducer: enviosReducer,\n    usuarioReducer: usuarioReducer\n  };\n};\n\nvar mapDispatchToProps = {\n  enviosGuardar: enviosGuardar,\n  carritoTraerProductos: carritoTraerProductos\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(ProcesarVenta);\n\nvar _c;\n\n$RefreshReg$(_c, \"ProcesarVenta\");","map":{"version":3,"sources":["/home/franco/desarrollo/proyecto_oliver/oliver-web-next/pages/procesarVenta/[[...params]].js"],"names":["Head","Loader","useRouter","connect","carritoActions","enviosActions","useEffect","useState","API","Error","enviosGuardar","guardar","carritoTraerProductos","traerProductos","ProcesarVenta","props","error","setError","ventaRegistrada","setVentaRegistrada","usuarioReducer","logueado","getData","dataEnvio","JSON","parse","localStorage","getItem","idUsuario","usuario","carritoReducer","subtotal","porcentaje_descuento","descuento","total","productos","zona","tipo","f","Date","mes","getMonth","dia","getDay","fecha","getFullYear","dataToRequest","envio","idZona","venta","registrarVenta","data","headers","Headers","append","token","fetch","method","body","stringify","reqVenta","status","removeItem","message","console","log","router","enviosReducer","getInitialProps","query","collection_id","collection_status","external_reference","merchant","account_id","merchant_order_id","payment_id","payment_type","preference_id","processing_mode","site_id","mapStateToProps","mapDispatchToProps"],"mappings":"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","sourcesContent":["import Head from '../../src/components/Head';\nimport Loader from '../../src/components/Loader';\nimport {useRouter} from 'next/router';\nimport {connect} from 'react-redux';\nimport * as carritoActions from '../../store/actions/carritoActions';\nimport * as enviosActions from '../../store/actions/enviosActions';\nimport { useEffect, useState } from 'react';\nimport {API} from '../../config/index';\nimport Error from '../../src/components/Error';\n\nconst {guardar:enviosGuardar} = enviosActions;\nconst {traerProductos:carritoTraerProductos} = carritoActions;\n\nconst ProcesarVenta = (props) => {\n    const [error, setError] = useState(false);\n    const [ventaRegistrada, setVentaRegistrada] = useState(false);\n\n    useEffect(() => {\n        if(props.usuarioReducer.logueado){\n            getData();\n        }\n    }, [props.usuarioReducer]);\n\n    const getData = async()=>{\n        const dataEnvio = JSON.parse(localStorage.getItem('dataEnvio'));\n        props.enviosGuardar(dataEnvio);\n        props.carritoTraerProductos();\n        const {idUsuario} = props.usuarioReducer.usuario;\n        const {subtotal,porcentaje_descuento,descuento,total,productos} = props.carritoReducer;\n        const {zona,tipo} = dataEnvio;\n        let f = new Date();\n        let mes = ((f.getMonth())<10)?`0${f.getMonth()}`:`${f.getMonth()}`;\n        let dia = ((f.getDay())<10)?`0${f.getDay()}`:`${f.getDay()}`;\n        let fecha = `${f.getFullYear()}-${mes}-${dia}`;\n        let dataToRequest = {\n            envio:{\n                idZona:zona,\n                tipo\n            },\n            venta:{\n                subtotal,\n                porcentaje_descuento,\n                descuento,\n                total,\n                idUsuario,\n                productos,\n                fecha\n            }\n        }\n        return registrarVenta(dataToRequest);\n    }\n\n    const registrarVenta = async data=>{\n        try {\n            const headers = new Headers();\n            headers.append('token',props.usuarioReducer.usuario.token);\n            headers.append(\"Content-Type\", \"application/json\");\n            const reqVenta = await fetch(`${API}/registrarVenta`,{\n                headers,\n                method:'POST',\n                body:JSON.stringify(data)\n            });\n            if(reqVenta.status == 200){\n                localStorage.removeItem('dataEnvio');\n                localStorage.removeItem('carrito');\n                setVentaRegistrada('Felicidades, Tu venta se registró con éxito. En breve nos comunicaremos con ustedes para informarle el estado de su compra.');\n            }else{\n                setError(true);\n            }\n        } catch (error) {\n            setError(error.message)\n        }\n    }\n\n    console.log(props);\n    const router = useRouter();\n    return (\n        <>\n            <Head title=\"Finalizacion de compra\" metadesc=\"\"/>\n            <div className=\"wrapper\">\n                {(!props.usuarioReducer.logueado || props.enviosReducer.error || props.carritoReducer.error || error)?<Error message=\"Ha ocurrido un error, intentalo mas tarde\"/>:\n                    <>\n                        {(ventaRegistrada)?<div className=\"alert alert-success\">{ventaRegistrada}</div>:\n                            <>\n                                <Loader/>\n                                <p>Su compra esta siento procesada, aguarde unos segundos...</p>\n                            </>\n                        }\n                    </>\n                }\n            </div>\n\n            <style jsx>{`\n                .wrapper{\n                    display:flex;\n                    justify-content:center;\n                    align-items:center;\n                    height:90vh;\n                    flex-direction:column;\n                }    \n            `}</style>\n        </>\n    );\n}\n\nProcesarVenta.getInitialProps = async({query})=>{\n    const {collection_id,collection_status,external_reference,merchant,account_id,merchant_order_id,payment_id,payment_type,preference_id,processing_mode,site_id,status} = query;\n    return {collection_id,collection_status,external_reference,merchant,account_id,merchant_order_id,payment_id,payment_type,preference_id,processing_mode,site_id,status};\n}\n\nconst mapStateToProps = ({carritoReducer,enviosReducer,usuarioReducer})=>{\n    return {carritoReducer,enviosReducer,usuarioReducer}\n};\nconst mapDispatchToProps = {\n    enviosGuardar,\n    carritoTraerProductos\n}\n \nexport default connect(mapStateToProps,mapDispatchToProps)(ProcesarVenta);"]},"metadata":{},"sourceType":"module"}