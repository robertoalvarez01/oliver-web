{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\franc\\\\Documents\\\\oliver-2\\\\sitio-desa\\\\pages\\\\procesarVenta\\\\[[...params]].js\";\nimport _JSXStyle from \"styled-jsx/style\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport Head from '../../src/components/Head';\nimport Loader from '../../src/components/Loader';\nimport { connect } from 'react-redux';\nimport * as carritoActions from '../../store/actions/carritoActions';\nimport * as enviosActions from '../../store/actions/enviosActions';\nimport { useEffect, useState } from 'react';\nimport { API } from '../../config/index';\nimport Error from '../../src/components/Error';\nconst {\n  guardar: enviosGuardar\n} = enviosActions;\nconst {\n  traerProductos: carritoTraerProductos\n} = carritoActions;\n\nconst ProcesarVenta = props => {\n  const {\n    0: error,\n    1: setError\n  } = useState(false);\n  const {\n    0: ventaRegistrada,\n    1: setVentaRegistrada\n  } = useState(false);\n  useEffect(() => {\n    const dataEnvio = JSON.parse(localStorage.getItem('dataEnvio'));\n    props.enviosGuardar(dataEnvio);\n    props.carritoTraerProductos();\n  }, []);\n  useEffect(() => {\n    console.log(props.carritoReducer.productos.length, props.enviosReducer.data);\n\n    if (props.usuarioReducer.logueado && props.carritoReducer.productos.length > 0 && props.enviosReducer.data) {\n      console.log('jeje');\n      procesarInfo();\n    }\n  }, [props.enviosReducer]);\n\n  const procesarInfo = async () => {\n    const {\n      idUsuario\n    } = props.usuarioReducer.usuario;\n    const {\n      subtotal,\n      porcentaje_descuento,\n      descuento,\n      total,\n      productos,\n      idMedioPago\n    } = props.carritoReducer;\n    const {\n      zona,\n      tipo\n    } = props.enviosReducer.data;\n    let f = new Date();\n    let mes = f.getMonth() < 10 ? `0${f.getMonth() + 1}` : `${f.getMonth()}`;\n    let dia = f.getDate() < 10 ? `0${f.getDate()}` : `${f.getDate()}`;\n    let fecha = `${f.getFullYear()}-${mes}-${dia}`;\n    let dataToRequest = {\n      envio: {\n        idZona: zona,\n        tipo: tipo\n      },\n      venta: {\n        subtotal,\n        porcentaje_descuento,\n        descuento,\n        total,\n        idUsuario,\n        productos,\n        fecha,\n        operacion_id: props.collection_id || null,\n        idMedioPago\n      }\n    }; //console.log(dataToRequest);\n\n    return registrarVenta(dataToRequest);\n  };\n\n  const registrarVenta = async data => {\n    console.log('aca');\n\n    try {\n      const headers = new Headers();\n      headers.append('token', props.usuarioReducer.usuario.token);\n      headers.append(\"Content-Type\", \"application/json\");\n      let url = !data.venta.operacion_id ? `${API}/registrarVenta?mercadoPago=false` : `${API}/registrarVenta?mercadoPago=true`;\n      const reqVenta = await fetch(url, {\n        headers,\n        method: 'POST',\n        body: JSON.stringify(data)\n      });\n\n      if (reqVenta.status == 200) {\n        localStorage.removeItem('dataEnvio');\n        localStorage.removeItem('carrito');\n        setVentaRegistrada('Felicidades, Tu venta se registró con éxito. En breve nos comunicaremos con usted para informarle el estado de su compra.');\n        setTimeout(() => {\n          window.location.assign('/');\n        }, 5000);\n      } else {\n        setError(true);\n      }\n    } catch (error) {\n      setError(error.message);\n    }\n  };\n\n  return __jsx(React.Fragment, null, __jsx(Head, {\n    title: \"Finalizacion de compra\",\n    metadesc: \"\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 13\n    }\n  }), __jsx(\"div\", {\n    className: \"jsx-2063553454\" + \" \" + \"wrapper\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 13\n    }\n  }, !props.usuarioReducer.logueado || props.enviosReducer.error || props.carritoReducer.error || error ? __jsx(Error, {\n    message: \"Ha ocurrido un error, intentalo mas tarde\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 119\n    }\n  }) : __jsx(React.Fragment, null, ventaRegistrada ? __jsx(\"div\", {\n    className: \"jsx-2063553454\" + \" \" + \"alert alert-success\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 44\n    }\n  }, ventaRegistrada) : __jsx(React.Fragment, null, __jsx(Loader, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 33\n    }\n  }), __jsx(\"p\", {\n    className: \"jsx-2063553454\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 33\n    }\n  }, \"Su compra esta siento procesada, aguarde unos segundos...\")))), __jsx(_JSXStyle, {\n    id: \"2063553454\",\n    __self: this\n  }, \".wrapper.jsx-2063553454{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:90vh;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcZnJhbmNcXERvY3VtZW50c1xcb2xpdmVyLTJcXHNpdGlvLWRlc2FcXHBhZ2VzXFxwcm9jZXNhclZlbnRhXFxbWy4uLnBhcmFtc11dLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQXFHd0IsQUFHaUMsMEVBQ1UsbUdBQ0osNkZBQ1AsWUFDVSw4RUFDekIiLCJmaWxlIjoiQzpcXFVzZXJzXFxmcmFuY1xcRG9jdW1lbnRzXFxvbGl2ZXItMlxcc2l0aW8tZGVzYVxccGFnZXNcXHByb2Nlc2FyVmVudGFcXFtbLi4ucGFyYW1zXV0uanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgSGVhZCBmcm9tICcuLi8uLi9zcmMvY29tcG9uZW50cy9IZWFkJztcclxuaW1wb3J0IExvYWRlciBmcm9tICcuLi8uLi9zcmMvY29tcG9uZW50cy9Mb2FkZXInO1xyXG5pbXBvcnQge2Nvbm5lY3R9IGZyb20gJ3JlYWN0LXJlZHV4JztcclxuaW1wb3J0ICogYXMgY2Fycml0b0FjdGlvbnMgZnJvbSAnLi4vLi4vc3RvcmUvYWN0aW9ucy9jYXJyaXRvQWN0aW9ucyc7XHJcbmltcG9ydCAqIGFzIGVudmlvc0FjdGlvbnMgZnJvbSAnLi4vLi4vc3RvcmUvYWN0aW9ucy9lbnZpb3NBY3Rpb25zJztcclxuaW1wb3J0IHsgdXNlRWZmZWN0LCB1c2VTdGF0ZSB9IGZyb20gJ3JlYWN0JztcclxuaW1wb3J0IHtBUEl9IGZyb20gJy4uLy4uL2NvbmZpZy9pbmRleCc7XHJcbmltcG9ydCBFcnJvciBmcm9tICcuLi8uLi9zcmMvY29tcG9uZW50cy9FcnJvcic7XHJcblxyXG5jb25zdCB7Z3VhcmRhcjplbnZpb3NHdWFyZGFyfSA9IGVudmlvc0FjdGlvbnM7XHJcbmNvbnN0IHt0cmFlclByb2R1Y3RvczpjYXJyaXRvVHJhZXJQcm9kdWN0b3N9ID0gY2Fycml0b0FjdGlvbnM7XHJcblxyXG5jb25zdCBQcm9jZXNhclZlbnRhID0gKHByb3BzKSA9PiB7XHJcbiAgICBjb25zdCBbZXJyb3IsIHNldEVycm9yXSA9IHVzZVN0YXRlKGZhbHNlKTtcclxuICAgIGNvbnN0IFt2ZW50YVJlZ2lzdHJhZGEsIHNldFZlbnRhUmVnaXN0cmFkYV0gPSB1c2VTdGF0ZShmYWxzZSk7XHJcblxyXG4gICAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgICAgICBjb25zdCBkYXRhRW52aW8gPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdkYXRhRW52aW8nKSk7XHJcbiAgICAgICAgcHJvcHMuZW52aW9zR3VhcmRhcihkYXRhRW52aW8pO1xyXG4gICAgICAgIHByb3BzLmNhcnJpdG9UcmFlclByb2R1Y3RvcygpO1xyXG4gICAgfSwgW10pO1xyXG5cclxuICAgIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2cocHJvcHMuY2Fycml0b1JlZHVjZXIucHJvZHVjdG9zLmxlbmd0aCxwcm9wcy5lbnZpb3NSZWR1Y2VyLmRhdGEpO1xyXG4gICAgICAgIGlmKHByb3BzLnVzdWFyaW9SZWR1Y2VyLmxvZ3VlYWRvICYmIHByb3BzLmNhcnJpdG9SZWR1Y2VyLnByb2R1Y3Rvcy5sZW5ndGg+MCAmJiBwcm9wcy5lbnZpb3NSZWR1Y2VyLmRhdGEpe1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnamVqZScpO1xyXG4gICAgICAgICAgICBwcm9jZXNhckluZm8oKTtcclxuICAgICAgICB9XHJcbiAgICB9LCBbcHJvcHMuZW52aW9zUmVkdWNlcl0pXHJcblxyXG4gICAgY29uc3QgcHJvY2VzYXJJbmZvID0gYXN5bmMoKT0+e1xyXG4gICAgICAgIGNvbnN0IHtpZFVzdWFyaW99ID0gcHJvcHMudXN1YXJpb1JlZHVjZXIudXN1YXJpbztcclxuICAgICAgICBjb25zdCB7c3VidG90YWwscG9yY2VudGFqZV9kZXNjdWVudG8sZGVzY3VlbnRvLHRvdGFsLHByb2R1Y3RvcyxpZE1lZGlvUGFnb30gPSBwcm9wcy5jYXJyaXRvUmVkdWNlcjtcclxuICAgICAgICBjb25zdCB7em9uYSx0aXBvfSA9IHByb3BzLmVudmlvc1JlZHVjZXIuZGF0YTtcclxuICAgICAgICBsZXQgZiA9IG5ldyBEYXRlKCk7XHJcbiAgICAgICAgbGV0IG1lcyA9ICgoZi5nZXRNb250aCgpKTwxMCk/YDAke2YuZ2V0TW9udGgoKSsxfWA6YCR7Zi5nZXRNb250aCgpfWA7XHJcbiAgICAgICAgbGV0IGRpYSA9ICgoZi5nZXREYXRlKCkpPDEwKT9gMCR7Zi5nZXREYXRlKCl9YDpgJHtmLmdldERhdGUoKX1gO1xyXG4gICAgICAgIGxldCBmZWNoYSA9IGAke2YuZ2V0RnVsbFllYXIoKX0tJHttZXN9LSR7ZGlhfWA7XHJcbiAgICAgICAgbGV0IGRhdGFUb1JlcXVlc3QgPSB7XHJcbiAgICAgICAgICAgIGVudmlvOntcclxuICAgICAgICAgICAgICAgIGlkWm9uYTp6b25hLFxyXG4gICAgICAgICAgICAgICAgdGlwbzp0aXBvXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHZlbnRhOntcclxuICAgICAgICAgICAgICAgIHN1YnRvdGFsLFxyXG4gICAgICAgICAgICAgICAgcG9yY2VudGFqZV9kZXNjdWVudG8sXHJcbiAgICAgICAgICAgICAgICBkZXNjdWVudG8sXHJcbiAgICAgICAgICAgICAgICB0b3RhbCxcclxuICAgICAgICAgICAgICAgIGlkVXN1YXJpbyxcclxuICAgICAgICAgICAgICAgIHByb2R1Y3RvcyxcclxuICAgICAgICAgICAgICAgIGZlY2hhLFxyXG4gICAgICAgICAgICAgICAgb3BlcmFjaW9uX2lkOnByb3BzLmNvbGxlY3Rpb25faWQgfHwgbnVsbCxcclxuICAgICAgICAgICAgICAgIGlkTWVkaW9QYWdvXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgLy9jb25zb2xlLmxvZyhkYXRhVG9SZXF1ZXN0KTtcclxuICAgICAgICByZXR1cm4gcmVnaXN0cmFyVmVudGEoZGF0YVRvUmVxdWVzdCk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgcmVnaXN0cmFyVmVudGEgPSBhc3luYyBkYXRhPT57XHJcbiAgICAgICAgY29uc29sZS5sb2coJ2FjYScpO1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGhlYWRlcnMgPSBuZXcgSGVhZGVycygpO1xyXG4gICAgICAgICAgICBoZWFkZXJzLmFwcGVuZCgndG9rZW4nLHByb3BzLnVzdWFyaW9SZWR1Y2VyLnVzdWFyaW8udG9rZW4pO1xyXG4gICAgICAgICAgICBoZWFkZXJzLmFwcGVuZChcIkNvbnRlbnQtVHlwZVwiLCBcImFwcGxpY2F0aW9uL2pzb25cIik7XHJcbiAgICAgICAgICAgIGxldCB1cmwgPSAoIWRhdGEudmVudGEub3BlcmFjaW9uX2lkKT9gJHtBUEl9L3JlZ2lzdHJhclZlbnRhP21lcmNhZG9QYWdvPWZhbHNlYDpgJHtBUEl9L3JlZ2lzdHJhclZlbnRhP21lcmNhZG9QYWdvPXRydWVgO1xyXG4gICAgICAgICAgICBjb25zdCByZXFWZW50YSA9IGF3YWl0IGZldGNoKHVybCx7XHJcbiAgICAgICAgICAgICAgICBoZWFkZXJzLFxyXG4gICAgICAgICAgICAgICAgbWV0aG9kOidQT1NUJyxcclxuICAgICAgICAgICAgICAgIGJvZHk6SlNPTi5zdHJpbmdpZnkoZGF0YSlcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGlmKHJlcVZlbnRhLnN0YXR1cyA9PSAyMDApe1xyXG4gICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ2RhdGFFbnZpbycpO1xyXG4gICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ2NhcnJpdG8nKTtcclxuICAgICAgICAgICAgICAgIHNldFZlbnRhUmVnaXN0cmFkYSgnRmVsaWNpZGFkZXMsIFR1IHZlbnRhIHNlIHJlZ2lzdHLDsyBjb24gw6l4aXRvLiBFbiBicmV2ZSBub3MgY29tdW5pY2FyZW1vcyBjb24gdXN0ZWQgcGFyYSBpbmZvcm1hcmxlIGVsIGVzdGFkbyBkZSBzdSBjb21wcmEuJyk7XHJcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uYXNzaWduKCcvJylcclxuICAgICAgICAgICAgICAgIH0sIDUwMDApO1xyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgIHNldEVycm9yKHRydWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgc2V0RXJyb3IoZXJyb3IubWVzc2FnZSlcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gKFxyXG4gICAgICAgIDw+XHJcbiAgICAgICAgICAgIDxIZWFkIHRpdGxlPVwiRmluYWxpemFjaW9uIGRlIGNvbXByYVwiIG1ldGFkZXNjPVwiXCIvPlxyXG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIndyYXBwZXJcIj5cclxuICAgICAgICAgICAgICAgIHsoIXByb3BzLnVzdWFyaW9SZWR1Y2VyLmxvZ3VlYWRvIHx8IHByb3BzLmVudmlvc1JlZHVjZXIuZXJyb3IgfHwgcHJvcHMuY2Fycml0b1JlZHVjZXIuZXJyb3IgfHwgZXJyb3IpPzxFcnJvciBtZXNzYWdlPVwiSGEgb2N1cnJpZG8gdW4gZXJyb3IsIGludGVudGFsbyBtYXMgdGFyZGVcIi8+OlxyXG4gICAgICAgICAgICAgICAgICAgIDw+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHsodmVudGFSZWdpc3RyYWRhKT88ZGl2IGNsYXNzTmFtZT1cImFsZXJ0IGFsZXJ0LXN1Y2Nlc3NcIj57dmVudGFSZWdpc3RyYWRhfTwvZGl2PjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDw+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPExvYWRlci8+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHA+U3UgY29tcHJhIGVzdGEgc2llbnRvIHByb2Nlc2FkYSwgYWd1YXJkZSB1bm9zIHNlZ3VuZG9zLi4uPC9wPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC8+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICA8Lz5cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgPC9kaXY+XHJcblxyXG4gICAgICAgICAgICA8c3R5bGUganN4PntgXHJcbiAgICAgICAgICAgICAgICAud3JhcHBlcntcclxuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OmZsZXg7XHJcbiAgICAgICAgICAgICAgICAgICAganVzdGlmeS1jb250ZW50OmNlbnRlcjtcclxuICAgICAgICAgICAgICAgICAgICBhbGlnbi1pdGVtczpjZW50ZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0Ojkwdmg7XHJcbiAgICAgICAgICAgICAgICAgICAgZmxleC1kaXJlY3Rpb246Y29sdW1uO1xyXG4gICAgICAgICAgICAgICAgfSAgICBcclxuICAgICAgICAgICAgYH08L3N0eWxlPlxyXG4gICAgICAgIDwvPlxyXG4gICAgKTtcclxufVxyXG5cclxuUHJvY2VzYXJWZW50YS5nZXRJbml0aWFsUHJvcHMgPSBhc3luYyh7cXVlcnl9KT0+e1xyXG4gICAgY29uc3Qge2NvbGxlY3Rpb25faWR9ID0gcXVlcnk7XHJcbiAgICByZXR1cm4ge2NvbGxlY3Rpb25faWR9O1xyXG59XHJcblxyXG5jb25zdCBtYXBTdGF0ZVRvUHJvcHMgPSAoe2NhcnJpdG9SZWR1Y2VyLGVudmlvc1JlZHVjZXIsdXN1YXJpb1JlZHVjZXJ9KT0+e1xyXG4gICAgcmV0dXJuIHtjYXJyaXRvUmVkdWNlcixlbnZpb3NSZWR1Y2VyLHVzdWFyaW9SZWR1Y2VyfVxyXG59O1xyXG5jb25zdCBtYXBEaXNwYXRjaFRvUHJvcHMgPSB7XHJcbiAgICBlbnZpb3NHdWFyZGFyLFxyXG4gICAgY2Fycml0b1RyYWVyUHJvZHVjdG9zXHJcbn1cclxuIFxyXG5leHBvcnQgZGVmYXVsdCBjb25uZWN0KG1hcFN0YXRlVG9Qcm9wcyxtYXBEaXNwYXRjaFRvUHJvcHMpKFByb2Nlc2FyVmVudGEpOyJdfQ== */\\n/*@ sourceURL=C:\\\\\\\\Users\\\\\\\\franc\\\\\\\\Documents\\\\\\\\oliver-2\\\\\\\\sitio-desa\\\\\\\\pages\\\\\\\\procesarVenta\\\\\\\\[[...params]].js */\"));\n};\n\nProcesarVenta.getInitialProps = async ({\n  query\n}) => {\n  const {\n    collection_id\n  } = query;\n  return {\n    collection_id\n  };\n};\n\nconst mapStateToProps = ({\n  carritoReducer,\n  enviosReducer,\n  usuarioReducer\n}) => {\n  return {\n    carritoReducer,\n    enviosReducer,\n    usuarioReducer\n  };\n};\n\nconst mapDispatchToProps = {\n  enviosGuardar,\n  carritoTraerProductos\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(ProcesarVenta);","map":{"version":3,"sources":["C:/Users/franc/Documents/oliver-2/sitio-desa/pages/procesarVenta/[[...params]].js"],"names":["Head","Loader","connect","carritoActions","enviosActions","useEffect","useState","API","Error","guardar","enviosGuardar","traerProductos","carritoTraerProductos","ProcesarVenta","props","error","setError","ventaRegistrada","setVentaRegistrada","dataEnvio","JSON","parse","localStorage","getItem","console","log","carritoReducer","productos","length","enviosReducer","data","usuarioReducer","logueado","procesarInfo","idUsuario","usuario","subtotal","porcentaje_descuento","descuento","total","idMedioPago","zona","tipo","f","Date","mes","getMonth","dia","getDate","fecha","getFullYear","dataToRequest","envio","idZona","venta","operacion_id","collection_id","registrarVenta","headers","Headers","append","token","url","reqVenta","fetch","method","body","stringify","status","removeItem","setTimeout","window","location","assign","message","getInitialProps","query","mapStateToProps","mapDispatchToProps"],"mappings":"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","sourcesContent":["import Head from '../../src/components/Head';\r\nimport Loader from '../../src/components/Loader';\r\nimport {connect} from 'react-redux';\r\nimport * as carritoActions from '../../store/actions/carritoActions';\r\nimport * as enviosActions from '../../store/actions/enviosActions';\r\nimport { useEffect, useState } from 'react';\r\nimport {API} from '../../config/index';\r\nimport Error from '../../src/components/Error';\r\n\r\nconst {guardar:enviosGuardar} = enviosActions;\r\nconst {traerProductos:carritoTraerProductos} = carritoActions;\r\n\r\nconst ProcesarVenta = (props) => {\r\n    const [error, setError] = useState(false);\r\n    const [ventaRegistrada, setVentaRegistrada] = useState(false);\r\n\r\n    useEffect(() => {\r\n        const dataEnvio = JSON.parse(localStorage.getItem('dataEnvio'));\r\n        props.enviosGuardar(dataEnvio);\r\n        props.carritoTraerProductos();\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        console.log(props.carritoReducer.productos.length,props.enviosReducer.data);\r\n        if(props.usuarioReducer.logueado && props.carritoReducer.productos.length>0 && props.enviosReducer.data){\r\n            console.log('jeje');\r\n            procesarInfo();\r\n        }\r\n    }, [props.enviosReducer])\r\n\r\n    const procesarInfo = async()=>{\r\n        const {idUsuario} = props.usuarioReducer.usuario;\r\n        const {subtotal,porcentaje_descuento,descuento,total,productos,idMedioPago} = props.carritoReducer;\r\n        const {zona,tipo} = props.enviosReducer.data;\r\n        let f = new Date();\r\n        let mes = ((f.getMonth())<10)?`0${f.getMonth()+1}`:`${f.getMonth()}`;\r\n        let dia = ((f.getDate())<10)?`0${f.getDate()}`:`${f.getDate()}`;\r\n        let fecha = `${f.getFullYear()}-${mes}-${dia}`;\r\n        let dataToRequest = {\r\n            envio:{\r\n                idZona:zona,\r\n                tipo:tipo\r\n            },\r\n            venta:{\r\n                subtotal,\r\n                porcentaje_descuento,\r\n                descuento,\r\n                total,\r\n                idUsuario,\r\n                productos,\r\n                fecha,\r\n                operacion_id:props.collection_id || null,\r\n                idMedioPago\r\n            }\r\n        }\r\n        //console.log(dataToRequest);\r\n        return registrarVenta(dataToRequest);\r\n    }\r\n\r\n    const registrarVenta = async data=>{\r\n        console.log('aca');\r\n        try {\r\n            const headers = new Headers();\r\n            headers.append('token',props.usuarioReducer.usuario.token);\r\n            headers.append(\"Content-Type\", \"application/json\");\r\n            let url = (!data.venta.operacion_id)?`${API}/registrarVenta?mercadoPago=false`:`${API}/registrarVenta?mercadoPago=true`;\r\n            const reqVenta = await fetch(url,{\r\n                headers,\r\n                method:'POST',\r\n                body:JSON.stringify(data)\r\n            });\r\n            if(reqVenta.status == 200){\r\n                localStorage.removeItem('dataEnvio');\r\n                localStorage.removeItem('carrito');\r\n                setVentaRegistrada('Felicidades, Tu venta se registró con éxito. En breve nos comunicaremos con usted para informarle el estado de su compra.');\r\n                setTimeout(() => {\r\n                    window.location.assign('/')\r\n                }, 5000);\r\n            }else{\r\n                setError(true);\r\n            }\r\n        } catch (error) {\r\n            setError(error.message)\r\n        }\r\n    }\r\n    return (\r\n        <>\r\n            <Head title=\"Finalizacion de compra\" metadesc=\"\"/>\r\n            <div className=\"wrapper\">\r\n                {(!props.usuarioReducer.logueado || props.enviosReducer.error || props.carritoReducer.error || error)?<Error message=\"Ha ocurrido un error, intentalo mas tarde\"/>:\r\n                    <>\r\n                        {(ventaRegistrada)?<div className=\"alert alert-success\">{ventaRegistrada}</div>:\r\n                            <>\r\n                                <Loader/>\r\n                                <p>Su compra esta siento procesada, aguarde unos segundos...</p>\r\n                            </>\r\n                        }\r\n                    </>\r\n                }\r\n            </div>\r\n\r\n            <style jsx>{`\r\n                .wrapper{\r\n                    display:flex;\r\n                    justify-content:center;\r\n                    align-items:center;\r\n                    height:90vh;\r\n                    flex-direction:column;\r\n                }    \r\n            `}</style>\r\n        </>\r\n    );\r\n}\r\n\r\nProcesarVenta.getInitialProps = async({query})=>{\r\n    const {collection_id} = query;\r\n    return {collection_id};\r\n}\r\n\r\nconst mapStateToProps = ({carritoReducer,enviosReducer,usuarioReducer})=>{\r\n    return {carritoReducer,enviosReducer,usuarioReducer}\r\n};\r\nconst mapDispatchToProps = {\r\n    enviosGuardar,\r\n    carritoTraerProductos\r\n}\r\n \r\nexport default connect(mapStateToProps,mapDispatchToProps)(ProcesarVenta);"]},"metadata":{},"sourceType":"module"}