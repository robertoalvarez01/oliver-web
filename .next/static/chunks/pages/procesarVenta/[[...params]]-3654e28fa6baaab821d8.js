(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[502],{670:function(e,t,n){"use strict";n.r(t);var r=n(5893),a=n(809),o=n.n(a),c=n(266),i=n(5988),s=n(2642),u=n(5500),d=n(4494),p=n(3088),l=n(2379),f=n(1538),v=n(5318),m=n(7294),x=n(1130),y=n(3687),h=n(6455),g=p.traerProductos,w=l.l,b=f.P,k=f.y,j=v.S1,_=v.Z_,R=function(e){var t=(0,m.useState)(!1),n=t[0],a=t[1],d=e.carritoReducer,p=e.ventaReducer,l=e.carritoTraerProductos,f=e.enviosGuardar,v=e.zonasGuardar,g=e.inicializarStoreVenta,w=e.setDataEnvioEnVenta,b=e.traerZonas,k=e.status,j=e.payment_id,_=e.collection_id,R=e.usuarioReducer,z=R.usuario,E=R.logueado,Z=e.zonasReducer,S=Z.zonas,P=Z.zona,N=e.ventaReducer,T=N.idMedioPago,O=N.tipoEnvio,V=N.productos,G=N.cantidad,I=N.subtotal,C=N.porcentaje_descuento,H=N.descuento,J=N.total;(0,m.useEffect)((function(){"approved"!=k?a(!0):b()}),[]),(0,m.useEffect)((function(){if(E&&S.length>0){var e=JSON.parse(localStorage.getItem("dataEnvio"));f(e.tipo),v(e.zona),l()}}),[E,S]),(0,m.useEffect)((function(){d.productos.length>0&&(g(),w())}),[d.productos]),(0,m.useEffect)((function(){if(O&&V.length&&0!=G&&0!=J){var e=z.idUsuario,t={envio:{idZona:P?P.idZona:null,tipo:O},venta:{subtotal:I,porcentaje_descuento:C,descuento:H,total:J,productos:V,collection_id:_,payment_id:j,idMedioPago:T,idUsuario:e}};M(t)}else console.log("no se puede completar la operacion")}),[p]);var M=function(){var e=(0,c.Z)(o().mark((function e(t){var n,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,(n=new Headers).append("token",z.token),n.append("Content-Type","application/json"),r="".concat(x.bl,"/ventas/registrarVenta"),e.next=7,fetch(r,{headers:n,method:"POST",body:JSON.stringify(t)});case 7:200==e.sent.status?(localStorage.removeItem("dataEnvio"),localStorage.removeItem("carrito"),h.fire("Listo","Felicidades, tu compra se registr\xf3 con \xe9xito. En breve nos comunicaremos con usted para informarle el estado de su compra v\xeda email.","success").then((function(){return window.location.assign("/")}))):a(!0),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),a(e.t0.message);case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t){return e.apply(this,arguments)}}();return n?(0,r.jsx)(y.Z,{message:"Ha ocurrido un error, intentalo mas tarde"}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.Z,{title:"Finalizacion de compra",metadesc:""}),(0,r.jsxs)("div",{className:"jsx-2063553454 wrapper",children:[(0,r.jsx)(u.Z,{}),(0,r.jsx)("p",{className:"jsx-2063553454",children:"Su compra esta siento procesada, aguarde unos segundos..."})]}),(0,r.jsx)(i.default,{id:"2063553454",children:[".wrapper.jsx-2063553454{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:90vh;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}"]})]})};R.getInitialProps=function(){var e=(0,c.Z)(o().mark((function e(t){var n,r,a,c;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.query,r=n.payment_id,a=n.status,c=n.collection_id,e.abrupt("return",{collection_id:c,status:a,payment_id:r});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();var z={enviosGuardar:w,carritoTraerProductos:g,zonasGuardar:b,setDataEnvioEnVenta:_,inicializarStoreVenta:j,traerZonas:k};t.default=(0,d.$j)((function(e){return{carritoReducer:e.carritoReducer,enviosReducer:e.enviosReducer,usuarioReducer:e.usuarioReducer,zonasReducer:e.zonasReducer,ventaReducer:e.ventaReducer}}),z)(R)},2642:function(e,t,n){"use strict";var r=n(5893),a=(n(7294),n(9008)),o=n(1130);t.Z=function(e){var t=e.title,n=e.metadesc;return(0,r.jsxs)(a.default,{children:[(0,r.jsx)("title",{children:t}),(0,r.jsx)("meta",{name:"theme-color",content:"#df8f0e"}),(0,r.jsx)("link",{rel:"icon",href:"".concat(o.mp,"/static/Perro.png")}),n?(0,r.jsx)("meta",{name:"description",content:n}):null,(0,r.jsx)("script",{src:"https://secure.mlstatic.com/sdk/javascript/v1/mercadopago.js"})]})}},2379:function(e,t,n){"use strict";n.d(t,{l:function(){return i}});var r=n(809),a=n.n(r),o=n(266),c=n(2538),i=function(e){return function(){var t=(0,o.Z)(a().mark((function t(n){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n({type:c.br}),t.prev=1,e){t.next=4;break}return t.abrupt("return",n({type:c.pn,payload:"Sin datos de env\xedo"}));case 4:n({type:c.Q5,payload:"".concat(e).toLowerCase()}),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(1),n({type:c.pn,payload:t.t0.message});case 10:case"end":return t.stop()}}),t,null,[[1,7]])})));return function(e){return t.apply(this,arguments)}}()}},5318:function(e,t,n){"use strict";n.d(t,{S1:function(){return a},J1:function(){return o},Z_:function(){return c}});var r=n(4361),a=function(){return function(e,t){var n=t().carritoReducer,a={productos:n.productos,cantidad:n.cantidad,subTotal:n.total};e({type:r.w1,payload:a})}},o=function(e){return function(t){return t({type:r.X$,payload:e})}},c=function(){return function(e,t){var n=t().zonasReducer.zona,a=t().enviosReducer.tipos,o={};return a.normal?(o.total=n?n.precio:0,o.tipo="Domicilio"):a.express?(o.total=n?n.precio_express:0,o.tipo="Express",o.idMedioPago="1"):(o.total=0,o.tipo="Local"),o.zona=n?n.idZona:null,o.idMedioPago="1",e({type:r.Nj,payload:o})}}},1538:function(e,t,n){"use strict";n.d(t,{y:function(){return s},P:function(){return u}});var r=n(809),a=n.n(r),o=n(266),c=n(1130),i=n(1991),s=function(){return function(){var e=(0,o.Z)(a().mark((function e(t){var n,r,o,s;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t({type:i.br}),e.prev=1,n=JSON.parse(localStorage.getItem("oliverpetshop_usuario")),(r=new Headers).append("token",n.token),e.next=7,fetch("".concat(c.bl,"/zonas"),{headers:r});case 7:return o=e.sent,e.next=10,o.json();case 10:s=e.sent,t({type:i.wB,payload:s.data}),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(1),t({type:i.pn,payload:e.t0});case 17:case"end":return e.stop()}}),e,null,[[1,14]])})));return function(t){return e.apply(this,arguments)}}()},u=function(e){return function(t,n){if(!e)return console.log("aca"),void t({type:i.rG});var r=n().zonasReducer.zonas.filter((function(t){return t.idZona==e}));r.length?(r=r[0],t({type:i.UH,payload:r})):t({type:i.pn,payload:"No se encontro la zona"})}}},5411:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/procesarVenta/[[...params]]",function(){return n(670)}])}},function(e){e.O(0,[455,774,888,179],(function(){return t=5411,e(e.s=t);var t}));var t=e.O();_N_E=t}]);