_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[20],{BsWD:function(t,e,r){"use strict";r.d(e,"a",(function(){return a}));var n=r("a3WO");function a(t,e){if(t){if("string"===typeof t)return Object(n.a)(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Object(n.a)(t,e):void 0}}},KQm4:function(t,e,r){"use strict";r.d(e,"a",(function(){return o}));var n=r("a3WO");var a=r("BsWD");function o(t){return function(t){if(Array.isArray(t))return Object(n.a)(t)}(t)||function(t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||Object(a.a)(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},a3WO:function(t,e,r){"use strict";function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}r.d(e,"a",(function(){return n}))},aQxn:function(t,e,r){"use strict";r.r(e);var n=r("o0o1"),a=r.n(n),o=r("HaE+"),c=r("MX0m"),u=r.n(c),i=r("q1tI"),s=r.n(i),d=r("k2JI"),l=r("XOuL"),p=r("nOHt"),f=r("/MKj"),m=r("nhAV"),v=r("pzYh"),b=r("rOcY"),g=r("t0wy"),y=s.a.createElement,h=function(t){return function(){var e=Object(o.a)(a.a.mark((function e(r){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r({type:v.c}),e.prev=1,t){e.next=4;break}return e.abrupt("return",r({type:v.a,payload:"Sin datos de env\xedo"}));case 4:r({type:v.b,payload:t}),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),r({type:v.a,payload:e.t0.message});case 10:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t){return e.apply(this,arguments)}}()},w=m.traerProductos,O=function(t){var e=Object(i.useState)(!1),r=e[0],n=e[1],c=Object(i.useState)(!1),f=c[0],m=c[1];Object(i.useEffect)((function(){var e=JSON.parse(localStorage.getItem("dataEnvio"));t.enviosGuardar(e),t.carritoTraerProductos(),t.usuarioReducer.logueado&&t.carritoReducer.productos.length>0&&t.enviosReducer.data&&v()}),[t.usuarioReducer]);var v=function(){var e=Object(o.a)(a.a.mark((function e(){var r,n,o,c,u,i,s,d,l,p,f,m,v,b,g;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.usuarioReducer.usuario.idUsuario,n=t.carritoReducer,o=n.subtotal,c=n.porcentaje_descuento,u=n.descuento,i=n.total,s=n.productos,d=t.enviosReducer.data,l=d.zona,p=d.tipo,f=new Date,m=f.getMonth()<10?"0".concat(f.getMonth()+1):"".concat(f.getMonth()),v=f.getDay()<10?"0".concat(f.getDay()):"".concat(f.getDay()),b="".concat(f.getFullYear(),"-").concat(m,"-").concat(v),g={envio:{idZona:l,tipo:p},venta:{subtotal:o,porcentaje_descuento:c,descuento:u,total:i,idUsuario:r,productos:s,fecha:b,operacion_id:t.collection_id}},e.abrupt("return",h(g));case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),h=function(){var e=Object(o.a)(a.a.mark((function e(r){var o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,(o=new Headers).append("token",t.usuarioReducer.usuario.token),o.append("Content-Type","application/json"),e.next=6,fetch("".concat(b.a,"/registrarVenta"),{headers:o,method:"POST",body:JSON.stringify(r)});case 6:200==e.sent.status?(localStorage.removeItem("dataEnvio"),localStorage.removeItem("carrito"),m("Felicidades, Tu venta se registr\xf3 con \xe9xito. En breve nos comunicaremos con usted para informarle el estado de su compra."),setTimeout((function(){window.location.assign("/")}),5e3)):n(!0),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),n(e.t0.message);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}();Object(p.useRouter)();return y(s.a.Fragment,null,y(d.a,{title:"Finalizacion de compra",metadesc:""}),y("div",{className:"jsx-2063553454 wrapper"},!t.usuarioReducer.logueado||t.enviosReducer.error||t.carritoReducer.error||r?y(g.a,{message:"Ha ocurrido un error, intentalo mas tarde"}):y(s.a.Fragment,null,f?y("div",{className:"jsx-2063553454 alert alert-success"},f):y(s.a.Fragment,null,y(l.a,null),y("p",{className:"jsx-2063553454"},"Su compra esta siento procesada, aguarde unos segundos...")))),y(u.a,{id:"2063553454"},[".wrapper.jsx-2063553454{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:90vh;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}"]))};O.getInitialProps=function(){var t=Object(o.a)(a.a.mark((function t(e){var r,n;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.query,n=r.collection_id,t.abrupt("return",{collection_id:n});case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();var j={enviosGuardar:h,carritoTraerProductos:w};e.default=Object(f.b)((function(t){return{carritoReducer:t.carritoReducer,enviosReducer:t.enviosReducer,usuarioReducer:t.usuarioReducer}}),j)(O)},k2JI:function(t,e,r){"use strict";var n=r("q1tI"),a=r.n(n),o=r("8Kt/"),c=r.n(o),u=r("rOcY"),i=a.a.createElement;e.a=function(t){var e=t.title,r=t.metadesc;return i(c.a,null,i("title",null,e),i("meta",{name:"theme-color",content:"#df8f0e"}),i("link",{rel:"icon",href:"".concat(u.d,"/static/Perro.png")}),r?i("meta",{name:"description",content:r}):null)}},kqUl:function(t,e,r){"use strict";r.d(e,"e",(function(){return n})),r.d(e,"a",(function(){return a})),r.d(e,"b",(function(){return o})),r.d(e,"d",(function(){return c})),r.d(e,"c",(function(){return u}));var n="carrito_traer_todos_carrito",a="carrito_agregar_producto",o="carrito_eliminar_producto",c="carrito_loading",u="carrito_error"},nhAV:function(t,e,r){"use strict";r.r(e),r.d(e,"traerProductos",(function(){return i})),r.d(e,"agregarProducto",(function(){return s})),r.d(e,"eliminarProducto",(function(){return d}));var n=r("KQm4"),a=r("o0o1"),o=r.n(a),c=r("HaE+"),u=r("kqUl"),i=function(){return function(){var t=Object(c.a)(o.a.mark((function t(e){var r,n,a;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e({type:u.d}),t.prev=1,t.next=4,JSON.parse(localStorage.getItem("carrito"));case 4:return r=t.sent,n=0,r.forEach((function(t){n+=parseInt(t.precioUnidad*t.cantidad)})),a={productos:r,subtotal:n},t.abrupt("return",e({type:u.e,payload:a}));case 11:return t.prev=11,t.t0=t.catch(1),t.abrupt("return",e({type:u.c,payload:t.t0}));case 14:case"end":return t.stop()}}),t,null,[[1,11]])})));return function(e){return t.apply(this,arguments)}}()},s=function(t){return function(){var e=Object(c.a)(o.a.mark((function e(r,a){var c,i,s,d,l,p,f;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r({type:u.d});try{c=a().carritoReducer.productos,(s=c.filter((function(e){return e.idSubProducto==t.idSubProducto}))).length>0?(s[0].cantidad=s[0].cantidad+t.cantidad,d=c.filter((function(t){return t.idSubProducto!=s[0].idSubProducto})),i=d.length>0?[].concat(Object(n.a)(d),[s[0]]):[s[0]]):i=[].concat(Object(n.a)(c),[t]),localStorage.setItem("carrito",JSON.stringify(i)),l=JSON.parse(localStorage.getItem("carrito")),p=0,l.forEach((function(t){p+=parseInt(t.precioUnidad*t.cantidad)})),f={listProductosUpgrade:i,subtotal:p},setTimeout((function(){r({type:u.a,payload:f})}),1500)}catch(o){r({type:u.c,payload:o})}case 2:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()},d=function(t){return function(){var e=Object(c.a)(o.a.mark((function e(r,n){var a,c,i,s,d;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r({type:u.d});try{a=n().carritoReducer.productos,c=a.filter((function(e){return e.idSubProducto!==t})),localStorage.setItem("carrito",JSON.stringify(c)),i=JSON.parse(localStorage.getItem("carrito")),s=0,i.forEach((function(t){s+=parseInt(t.precioUnidad*t.cantidad)})),d={newProductos:c,subtotal:s},r({type:u.b,payload:d})}catch(o){r({type:u.c,payload:o})}case 2:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()}},pg2c:function(t,e,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/procesarVenta/[[...params]]",function(){return r("aQxn")}])},pzYh:function(t,e,r){"use strict";r.d(e,"c",(function(){return n})),r.d(e,"a",(function(){return a})),r.d(e,"b",(function(){return o}));var n="envios_loading",a="envios_error",o="envios_guardar"},t0wy:function(t,e,r){"use strict";var n=r("q1tI"),a=r.n(n).a.createElement;e.a=function(t){var e=t.message;return a("div",{className:"alert alert-warning text-center"},e)}}},[["pg2c",1,2,0,3,4]]]);